<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Creator Collections - GoShopMe</title>
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <link rel="stylesheet" href="css/chat-drawer-drag.css">
<script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=Karla:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shine-primary': '#939BFB',
                        'shine-accent': '#F96226',
                        'primary': '#939BFB',
                        'secondary-orange': '#F96226',
                        'secondary-blue': '#B7C7FF'
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'dm-sans': ['DM Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        
/* ---- MOBILE FULL-WIDTH OVERRIDE (match Home) ---- */
@media screen and (max-width: 768px) {
  #app-shell, #main-content, #auth-screen, #welcome_screen, #quiz-screen, #onboarding-screen,
  #bottom-nav, #bottom-navigation, #header, #app-header,
  #chat-drawer, #chat-input-bar, #shai-chat-drawer, #return-chat-drawer, #return-chat-input-bar, #chat-input-collapsed,
  #shai-chat-drawer-wrapper, #chat-drawer-wrapper,
  body > div, body > main {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  [class*="left-1/2"][class*="-translate-x-1/2"]:not([class*="rounded-full"]) {
    left: 0 !important;
    right: 0 !important;
    max-width: 100vw !important;
    width: 100% !important;
    transform: none !important;
  }
  #chat-drawer.translate-y-full, #shai-chat-drawer.translate-y-full, #return-chat-drawer.translate-y-full {
    transform: translateY(100%) !important;
  }
  #bottom-nav > div, #bottom-navigation > div, nav#bottom-nav > div, nav#bottom-navigation > div {
    padding-top: 2px !important;
    padding-bottom: 24px !important;
  }
}

::-webkit-scrollbar { display: none; }
        * { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .dm-sans { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .poppins { font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .font-fahkwang { font-family: 'Poppins', sans-serif; }
        .container-mobile { max-width: 390px; margin-left: auto; margin-right: auto; width: 100%; }

        /* Icon button - match Home/design system */
        .icon-button svg { width: 18px; height: 18px; stroke-width: 1.5; }
        .icon-button:hover svg { color: #939BFB; }

        /* Bottom nav - match Home */
        .bottom-nav-btn { display: flex; flex-direction: column; align-items: center; color: #6B7280; transition: color 0.2s ease-in-out; }
        .bottom-nav-btn:hover, .bottom-nav-btn.active { color: #939BFB; }
        .bottom-nav-btn:hover svg, .bottom-nav-btn:hover span, .bottom-nav-btn.active svg, .bottom-nav-btn.active span { color: #939BFB; }
        .bottom-nav-btn svg { width: 20px; height: 20px; stroke-width: 1.5; margin-bottom: 4px; }

        /* Wishlist heart filled - design system #939BFB */
        .heart-filled { fill: #939BFB !important; stroke: #939BFB !important; }
        .share-icon-tilted { transform: rotate(-35deg); }

        /* Voice recording */
        .recording { background: #ef4444 !important; color: white !important; }
        @keyframes wavePulse { 0%, 100% { transform: scaleY(0.5); } 50% { transform: scaleY(1.0); } }
        .wave-bar.playing { animation: wavePulse 1.1s ease-in-out infinite; animation-delay: calc(var(--i) * 0.08s); }

        .voice-message-bubble { min-width: 140px; max-width: 260px; width: fit-content; display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 16px; }

        .drag-handle { transition: background-color 0.2s ease; cursor: pointer; }
        .drag-handle:hover { background-color: #9CA3AF; }
        .chat-notification { animation: slideInUp 0.3s ease-out; }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
    <script>
    // Header badge system (match Home) - notifications & cart counts
    let cartCountValue = 0;
    let notifCountValue = 0;
    function getBadgeElements() {
        return {
            cartIndicator: document.getElementById('cart-indicator'),
            cartCount: document.getElementById('cart-count'),
            notifIndicator: document.getElementById('notif-indicator'),
            notifCount: document.getElementById('notif-count')
        };
    }
    function updateCartBadge() {
        const el = getBadgeElements();
        if (!el.cartIndicator || !el.cartCount) return;
        const show = cartCountValue > 0;
        el.cartIndicator.classList.toggle('hidden', !show);
        el.cartCount.textContent = show ? (cartCountValue > 99 ? '99+' : cartCountValue) : '';
    }
    function updateNotifBadge() {
        const el = getBadgeElements();
        if (!el.notifIndicator || !el.notifCount) return;
        const show = notifCountValue > 0;
        el.notifIndicator.classList.toggle('hidden', !show);
        el.notifCount.textContent = show ? (notifCountValue > 99 ? '99+' : notifCountValue) : '';
    }
    window.addToCart = function() { cartCountValue++; updateCartBadge(); };
    window.addNotification = function() { notifCountValue++; updateNotifBadge(); };
    window.setCartCount = function(n) { cartCountValue = Math.max(0, n); updateCartBadge(); };
    window.setNotifCount = function(n) { notifCountValue = Math.max(0, n); updateNotifBadge(); };
    window.resetBadges = function() { cartCountValue = 0; notifCountValue = 0; updateCartBadge(); updateNotifBadge(); };
    document.addEventListener('DOMContentLoaded', function() { updateCartBadge(); updateNotifBadge(); });
    </script>
</head>
<body class="bg-[#F6F6F6] min-h-screen text-black overflow-x-hidden">

    <!-- App Shell - 390px max, centered on desktop -->
    <div id="app-shell" class="relative w-full max-w-[390px] mx-auto min-h-screen bg-white shadow-2xl">

    <!-- App Header - same width as main screen -->
    <header id="app-header" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 bg-white/95 backdrop-blur-sm border-b border-gray-100">
        <div class="flex items-center justify-between px-4 py-3">
            <div class="flex items-center space-x-3">
                <a href="Picks.html" class="p-1 rounded-full hover:bg-gray-100 transition-colors" aria-label="Back to Picks">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>
                    </svg>
                </a>
            </div>
            <h1 id="page-title" class="text-lg poppins font-semibold text-black absolute left-1/2 transform -translate-x-1/2">Creator Collections</h1>
            <div class="flex items-center space-x-3">
                <a href="Notifications_Screen.html?from=collections" id="notif-btn" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-visible" aria-label="Notifications">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/>
                    </svg>
                    <div id="notif-indicator" class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-[#F96226] rounded-full hidden flex items-center justify-center min-w-[12px]">
                        <span id="notif-count" class="text-[10px] text-white font-medium leading-none"></span>
                    </div>
                </a>
                <a href="Shopping_bag.html?from=collections" id="cart-btn" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-visible" aria-label="Shopping bag">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993z"/>
                    </svg>
                    <div id="cart-indicator" class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-[#939BFB] rounded-full hidden flex items-center justify-center min-w-[12px]">
                        <span id="cart-count" class="text-[10px] text-white font-medium leading-none"></span>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content Container - pb for bottom nav + chat input bar (match Home) -->
    <main id="main-content" class="pt-16 pb-[140px] relative w-full max-w-[390px] mx-auto overflow-y-auto">
        
        <!-- Background Content - Creator Collections -->
        <div id="background-content" class="min-h-screen">
            
            <!-- Creator Info Header (dynamic - populated from DB) -->
            <section id="creator-header" class="bg-white border-b border-gray-100 px-4 py-6">
                <div class="container-mobile">
                    <div id="creator-header-content" class="flex items-center space-x-4">
                        <!-- Populated by loadCreatorProfile() -->
                        <div id="creator-avatar-wrap" class="w-16 h-16 rounded-full overflow-hidden border-2 border-primary/20 flex-shrink-0 bg-gray-200 flex items-center justify-center">
                            <img id="creator-avatar" class="w-full h-full object-cover hidden" src="" alt="">
                            <span id="creator-avatar-initials" class="text-gray-500 text-lg font-medium">?</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h2 id="creator-name" class="text-lg font-fahkwang font-bold text-black truncate">—</h2>
                            <p id="creator-tagline" class="text-sm text-gray-600 mb-1 truncate">—</p>
                            <div class="flex items-center space-x-4 flex-wrap gap-y-1">
                                <span id="creator-followers" class="text-xs text-gray-500">0 followers</span>
                                <div id="creator-social-links" class="flex items-center space-x-2">
                                    <!-- Social links populated from DB: instagram, tiktok, youtube, pinterest, twitter -->
                                </div>
                            </div>
                        </div>
                        <button id="creator-follow-btn" class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-full hover:bg-primary/90 transition-colors flex-shrink-0">
                            Follow
                        </button>
                    </div>
                </div>
            </section>

            <!-- Collections Grid (dynamic - populated from DB) -->
            <section id="collections-grid" class="px-4 py-6">
                <div class="container-mobile">
                    <h3 id="collections-section-title" class="text-xl font-fahkwang font-bold text-black mb-6">Curated collections</h3>
                    <div id="collections-list" class="space-y-6">
                        <!-- Populated by loadCreatorProfile() - empty state shown when no collections -->
                    </div>
                </div>
            </section>

        </div>

        <!-- Chat Drawer Overlay - match Home -->
        <div id="chat-overlay" class="fixed inset-0 bg-black/40 z-40 hidden"></div>

        <!-- ShAI Chat Drawer - closed by default, opens when chat button tapped -->
        <div id="shai-chat-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 bg-white rounded-t-3xl shadow-2xl h-[80vh] transform translate-y-full transition-transform duration-300 flex flex-col">
            
            <!-- Drag Handle - match Home -->
            <div id="drag-handle-zone" class="chat-drawer-drag-zone flex justify-center pt-2 flex-shrink-0">
                <div id="drag-handle" class="w-10 h-1 bg-gray-300 rounded-full cursor-grab pointer-events-none" role="button" aria-label="Drag to resize"></div>
            </div>

            <!-- Drawer Header - no arrow button; ShAI avatar placeholder (DB-sourced) -->
            <div id="drawer-header" class="flex items-center p-4 pb-2 flex-shrink-0">
                <button id="back-button" class="mr-3 hidden hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
                </button>
                <div id="shai-avatar-container" class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0 bg-gray-200 flex items-center justify-center">
                    <img id="shai-avatar" class="w-full h-full object-cover" src="../assets/shai-avatar.png" alt="ShAI avatar" data-shai-avatar onerror="this.style.display='none';var p=document.getElementById('shai-avatar-placeholder');if(p)p.classList.remove('hidden')">
                    <span id="shai-avatar-placeholder" class="text-gray-500 text-xs font-medium hidden">AI</span>
                </div>
                <div class="flex-1">
                    <p class="font-semibold text-black text-sm" id="header-title">ShAI</p>
                    <p class="text-xs text-gray-500" id="header-subtitle">Your shopping assistant</p>
                </div>
            </div>

            <!-- Chat Messages - match Home structure -->
            <div id="chat-content" class="flex-1 flex flex-col min-h-0">
                <div id="chat-messages" class="flex-1 overflow-y-auto">
                    <div class="p-4 pb-0">
                        <div class="flex items-start space-x-3 mb-4">
                            <div id="shai-msg-avatar" class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-200 flex items-center justify-center">
                                <img id="shai-msg-avatar-img" class="w-full h-full object-cover" src="../assets/shai-avatar.png" alt="ShAI avatar" data-shai-avatar onerror="this.style.display='none';var p=document.getElementById('shai-msg-avatar-placeholder');if(p)p.classList.remove('hidden')">
                                <span id="shai-msg-avatar-placeholder" class="text-gray-500 text-sm font-medium hidden">AI</span>
                            </div>
                            <div class="flex-1">
                                <div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 mb-3">
                                    <p class="text-sm text-black">Loving Emma's latest styles? Let me help you find what fits you best!</p>
                                </div>
                                <div id="smart-prompts" class="flex flex-wrap gap-2 pb-2">
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Buy this collection</button>
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Find cheaper alternatives</button>
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Style this for me</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Bar - Inside Drawer - match Home -->
                <div id="chat-input-drawer" class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
                    <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                        <button id="cam-btn-drawer" class="icon-button hover:opacity-70 transition-opacity" aria-label="Add image or video">
                            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg>
                        </button>
                        <textarea id="chat-input-drawer-field" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans resize-none min-h-[24px] max-h-[144px] overflow-y-auto" rows="1"></textarea>
                        <button id="add-friend-btn-drawer" class="icon-button hover:opacity-70 transition-opacity">
                            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
                        </button>
                        <button id="mic-btn-drawer" class="icon-button hover:opacity-70 transition-opacity" aria-label="Record voice message">
                            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg>
                        </button>
                        <button id="send-btn-drawer" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
                            <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add Friend Flow Content - match Home -->
            <div id="add-friend-content" class="flex-1 flex flex-col min-h-0 hidden">
                <div id="contact-list" class="flex-1 overflow-y-auto p-4">
                    <div class="mb-4">
                        <div class="relative">
                            <svg class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                            <input type="text" id="contact-search" placeholder="Search contacts..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pl-10 text-sm">
                        </div>
                    </div>
                    <div id="contacts-container" class="space-y-2"><!-- Contacts rendered dynamically --></div>
                </div>
            </div>
        </div>

        <!-- Chat Input Bar - Collapsed State - match Home (always visible when drawer closed) -->
        <div id="chat-input-bar" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 p-4 z-30">
            <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                <button id="cam-btn" class="icon-button hover:opacity-70 transition-opacity" aria-label="Add image or video">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg>
                </button>
                <textarea id="message-input" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans resize-none min-h-[24px] max-h-[144px] overflow-y-auto" rows="1"></textarea>
                <button id="add-friend-btn" class="icon-button hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
                </button>
                <button id="mic-btn" class="icon-button hover:opacity-70 transition-opacity" aria-label="Record voice message">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg>
                </button>
                <button id="send-btn" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                </button>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation - match Home template -->
    <nav id="bottom-navigation" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 z-50">
        <div class="flex items-center justify-around py-2">
            <a href="Home.html" class="bottom-nav-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>
                <span class="text-xs">Home</span>
            </a>
            <a href="Picks.html" class="bottom-nav-btn active">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/></svg>
                <span class="text-xs">Picks</span>
            </a>
            <a href="Wishlist.html" class="bottom-nav-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>
                <span class="text-xs">Wishlist</span>
            </a>
            <a id="collections-nav-profile-link" href="User_Profile_Free_Plan.html" class="bottom-nav-btn">
                <span id="collections-nav-profile-icon" class="flex items-center justify-center w-6 h-6 mb-1 text-shine-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                </span>
                <img id="collections-nav-profile-photo" class="w-6 h-6 rounded-full object-cover mb-1 hidden" src="" alt="Profile">
                <span class="text-xs">Profile</span>
            </a>
        </div>
    </nav>
    <script>
    // Bottom nav profile: show icon if no uploaded photo, else show photo from localStorage; Profile link = paid/free based on __userPlan
    (function() {
        var plan = (localStorage.getItem('__userPlan') || '').toLowerCase();
        var profileHref = (plan === 'paid' || plan === 'true') ? 'User_Profile_Paid_Plan.html' : 'User_Profile_Free_Plan.html';
        var profileLink = document.getElementById('collections-nav-profile-link');
        if (profileLink) profileLink.href = profileHref;
        var saved = null;
        try { saved = localStorage.getItem('profilePhoto'); } catch (e) {}
        var img = document.getElementById('collections-nav-profile-photo');
        var icon = document.getElementById('collections-nav-profile-icon');
        if (img && icon) {
            if (saved) {
                img.src = saved;
                img.classList.remove('hidden');
                icon.classList.add('hidden');
            } else {
                img.src = '';
                img.classList.add('hidden');
                icon.classList.remove('hidden');
            }
        }
        window.setProfilePhoto = function(url) {
            try { if (url) localStorage.setItem('profilePhoto', url); else localStorage.removeItem('profilePhoto'); } catch (e) {}
            var i = document.getElementById('collections-nav-profile-photo');
            var ic = document.getElementById('collections-nav-profile-icon');
            if (i && ic) {
                if (url) { i.src = url; i.classList.remove('hidden'); ic.classList.add('hidden'); }
                else { i.src = ''; i.classList.add('hidden'); ic.classList.remove('hidden'); }
            }
        };
    })();
    </script>

    </div><!-- end app-shell -->

    <script>
        let collectionWishlist = new Set(['work-week-essentials']);
        window.toggleCollectionWishlist = function(btn) {
            const id = btn.dataset.collection;
            const svg = btn.querySelector('svg');
            if (collectionWishlist.has(id)) {
                collectionWishlist.delete(id);
                svg.classList.remove('heart-filled');
                svg.setAttribute('fill', 'none');
            } else {
                collectionWishlist.add(id);
                svg.classList.add('heart-filled');
                svg.setAttribute('fill', '#939BFB');
            }
        };
        window.shareCollection = function(name) {
            const d = { title: name + ' - GoShopMe', text: 'Check out this collection on GoShopMe', url: 'https://app.goshopme.ai' };
            if (navigator.share) navigator.share(d).catch(() => { if (navigator.clipboard) navigator.clipboard.writeText(d.url); });
            else if (navigator.clipboard) navigator.clipboard.writeText(d.url);
        };
        window.openCollectionDetail = function(name) {
            const col = (window.__creatorCollections || []).find(c => (c.name || '') === name);
            const creator = window.__creatorProfile || {};
            if (col) {
                const payload = { collection: col, creator: creator };
                sessionStorage.setItem('__singleCollectionData', JSON.stringify(payload));
            }
            window.location.href = "Creator`s Single_Collection.html?collection=" + encodeURIComponent(name || '');
        };

        /**
         * Load creator profile and collections from DB. Call with data from your API.
         * @param {Object} data - Creator profile + collections
         * @param {string} data.id - Creator ID
         * @param {string} data.name - Display name
         * @param {string} [data.avatar] - Profile picture URL
         * @param {string} [data.tagline] - Bio/tagline
         * @param {string|number} [data.followers] - Follower count (e.g. "47.2k" or 47200)
         * @param {boolean} [data.isFollowing] - Whether current user follows
         * @param {Object} [data.social] - Social links: { instagram, tiktok, youtube, pinterest, twitter }
         * @param {Array} data.collections - Array of collection objects
         * @param {string} collection.id - Slug (e.g. "paris-in-spring")
         * @param {string} collection.name - Display name
         * @param {string} collection.coverImage - Cover image URL (if coverType is 'image' or not specified)
         * @param {string} collection.coverVideo - Cover video URL (if coverType is 'video')
         * @param {string} collection.coverType - 'image' or 'video' (defaults to 'image')
         * @param {string} [collection.description] - Short description
         * @param {number} collection.itemCount - Number of items
         * @param {string} [collection.priceRange] - e.g. "$240-580"
         * @param {string} [collection.saves] - e.g. "2.1k saves"
         * @param {string} [collection.badge] - "New Collection" | "Trending" | null
         * @param {Array} [collection.itemThumbnails] - Array of image URLs for preview stack
         */
        window.loadCreatorProfile = function(data) {
            if (!data) return;
            const creator = {
                id: data.id || '',
                name: data.name || 'Creator',
                avatar: data.avatar || '',
                tagline: data.tagline || '',
                followers: data.followers ?? 0,
                isFollowing: !!data.isFollowing,
                social: data.social || {}
            };
            const collections = Array.isArray(data.collections) ? data.collections : [];

            const pageTitle = document.getElementById('page-title');
            const creatorName = document.getElementById('creator-name');
            const creatorTagline = document.getElementById('creator-tagline');
            const creatorFollowers = document.getElementById('creator-followers');
            const creatorAvatar = document.getElementById('creator-avatar');
            const creatorAvatarInitials = document.getElementById('creator-avatar-initials');
            const creatorSocialLinks = document.getElementById('creator-social-links');
            const creatorFollowBtn = document.getElementById('creator-follow-btn');
            const collectionsSectionTitle = document.getElementById('collections-section-title');
            const collectionsList = document.getElementById('collections-list');

            if (pageTitle) pageTitle.textContent = creator.name + ' Collections';
            if (creatorName) creatorName.textContent = creator.name;
            if (creatorTagline) creatorTagline.textContent = creator.tagline || '—';
            if (creatorFollowers) {
                const n = typeof creator.followers === 'number' ? creator.followers : parseFloat(String(creator.followers).replace(/[kKmM]/g, '')) || 0;
                creatorFollowers.textContent = n >= 1000 ? (n / 1000).toFixed(1) + 'k followers' : n + ' followers';
            }
            if (creatorAvatar && creatorAvatarInitials) {
                if (creator.avatar) {
                    creatorAvatar.src = creator.avatar;
                    creatorAvatar.alt = creator.name;
                    creatorAvatar.classList.remove('hidden');
                    creatorAvatarInitials.classList.add('hidden');
                } else {
                    creatorAvatar.classList.add('hidden');
                    creatorAvatarInitials.textContent = creator.name.charAt(0).toUpperCase() || '?';
                    creatorAvatarInitials.classList.remove('hidden');
                }
            }
            const SOCIAL = {
                instagram: { url: 'https://instagram.com/', label: 'Instagram', path: 'M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z' },
                tiktok: { url: 'https://www.tiktok.com/@', label: 'TikTok', path: 'M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z' },
                youtube: { url: 'https://youtube.com/@', label: 'YouTube', path: 'M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z' },
                pinterest: { url: 'https://pinterest.com/', label: 'Pinterest', path: 'M12 0C5.373 0 0 5.373 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.298 7.464-1.23 0-2.388-.64-2.788-1.392l-.757 2.871c-.271 1.042-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z' },
                twitter: { url: 'https://x.com/', label: 'X (Twitter)', path: 'M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z' }
            };
            if (creatorSocialLinks) {
                creatorSocialLinks.innerHTML = Object.keys(SOCIAL).filter(k => creator.social[k]).map(k => {
                    const s = SOCIAL[k];
                    const handle = creator.social[k];
                    const href = (typeof handle === 'string' && handle.startsWith('http')) ? handle : (s.url + (handle.startsWith('@') ? handle.slice(1) : handle));
                    return '<a href="' + href + '" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-primary transition-colors" aria-label="' + s.label + '"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="' + s.path + '"/></svg></a>';
                }).join('');
            }
            if (creatorFollowBtn) creatorFollowBtn.textContent = creator.isFollowing ? 'Following' : 'Follow';
            if (collectionsSectionTitle) collectionsSectionTitle.textContent = 'Curated by ' + creator.name;
            if (collectionsList) {
                collectionsList.innerHTML = collections.length ? collections.map((c, i) => {
                    const slug = (c.id || c.name || '').toLowerCase().replace(/\s+/g, '-');
                    const isWishlisted = (typeof collectionWishlist !== 'undefined' && collectionWishlist.has(slug));
                    const thumbs = (c.itemThumbnails || []).slice(0, 4);
                    const extra = Math.max(0, (c.itemCount || thumbs.length) - 3);
                    const thumbHtml = thumbs.slice(0, 3).map((t, j) => '<img class="w-8 h-8 rounded-full border-2 border-white object-cover" src="' + t + '" alt="">').join('') +
                        (extra > 0 ? '<div class="w-8 h-8 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center"><span class="text-xs text-gray-600">+' + extra + '</span></div>' : '');
                    const badgeHtml = c.badge ? '<div class="absolute bottom-3 left-3 ' + (c.badge === 'Trending' ? 'bg-black' : 'bg-secondary-orange') + ' text-white px-3 py-1 rounded-full text-sm font-medium">' + c.badge + '</div>' : '';
                    var coverType = c.coverType || 'image';
                    var coverUrl = c.coverImage || c.coverVideo || '';
                    var coverHtml = '';
                    if (coverType === 'video' && coverUrl) {
                        coverHtml = '<video class="w-full h-48 object-cover" src="' + coverUrl.replace(/"/g, '&quot;') + '" autoplay muted loop playsinline></video>';
                    } else {
                        coverHtml = '<img class="w-full h-48 object-cover" src="' + coverUrl.replace(/"/g, '&quot;') + '" alt="' + (c.name || '') + ' collection"/>';
                    }
                    return '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer" onclick="openCollectionDetail(\'' + (c.name || '').replace(/'/g, "\\'") + '\')"><div class="relative">' + coverHtml + '<div class="absolute top-3 right-3 flex flex-col space-y-2"><button type="button" class="p-1 wishlist-btn flex items-center justify-center hover:opacity-80 transition-opacity" data-collection="' + slug + '" onclick="event.stopPropagation(); toggleCollectionWishlist(this)"><svg class="w-[18px] h-[18px] text-white' + (isWishlisted ? ' heart-filled' : '') + '" fill="' + (isWishlisted ? '#939BFB' : 'none') + '" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg></button><button type="button" class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity" onclick="event.stopPropagation(); shareCollection(\'' + (c.name || '').replace(/'/g, "\\'") + '\')"><svg class="w-[18px] h-[18px] text-white share-icon-tilted" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button><button type="button" class="p-1 chat-trigger flex items-center justify-center hover:opacity-80 transition-opacity" data-collection="' + (c.name || '').replace(/"/g, '&quot;') + '"><svg class="w-[18px] h-[18px] text-white product-overlay-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"/></svg></button></div>' + badgeHtml + '</div><div class="p-4"><h4 class="text-lg font-fahkwang font-bold text-black mb-2">' + (c.name || '') + '</h4><p class="text-sm text-gray-600 mb-3">' + (c.itemCount || 0) + ' items' + (c.description ? ' • ' + c.description : '') + '</p><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="flex -space-x-2">' + thumbHtml + '</div><span class="text-sm text-gray-500">' + (c.saves || '0 saves') + '</span></div><span class="text-sm font-medium text-primary">' + (c.priceRange || '') + '</span></div></div></div>';
                }).join('') : '<div class="text-center py-12 text-gray-500 text-sm">No collections yet</div>';
            }
            window.__creatorCollections = collections;
            window.__creatorProfile = { id: creator.id, name: creator.name, avatar: creator.avatar, tagline: creator.tagline, followers: creator.followers, isFollowing: creator.isFollowing, social: creator.social };
        };

        /** Map creator ID to full profile data. Used when navigating from Creator Picks via ?creator=id */
        var CREATORS_BY_ID = {
            'emma-style': { id: 'emma-style', name: 'Emma Style', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-5.jpg', tagline: 'Elevated everyday style', followers: '47.2k', isFollowing: false, social: { instagram: 'emma.style', tiktok: 'emmastyle' }, collections: [{ id: 'paris-in-spring', name: 'Paris in Spring', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/48b9dd5fe7-08300242161fff705be9.png', description: 'Effortless elegance for spring days', itemCount: 7, priceRange: '$240-580', saves: '2.1k saves', badge: 'New Collection', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/a1fa951de5-1df3707f3a394528a723.png'] }, { id: 'work-week-essentials', name: 'Work Week Essentials', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/8659f0c5b4-129fa679de97277a8ff7.png', description: 'Professional power looks that work', itemCount: 12, priceRange: '$180-420', saves: '3.4k saves', itemThumbnails: [] }, { id: 'weekend-vibes', name: 'Weekend Vibes', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/7548a2fc26-003182dbed84e59239c4.png', description: 'Comfort meets style for lazy days', itemCount: 9, priceRange: '$120-350', saves: '1.7k saves', itemThumbnails: [] }, { id: 'date-night-ready', name: 'Date Night Ready', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/53ef8b8132-049359957a36dcc103c5.png', description: 'Perfect looks for romantic evenings', itemCount: 6, priceRange: '$160-480', saves: '2.8k saves', badge: 'Trending', itemThumbnails: [] }, { id: 'cozy-autumn', name: 'Cozy Autumn', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/ea3e1c57f0-1d936cba2f3573546cd6.png', description: 'Warm layers for cool weather', itemCount: 10, priceRange: '$200-450', saves: '1.9k saves', itemThumbnails: [] }, { id: 'gym-to-street', name: 'Gym to Street', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/9b3d5d941b-faf5ce469277c8f4e417.png', description: 'Athleisure that works everywhere', itemCount: 8, priceRange: '$90-280', saves: '1.5k saves', itemThumbnails: [] }] },
            'anna-rivera': { id: 'anna-rivera', name: 'Anna Rivera', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-6.jpg', tagline: 'Minimalist cool', followers: '32.1k', isFollowing: false, social: {}, collections: [{ id: 'power-business', name: 'Power Business', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/b13c2b21e8-e2e6c6512286c20cbd44.png', itemCount: 8 }, { id: 'minimalist-basics', name: 'Minimalist Basics', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/a237d37f08-9183f2271467bd16514a.png', itemCount: 10 }] },
            'sofia-chen': { id: 'sofia-chen', name: 'Sofia Chen', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-7.jpg', tagline: 'Weekend vibes', followers: '28.5k', isFollowing: false, social: {}, collections: [{ id: 'weekend-casual', name: 'Weekend Casual', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/a16416caa3-176574d362901d57a338.png', itemCount: 9 }, { id: 'cozy-layered', name: 'Cozy Layered', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/cba1ef9ed4-2a4abf50b1ec50c51ddd.png', itemCount: 7 }] },
            'maya-johnson': { id: 'maya-johnson', name: 'Maya Johnson', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-1.jpg', tagline: 'Street style', followers: '41.2k', isFollowing: false, social: {}, collections: [{ id: 'urban-street', name: 'Urban Street Style', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/02814a6d7b-0207c0fd9ce4694eb9ed.png', itemCount: 11 }, { id: 'sneaker-fashion', name: 'Sneaker Fashion', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/64c66e6d0e-91cec063e572905c683c.png', itemCount: 8 }] },
            'alex-kim': { id: 'alex-kim', name: 'Alex Kim', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-8.jpg', tagline: 'Athleisure', followers: '35.8k', isFollowing: false, social: {}, collections: [{ id: 'athleisure-gym', name: 'Athleisure Gym to Street', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/73024ae4b1-a0a9c28bc4907d22ac6b.png', itemCount: 10 }, { id: 'active-lifestyle', name: 'Active Lifestyle', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/4e2d3c7b9a-497abef6a977f5abdef1.png', itemCount: 6 }] },
            'zoe-martinez': { id: 'zoe-martinez', name: 'Zoe Martinez', avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-9.jpg', tagline: 'Retro revival', followers: '29.3k', isFollowing: false, social: {}, collections: [{ id: 'retro-vintage', name: 'Retro Vintage Revival', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/c1edec7423-160beffc50d92dc988c2.png', itemCount: 12 }, { id: '90s-fashion', name: '90s Fashion Throwback', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/c446a619d5-f94ec3967727fcde88dd.png', itemCount: 9 }] }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Load creator profile - from URL ?creator=id, window.__creatorProfileData, sessionStorage, or default
            var creatorId = (function() { var m = location.search.match(/[?&]creator=([^&]+)/); return m ? decodeURIComponent(m[1]) : ''; })();
            var creatorData = creatorId && CREATORS_BY_ID[creatorId] ? CREATORS_BY_ID[creatorId] : window.__creatorProfileData;
            if (!creatorData) {
                try { var s = sessionStorage.getItem('__creatorProfileData'); if (s) creatorData = JSON.parse(s); } catch (e) {}
            }
            if (!creatorData) {
                creatorData = {
                    id: 'emma-style',
                    name: 'Emma Style',
                    avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-5.jpg',
                    tagline: 'Elevated everyday style',
                    followers: '47.2k',
                    isFollowing: false,
                    social: { instagram: 'emma.style', tiktok: 'emmastyle' },
                    collections: [
                        { id: 'paris-in-spring', name: 'Paris in Spring', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/48b9dd5fe7-08300242161fff705be9.png', description: 'Effortless elegance for spring days', itemCount: 7, priceRange: '$240-580', saves: '2.1k saves', badge: 'New Collection', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/a1fa951de5-1df3707f3a394528a723.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/a5a5c3117b-e552b0101625253f2e63.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/5f3cd8d80d-86184dd368f92c3bd86a.png'], products: [{ id: 'p1', name: 'Floral Midi Dress', brand: 'Zara', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/a1fa951de5-1df3707f3a394528a723.png', price: '$89', description: 'Flowy floral print dress for spring days', isWishlisted: false }, { id: 'p2', name: 'Straw Tote Bag', brand: '& Other Stories', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/a5a5c3117b-e552b0101625253f2e63.png', price: '$65', description: 'Natural woven straw tote', isWishlisted: true }, { id: 'p3', name: 'Canvas Sneakers', brand: 'Veja', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/5f3cd8d80d-86184dd368f92c3bd86a.png', price: '$145', description: 'Eco-friendly white canvas sneakers', isWishlisted: false }] },
                        { id: 'work-week-essentials', name: 'Work Week Essentials', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/8659f0c5b4-129fa679de97277a8ff7.png', description: 'Professional power looks that work', itemCount: 12, priceRange: '$180-420', saves: '3.4k saves', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/7e094a771c-f075ee55c692dad6fbaa.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/1c28bc4fa5-25ed7e84931d74632079.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/c04fdb7242-ad37b9466fca9d34e8f1.png'], products: [{ id: 'pw1', name: 'Tailored Blazer', brand: 'Theory', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/7e094a771c-f075ee55c692dad6fbaa.png', price: '$425', description: 'Classic wool blend blazer', isWishlisted: true }, { id: 'pw2', name: 'Pencil Skirt', brand: 'Mango', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/1c28bc4fa5-25ed7e84931d74632079.png', price: '$59', description: 'High-waisted midi skirt', isWishlisted: false }, { id: 'pw3', name: 'Leather Pumps', brand: 'Louboutin', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/c04fdb7242-ad37b9466fca9d34e8f1.png', price: '$695', description: 'Classic pointed-toe pumps', isWishlisted: false }] },
                        { id: 'weekend-vibes', name: 'Weekend Vibes', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/7548a2fc26-003182dbed84e59239c4.png', description: 'Comfort meets style for lazy days', itemCount: 9, priceRange: '$120-350', saves: '1.7k saves', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/fb74c3e09c-e22d29f07626188ecf2d.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/75d7e8ebca-2a477c8708f67ea2e382.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/78956b8b70-20fa3bc3a2fbce2bd9be.png'], products: [{ id: 'pwv1', name: 'Oversized Sweater', brand: 'Cos', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/fb74c3e09c-e22d29f07626188ecf2d.png', price: '$120', description: 'Soft cashmere blend sweater', isWishlisted: false }, { id: 'pwv2', name: 'Relaxed Jeans', brand: 'Levi\'s', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/75d7e8ebca-2a477c8708f67ea2e382.png', price: '$98', description: 'Comfortable straight-leg jeans', isWishlisted: false }] },
                        { id: 'date-night-ready', name: 'Date Night Ready', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/53ef8b8132-049359957a36dcc103c5.png', description: 'Perfect looks for romantic evenings', itemCount: 6, priceRange: '$160-480', saves: '2.8k saves', badge: 'Trending', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/1d822aec75-b3cb13c31948045b34c1.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/c62b5fd602-4418e43e7e210d817e4d.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/63796dc97b-18bf646be74a0bb7054b.png'], products: [{ id: 'pdn1', name: 'Silk Slip Dress', brand: 'Reformation', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/1d822aec75-b3cb13c31948045b34c1.png', price: '$248', description: 'Elegant silk midi dress', isWishlisted: false }, { id: 'pdn2', name: 'Strappy Heels', brand: 'Manolo Blahnik', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/c62b5fd602-4418e43e7e210d817e4d.png', price: '$695', description: 'Classic velvet strappy heels', isWishlisted: true }] },
                        { id: 'cozy-autumn', name: 'Cozy Autumn', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/ea3e1c57f0-1d936cba2f3573546cd6.png', description: 'Warm layers for cool weather', itemCount: 10, priceRange: '$200-450', saves: '1.9k saves', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/58b298509d-cf25dd6dfda4cd56355a.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/322530cf1c-244e616108e41af1a01d.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/39a090b30b-09685def17978820533b.png'], products: [{ id: 'pca1', name: 'Wool Coat', brand: 'Max Mara', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/58b298509d-cf25dd6dfda4cd56355a.png', price: '$1,890', description: 'Timeless camel wool coat', isWishlisted: false }, { id: 'pca2', name: 'Cashmere Scarf', brand: 'Brunello Cucinelli', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/322530cf1c-244e616108e41af1a01d.png', price: '$380', description: 'Ultra-soft cashmere scarf', isWishlisted: false }] },
                        { id: 'gym-to-street', name: 'Gym to Street', coverImage: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/9b3d5d941b-faf5ce469277c8f4e417.png', description: 'Athleisure that works everywhere', itemCount: 8, priceRange: '$90-280', saves: '1.5k saves', itemThumbnails: ['https://storage.googleapis.com/uxpilot-auth.appspot.com/5d9f33d68e-76a8812e7a28dfd02e56.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/8f40c3370c-26f47e7c045d12abb4bb.png','https://storage.googleapis.com/uxpilot-auth.appspot.com/ba7a1a70c7-f91c92fc3d6fe4ce7031.png'], products: [{ id: 'pgs1', name: 'Sports Bra', brand: 'Lululemon', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/5d9f33d68e-76a8812e7a28dfd02e56.png', price: '$58', description: 'High-support sports bra', isWishlisted: false }, { id: 'pgs2', name: 'Joggers', brand: 'Alo Yoga', image: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/8f40c3370c-26f47e7c045d12abb4bb.png', price: '$118', description: 'Seamless high-waist joggers', isWishlisted: true }] }
                    ]
                };
            }
            window.loadCreatorProfile(creatorData);

            // Auto-grow textarea (chat input) - expands with text, max 6 rows
            function setupAutoGrow(ta) {
                if (!ta) return;
                const rowH = () => { const lh = parseFloat(getComputedStyle(ta).lineHeight); return Number.isFinite(lh) ? lh : 20; };
                const autoResize = () => {
                    ta.style.height = 'auto';
                    const h = Math.min(ta.scrollHeight, 6 * rowH());
                    ta.style.height = h + 'px';
                    ta.style.overflowY = ta.scrollHeight > 6 * rowH() ? 'auto' : 'hidden';
                };
                ta.addEventListener('input', autoResize);
                autoResize();
            }
            setupAutoGrow(document.getElementById('message-input'));
            setupAutoGrow(document.getElementById('chat-input-drawer-field'));

            const chatDrawer = document.getElementById('shai-chat-drawer');
            const chatOverlay = document.getElementById('chat-overlay');
            const chatInputBar = document.getElementById('chat-input-bar');
            const messageInput = document.getElementById('message-input');
            const chatInputDrawerField = document.getElementById('chat-input-drawer-field');
            const sendBtnDrawer = document.getElementById('send-btn-drawer');
            const micBtnDrawer = document.getElementById('mic-btn-drawer');
            const addFriendBtnDrawer = document.getElementById('add-friend-btn-drawer');
            const chatContent = document.getElementById('chat-content');
            const dragHandle = document.getElementById('drag-handle');
            const addFriendBtn = document.getElementById('add-friend-btn');
            const backButton = document.getElementById('back-button');
            const headerTitle = document.getElementById('header-title');
            const headerSubtitle = document.getElementById('header-subtitle');
            const chatMessages = document.getElementById('chat-messages');
            const addFriendContent = document.getElementById('add-friend-content');
            function scrollChatToBottom() { if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight; }
            const contactSearch = document.getElementById('contact-search');
            const contactsContainer = document.getElementById('contacts-container');
            const sendBtn = document.getElementById('send-btn');

            // Add Friend contacts: dynamic. Same pattern as Home.
            // GoShopMe user + avatar -> photo; GoShopMe user without avatar -> initials; non-GoShopMe -> initials
            window.__addFriendContacts = window.__addFriendContacts || [
                { name: 'Alex Johnson', phone: '+1 (555) 123-4567', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg' },
                { name: 'Maria Rodriguez', phone: '+1 (555) 987-6543', goshopme: false },
                { name: 'Sarah Chen', phone: '+1 (555) 456-7890', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-6.jpg' },
                { name: 'John Davis', phone: '+1 (555) 321-0987', goshopme: false },
                { name: 'Mike Thompson', phone: '+1 (555) 654-3210', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-8.jpg' },
                { name: 'Emma Wilson', phone: '+1 (555) 345-6789', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-5.jpg' },
                { name: 'David Kim', phone: '+1 (555) 111-2222', goshopme: true },
                { name: 'Lisa Chen', phone: '+1 (555) 555-1234', goshopme: true }
            ];
            function getInitials(name) {
                const parts = (name || '').trim().split(/\s+/);
                if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
                return (parts[0] ? parts[0].slice(0, 2) : '??').toUpperCase();
            }
            function renderAddFriendContacts(container) {
                if (!container) return;
                const list = Array.isArray(window.__addFriendContacts) ? window.__addFriendContacts : [];
                container.innerHTML = list.map(c => {
                    const initials = getInitials(c.name);
                    const hasAvatar = c.goshopme && c.avatar;
                    const avatarHtml = hasAvatar
                        ? `<div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0"><img src="${c.avatar}" alt="${(c.name || '').replace(/"/g, '&quot;')}" class="w-full h-full object-cover"></div>`
                        : `<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-600 font-medium text-xs">${initials}</span></div>`;
                    const btnHtml = c.goshopme
                        ? '<button class="contact-action bg-[#939BFB] text-white px-2 py-1 rounded-full text-xs font-medium">Add</button>'
                        : '<button class="contact-action bg-white text-[#939BFB] px-2 py-1 rounded-full text-xs font-medium border border-[#939BFB]">Invite</button>';
                    return `<div class="contact-item flex items-center gap-2 p-2 bg-gray-50 rounded-xl" data-name="${(c.name || '').replace(/"/g, '&quot;')}" data-phone="${(c.phone || '').replace(/"/g, '&quot;')}" data-goshopme="${c.goshopme ? 'true' : 'false'}">${avatarHtml}<div class="flex-1"><p class="font-medium text-sm text-black">${(c.name || '').replace(/</g, '&lt;')}</p><p class="text-xs text-gray-500">${(c.phone || '').replace(/</g, '&lt;')}</p></div>${btnHtml}</div>`;
                }).join('');
            }
            window.loadAddFriendContacts = function(data) {
                window.__addFriendContacts = Array.isArray(data) ? data : [];
                renderAddFriendContacts(contactsContainer);
            };
            renderAddFriendContacts(contactsContainer);
            const micBtn = document.getElementById('mic-btn');
            
            let isDrawerExpanded = false;
            let currentView = 'chat';
            
            chatDrawer.classList.add('translate-y-full');
            chatOverlay.classList.add('hidden');

            // Drag handle - resize drawer; drag down past 30vh to close fully (match Home)
            let startY = 0, currentHeight = 80, isDragging = false;
            const CLOSE_THRESHOLD = 30;
            function getClientY(e) { return e.touches ? e.touches[0].clientY : e.clientY; }
            if (dragHandle) {
                dragHandle.addEventListener('touchstart', (e) => { isDragging = true; startY = e.touches[0].clientY; });
                dragHandle.addEventListener('mousedown', (e) => { isDragging = true; startY = e.clientY; });
            }
            function handleDragMove(e) {
                if (!isDragging) return;
                const clientY = getClientY(e);
                const deltaY = startY - clientY;
                startY = clientY;
                currentHeight = Math.min(90, Math.max(0, currentHeight + (deltaY / window.innerHeight) * 100));
                chatDrawer.style.height = currentHeight + 'vh';
            }
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('touchmove', (e) => {
                if (isDragging) { e.preventDefault(); handleDragMove(e); }
            }, { passive: false });
            function handleDragEnd() {
                if (!isDragging) return;
                isDragging = false;
                const h = (chatDrawer.getBoundingClientRect().height / window.innerHeight) * 100;
                if (h < CLOSE_THRESHOLD) {
                    collapseDrawer();
                } else {
                    currentHeight = Math.max(35, Math.min(90, h));
                    chatDrawer.style.height = currentHeight + 'vh';
                }
            }
            document.addEventListener('mouseup', handleDragEnd);
            document.addEventListener('touchend', handleDragEnd);
            document.addEventListener('touchcancel', handleDragEnd);

            // Collapse drawer via overlay only (no drawer-toggle button)
            chatOverlay.addEventListener('click', collapseDrawer);

            // Collection chat triggers (event delegation - use capture so we run before card's onclick)
            window.currentChatCollection = null;
            function handleChatTrigger(e) {
                const trigger = e.target.closest('.chat-trigger');
                if (!trigger) return;
                e.preventDefault();
                e.stopPropagation();
                const collectionName = trigger.dataset.collection || '';
                if (!collectionName) return;
                if (!isDrawerExpanded) expandDrawer();
                window.currentChatCollection = collectionName;
                const col = (window.__creatorCollections || []).find(c => (c.name || '') === collectionName);
                const thumbs = (col && col.itemThumbnails && col.itemThumbnails.length) ? col.itemThumbnails.slice(0, 4) : (col && col.coverImage ? [col.coverImage] : []);
                const cnt = chatMessages.querySelector('.p-4');
                if (cnt) {
                    const contextMessage = document.createElement('div');
                    contextMessage.className = 'flex items-start space-x-3 mb-4';
                    const avatarUrl = window.__shaiAvatarUrl || (document.getElementById('shai-avatar') || {}).src || SHAI_AVATAR_DEFAULT;
                    const avatarHtml = `<img class="w-8 h-8 rounded-full object-cover flex-shrink-0" src="${(avatarUrl || '').replace(/"/g, '&quot;')}" alt="ShAI avatar" data-shai-avatar>`;
                    const thumbHtml = thumbs.length ? '<div class="flex gap-1.5 mt-2 flex-wrap">' + thumbs.slice(0, 4).map((t) => '<img class="w-12 h-12 rounded-lg object-cover border border-gray-200" src="' + (t || '').replace(/"/g, '&quot;') + '" alt="">').join('') + '</div>' : '';
                    contextMessage.innerHTML = avatarHtml + `<div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 max-w-xs"><p class="text-sm text-black">Want the entire "${collectionName}" look? I'll help you shop it!</p>${thumbHtml}</div>`;
                    cnt.appendChild(contextMessage);
                    scrollChatToBottom();
                }
            }
            document.addEventListener('click', handleChatTrigger, true);
            document.addEventListener('touchend', handleChatTrigger, true);

            function showAddFriendFlow() {
                currentView = 'add-friend';
                chatContent.classList.add('hidden');
                addFriendContent.classList.remove('hidden');
                backButton.classList.remove('hidden');
                headerTitle.textContent = 'Add Friend';
                headerSubtitle.textContent = 'Choose contacts to add';
                expandDrawer();
            }

            function hideAddFriendFlow() {
                currentView = 'chat';
                chatContent.classList.remove('hidden');
                addFriendContent.classList.add('hidden');
                backButton.classList.add('hidden');
                headerTitle.textContent = 'ShAI';
                headerSubtitle.textContent = 'Your shopping assistant';
                if (contactSearch) contactSearch.value = '';
                filterContacts('');
            }

            function filterContacts(term) {
                const items = contactsContainer ? contactsContainer.querySelectorAll('.contact-item') : [];
                const t = (term || '').toLowerCase();
                items.forEach(el => {
                    const match = ((el.getAttribute('data-name') || '') + (el.getAttribute('data-phone') || '')).toLowerCase().includes(t);
                    el.style.display = match ? 'flex' : 'none';
                });
            }

            addFriendBtn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); if (!isDrawerExpanded) expandDrawer(); setTimeout(showAddFriendFlow, 300); });
            addFriendBtnDrawer.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); showAddFriendFlow(); });
            backButton.addEventListener('click', hideAddFriendFlow);

            // === Camera button - open native file picker for images/videos ===
            function handleCameraAccess() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,video/*';
                input.onchange = (e) => {
                    const file = e.target.files && e.target.files[0];
                    if (file) handleFileSelection(file);
                    input.value = '';
                };
                input.click();
            }
            function handleFileSelection(file) {
                const url = URL.createObjectURL(file);
                const cnt = chatMessages.querySelector('.p-4');
                if (!cnt) return;
                let bubble;
                if (file.type.startsWith('image/')) {
                    bubble = document.createElement('div');
                    bubble.className = 'flex justify-end mb-4';
                    bubble.innerHTML = '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><img src="' + url + '" class="w-full h-auto" alt="Uploaded image"></div>';
                } else if (file.type.startsWith('video/')) {
                    bubble = document.createElement('div');
                    bubble.className = 'flex justify-end mb-4';
                    bubble.innerHTML = '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden relative"><video src="' + url + '" controls class="w-full h-auto"></video></div>';
                }
                if (bubble) {
                    cnt.appendChild(bubble);
                    scrollChatToBottom();
                    setTimeout(() => {
                        const ai = document.createElement('div');
                        ai.className = 'flex items-start space-x-3 mb-4';
                        const avatarUrl = window.__shaiAvatarUrl || (document.getElementById('shai-avatar') || {}).src || SHAI_AVATAR_DEFAULT;
                        const avatarHtml = '<img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="' + (avatarUrl || '').replace(/"/g, '&quot;') + '" alt="ShAI" data-shai-avatar>';
                        ai.innerHTML = avatarHtml + '<div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">' + (file.type.startsWith('video/') ? 'Great! I can analyze your video. Let me find products that match what I see.' : 'Perfect! I can see your image. Let me analyze it and find similar products for you.') + '</p></div></div>';
                        cnt.appendChild(ai);
                        scrollChatToBottom();
                    }, 1500);
                }
            }
            [document.getElementById('cam-btn'), document.getElementById('cam-btn-drawer')].forEach(btn => {
                if (!btn) return;
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (chatDrawer.classList.contains('translate-y-full')) { expandDrawer(); setTimeout(handleCameraAccess, 300); }
                    else handleCameraAccess();
                });
            });

            // === Voice recording - hold to record, swipe left to cancel (match Home) ===
            let isRecording = false, mediaRecorder, audioChunks = [], startX, micAccessDenied = false, mediaStream = null;
            function removeTempRecordingBubble() { const t = document.getElementById('temp-recording'); if (t) t.remove(); }
            async function startRecording(e) {
                e.preventDefault();
                removeTempRecordingBubble();
                if (!isDrawerExpanded) { expandDrawer(); return; }
                if (micAccessDenied) { alert('Microphone access denied. Enable it in your browser settings.'); return; }
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                try {
                    if (!mediaStream || !mediaStream.active) mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(mediaStream);
                    isRecording = true;
                    audioChunks = [];
                    mediaRecorder.ondataavailable = ev => { if (ev.data.size > 0) audioChunks.push(ev.data); };
                    mediaRecorder.start();
                    this.classList.add('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        const tb = document.createElement('div');
                        tb.id = 'temp-recording';
                        tb.className = 'flex justify-end mb-2';
                        tb.innerHTML = '<div class="flex items-center bg-[#939BFB] text-white rounded-2xl px-3 py-2 max-w-[70%] shadow-sm animate-pulse"><svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg><span class="text-xs font-medium">Recording... swipe left to cancel</span></div>';
                        cnt.appendChild(tb);
                        scrollChatToBottom();
                    }
                } catch (err) {
                    removeTempRecordingBubble();
                    if (err && (err.name === 'NotAllowedError' || err.name === 'SecurityError')) { micAccessDenied = true; alert('Microphone access denied.'); }
                }
            }
            function stopRecording(e) {
                e.preventDefault();
                if (!isRecording) return;
                isRecording = false;
                this.classList.remove('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                removeTempRecordingBubble();
                if (mediaRecorder) {
                    mediaRecorder.stop();
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(audioChunks, { type: 'audio/webm' });
                        renderAudioBubble(URL.createObjectURL(blob));
                    };
                }
            }
            function cancelRecording(e) {
                if (!isRecording) return;
                isRecording = false;
                this.classList.remove('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                removeTempRecordingBubble();
                if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
            }
            function handleSwipeCancel(e) {
                if (!isRecording || !e.touches || !e.touches.length) return;
                if (startX - e.touches[0].clientX > 30) cancelRecording.call(this, e);
            }
            function renderAudioBubble(url) {
                const cnt = chatMessages.querySelector('.p-4');
                if (!cnt) return;
                const bubble = document.createElement('div');
                bubble.className = 'flex justify-end mb-2';
                bubble.innerHTML = '<div role="group" aria-label="Voice message from you" class="voice-message-bubble bg-[#939BFB] text-white rounded-full px-3 py-2 flex items-center gap-2 h-11 shadow-sm"><button aria-label="Play" class="play-btn flex-shrink-0 w-6 h-6 border border-white rounded-full flex items-center justify-center hover:bg-white/20"><svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button><div class="waveform flex-1 flex items-center justify-center gap-0.5 h-4 max-w-[120px]"><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:8px;--i:0"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:12px;--i:1"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:6px;--i:2"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:16px;--i:3"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:10px;--i:4"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:14px;--i:5"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:8px;--i:6"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:12px;--i:7"></div></div><span class="duration-text text-white/90 text-xs font-medium flex-shrink-0">0:00</span><audio src="' + url + '" preload="auto" class="hidden"></audio></div>';
                cnt.appendChild(bubble);
                const audio = bubble.querySelector('audio');
                const durationText = bubble.querySelector('.duration-text');
                audio.addEventListener('loadedmetadata', () => { const d = Math.ceil(audio.duration); durationText.textContent = Math.floor(d/60) + ':' + String(d%60).padStart(2,'0'); });
                scrollChatToBottom();
                setTimeout(() => {
                    if (!cnt) return;
                    const ai = document.createElement('div');
                    ai.className = 'flex items-start space-x-3 mb-4';
                    const avatarUrl = window.__shaiAvatarUrl || (document.getElementById('shai-avatar') || {}).src || SHAI_AVATAR_DEFAULT;
                    const avatarHtml = '<img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="' + (avatarUrl || '').replace(/"/g, '&quot;') + '" alt="ShAI" data-shai-avatar>';
                    ai.innerHTML = avatarHtml + '<div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">Got your voice message! I\'m on it &mdash; let me find the best options for you.</p></div></div>';
                    cnt.appendChild(ai);
                    scrollChatToBottom();
                }, 800);
            }
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.voice-message-bubble .play-btn');
                if (!btn) return;
                e.preventDefault();
                const container = btn.closest('.voice-message-bubble');
                const audio = container ? container.querySelector('audio') : null;
                if (!audio) return;
                const playIcon = btn.querySelector('svg');
                const waveBars = container.querySelectorAll('.wave-bar');
                const durationText = container.querySelector('.duration-text');
                if (audio.paused) {
                    audio.play();
                    playIcon.innerHTML = '<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>';
                    waveBars.forEach((b,i) => { b.style.animation = 'wavePulse 1.1s ease-in-out infinite'; b.style.animationDelay = (i*0.08)+'s'; });
                    audio.addEventListener('timeupdate', () => { const r = Math.ceil(audio.duration - audio.currentTime); durationText.textContent = Math.floor(r/60)+':'+String(r%60).padStart(2,'0'); });
                    audio.addEventListener('ended', () => { playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>'; waveBars.forEach(b => { b.style.animation = 'none'; }); const d = Math.ceil(audio.duration); durationText.textContent = Math.floor(d/60)+':'+String(d%60).padStart(2,'0'); });
                } else { audio.pause(); playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>'; waveBars.forEach(b => { b.style.animation = 'none'; }); }
            });
            [micBtn, micBtnDrawer].forEach(btn => {
                if (!btn) return;
                btn.addEventListener('mousedown', startRecording);
                btn.addEventListener('touchstart', startRecording);
                btn.addEventListener('mouseup', stopRecording);
                btn.addEventListener('mouseleave', cancelRecording);
                btn.addEventListener('touchend', stopRecording);
                btn.addEventListener('touchcancel', cancelRecording);
                btn.addEventListener('touchmove', handleSwipeCancel);
            });

            // Set ShAI avatar from DB or assets (call window.setShAIAvatar(url) when loaded)
            var SHAI_AVATAR_DEFAULT = '../assets/shai-avatar.png';
            window.__shaiAvatarUrl = window.__shaiAvatarUrl || SHAI_AVATAR_DEFAULT;
            window.setShAIAvatar = function(url) {
                var u = url || SHAI_AVATAR_DEFAULT;
                window.__shaiAvatarUrl = u;
                document.querySelectorAll('[data-shai-avatar]').forEach(function(img) {
                    img.src = u;
                    img.style.display = '';
                    img.onerror = function() { this.style.display = 'none'; var ph = this.parentElement.querySelector('[id$="-placeholder"]'); if (ph) ph.classList.remove('hidden'); };
                });
                document.querySelectorAll('#shai-avatar-placeholder, #shai-msg-avatar-placeholder').forEach(function(ph) { ph.classList.add('hidden'); });
            };
            window.setShAIAvatar(window.__shaiAvatarUrl);

            document.addEventListener('click', (e) => {
                if (!e.target.classList.contains('contact-action')) return;
                const item = e.target.closest('.contact-item');
                if (!item) return;
                const name = (item.querySelector('p') || {}).textContent || '';
                const isGoshopme = item.getAttribute('data-goshopme') === 'true';
                if (e.target.textContent === 'Add' && isGoshopme) {
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        const el = document.createElement('div');
                        el.className = 'flex justify-center mb-4';
                        el.innerHTML = '<div class="bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm">' + name.split(' ')[0] + ' has been added to chat</div>';
                        cnt.appendChild(el);
                        scrollChatToBottom();
                    }
                    hideAddFriendFlow();
                } else if (e.target.textContent === 'Invite') {
                    const d = { title: 'Join me on GoShopMe', text: "Hey! I'm using GoShopMe. It's faster, smarter and effortless — join me", url: 'https://app.goshopme.ai' };
                    if (navigator.share) navigator.share(d).catch(() => {}); else if (navigator.clipboard) navigator.clipboard.writeText(d.text + ' ' + d.url);
                    hideAddFriendFlow();
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        const el = document.createElement('div');
                        el.className = 'flex justify-center mb-4';
                        el.innerHTML = '<div class="bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm">' + name.split(' ')[0] + ' has been invited to GoShopMe</div>';
                        cnt.appendChild(el);
                        scrollChatToBottom();
                    }
                }
            });

            if (contactSearch) contactSearch.addEventListener('input', e => filterContacts(e.target.value));

            messageInput.addEventListener('focus', () => {
                if (!isDrawerExpanded) { expandDrawer(); setTimeout(() => chatInputDrawerField.focus(), 300); }
            });

            function expandDrawer() {
                chatDrawer.classList.remove('translate-y-full');
                chatOverlay.classList.remove('hidden');
                chatInputBar.classList.add('hidden');
                chatDrawer.style.height = '80vh';
                currentHeight = 80;
                isDrawerExpanded = true;
            }

            function collapseDrawer() {
                chatDrawer.classList.add('translate-y-full');
                chatOverlay.classList.add('hidden');
                chatInputBar.classList.remove('hidden');
                currentHeight = 80;
                isDrawerExpanded = false;
                if (currentView === 'add-friend') hideAddFriendFlow();
            }

            // Add click on main content to collapse drawer
            document.getElementById('background-content').addEventListener('click', () => {
                if (isDrawerExpanded) {
                    collapseDrawer();
                }
            });

            function updateInputState(inputEl, mic, addFriend, send) {
                const hasText = inputEl && inputEl.value.trim().length > 0;
                if (mic) mic.classList.toggle('hidden', hasText);
                if (addFriend) addFriend.classList.toggle('hidden', hasText);
                if (send) send.classList.toggle('hidden', !hasText);
            }

            function sendMessage(inputField, sendButton, micButton, addFriendBtnRef) {
                const message = inputField.value.trim();
                if (!message) return;
                const cnt = chatMessages.querySelector('.p-4');
                if (cnt) {
                    const wrap = document.createElement('div');
                    wrap.className = 'flex justify-end mb-4';
                    wrap.innerHTML = '<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%]"><p class="text-sm break-words whitespace-pre-wrap"></p></div>';
                    wrap.querySelector('p').textContent = message;
                    cnt.appendChild(wrap);
                    scrollChatToBottom();
                    setTimeout(() => {
                        const ai = document.createElement('div');
                        ai.className = 'flex items-start space-x-3 mb-4';
                        const avatarUrl = window.__shaiAvatarUrl || (document.getElementById('shai-avatar') || {}).src || SHAI_AVATAR_DEFAULT;
                        const avatarHtml = '<img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="' + (avatarUrl || '').replace(/"/g, '&quot;') + '" alt="ShAI" data-shai-avatar>';
                        ai.innerHTML = avatarHtml + '<div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">Perfect! I\'ll show you the items from that collection that match your style and size.</p></div></div>';
                        cnt.appendChild(ai);
                        scrollChatToBottom();
                    }, 1000);
                }
                inputField.value = '';
                inputField.dispatchEvent(new Event('input'));
                updateInputState(inputField, micButton, addFriendBtnRef, sendButton);
            }

            chatInputDrawerField.addEventListener('input', () => updateInputState(chatInputDrawerField, micBtnDrawer, addFriendBtnDrawer, sendBtnDrawer));
            messageInput.addEventListener('input', () => updateInputState(messageInput, micBtn, addFriendBtn, sendBtn));

            chatInputDrawerField.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(chatInputDrawerField, sendBtnDrawer, micBtnDrawer, addFriendBtnDrawer); } });
            messageInput.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(messageInput, sendBtn, micBtn, addFriendBtn); } });

            sendBtnDrawer.addEventListener('click', () => sendMessage(chatInputDrawerField, sendBtnDrawer, micBtnDrawer, addFriendBtnDrawer));
            sendBtn.addEventListener('click', () => { sendMessage(messageInput, sendBtn, micBtn, addFriendBtn); if (!isDrawerExpanded) expandDrawer(); });

            updateInputState(messageInput, micBtn, addFriendBtn, sendBtn);
            updateInputState(chatInputDrawerField, micBtnDrawer, addFriendBtnDrawer, sendBtnDrawer);

            // Smart prompt chip functionality
            document.querySelectorAll('#smart-prompts button').forEach(button => {
                button.addEventListener('click', () => {
                    const userMessage = document.createElement('div');
                    userMessage.className = 'flex justify-end mb-4';
                    userMessage.innerHTML = '<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%]"><p class="text-sm">' + button.textContent + '</p></div>';
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        cnt.appendChild(userMessage);
                        scrollChatToBottom();
                        setTimeout(() => {
                            const aiResponse = document.createElement('div');
                            aiResponse.className = 'flex items-start space-x-3 mb-4';
                            const avatarUrl = window.__shaiAvatarUrl || (document.getElementById('shai-avatar') || {}).src || SHAI_AVATAR_DEFAULT;
                            const avatarHtml = '<img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="' + (avatarUrl || '').replace(/"/g, '&quot;') + '" alt="ShAI" data-shai-avatar>';
                            aiResponse.innerHTML = avatarHtml + '<div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">Great choice! Let me help you with that collection.</p></div></div>';
                            cnt.appendChild(aiResponse);
                            scrollChatToBottom();
                        }, 800);
                    }
                });
            });

        });
    </script>

</body>
</html>


