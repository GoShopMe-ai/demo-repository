<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <title>Wishlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shine-primary': '#939BFB',
                        'shine-accent': '#F96226'
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/heroicons@2.0.16/24/outline/index.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Karla:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/chat-drawer-drag.css">
    <style>
        
/* ---- MOBILE FULL-WIDTH OVERRIDE (match Home) ---- */
@media screen and (max-width: 768px) {
  #app-shell, #main-content, #auth-screen, #welcome_screen, #quiz-screen, #onboarding-screen,
  #bottom-nav, #bottom-navigation, #header, #app-header,
  #chat-drawer, #chat-input-bar, #shai-chat-drawer, #return-chat-drawer, #return-chat-input-bar, #chat-input-collapsed,
  #shai-chat-drawer-wrapper, #chat-drawer-wrapper,
  body > div:not(#chat-overlay):not(#chat-drawer):not(#chat-input-bar):not(#shai-chat-drawer), body > main {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  [class*="left-1/2"][class*="-translate-x-1/2"]:not([class*="rounded-full"]) {
    left: 0 !important;
    right: 0 !important;
    max-width: 100vw !important;
    width: 100% !important;
    transform: none !important;
  }
  #chat-drawer.translate-y-full, #shai-chat-drawer.translate-y-full, #return-chat-drawer.translate-y-full {
    transform: translateY(100%) !important;
  }
  #bottom-nav > div, #bottom-navigation > div, nav#bottom-nav > div, nav#bottom-navigation > div {
    padding-top: 2px !important;
    padding-bottom: 24px !important;
  }
}

/* Chat drawer and input bar: dock above bottom nav (chat-dock-nav.js sets --shai-nav-h) */
        #chat-drawer, #chat-input-bar {
          bottom: var(--shai-nav-h, 72px) !important;
        }
        /* Chat drawer: prevent scroll leaking (match Home) */
        #chat-drawer {
          overscroll-behavior: contain;
          -webkit-overflow-scrolling: touch;
        }
        #chat-messages {
          overscroll-behavior: contain;
          -webkit-overflow-scrolling: touch;
        }
        #drag-handle-zone, .chat-drawer-drag-zone {
          touch-action: none;
          -webkit-user-select: none;
          user-select: none;
        }
        #chat-drawer {
          max-height: calc(100dvh - 144px) !important;
        }

::-webkit-scrollbar { display: none;}
        * { 
            font-family: 'DM Sans', 
                         'Karla',
                         -apple-system,
                         BlinkMacSystemFont,
                         'Segoe UI',
                         Roboto,
                         'Helvetica Neue',
                         Arial,
                         'Noto Sans',
                         sans-serif; 
        }

        .dm-sans { 
            font-family: 'DM Sans', 
                         'Karla',
                         -apple-system,
                         BlinkMacSystemFont,
                         'Segoe UI',
                         Roboto,
                         'Helvetica Neue',
                         Arial,
                         'Noto Sans',
                         sans-serif; 
        }

        .poppins { 
            font-family: 'Poppins',
                         -apple-system,
                         BlinkMacSystemFont,
                         'Segoe UI',
                         Roboto,
                         'Helvetica Neue',
                         Arial,
                         sans-serif; 
        }
        
        .container-mobile { max-width: 390px; width: 100%; margin-left: auto; margin-right: auto; }
        
        /* Icon styling */
        .icon-button svg {
            width: 18px;
            height: 18px;
            stroke-width: 1.5;
        }
        
        .icon-button:hover svg {
            color: #939BFB;
        }
        
        .icon-button.white svg {
            color: #FFF;
        }
        
        /* Bottom nav styling */
        .bottom-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #6B7280;
            transition: color 0.2s ease-in-out;
        }
        
        .bottom-nav-btn:hover,
        .bottom-nav-btn.active {
            color: #939BFB;
        }
        
        .bottom-nav-btn:hover svg,
        .bottom-nav-btn:hover span,
        .bottom-nav-btn.active svg,
        .bottom-nav-btn.active span {
            color: #939BFB;
        }

        .bottom-nav-btn svg {
            width: 20px;
            height: 20px;
            stroke-width: 1.5;
            margin-bottom: 4px;
        }
        
        /* Wishlist heart filled state */
        .heart-filled {
            fill: #939BFB !important;
            stroke: #939BFB !important;
        }
        
        /* Voice recording state */
        .recording {
            background: #ef4444 !important;
            color: white !important;
        }
        
        /* Chat message bubbles */
        .voice-message-bubble {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border-radius: 16px;
            max-width: 80%;
            min-width: 140px;
            max-width: 260px;
            width: fit-content;
        }
        
        .voice-message-outgoing {
            background: #939BFB;
            color: white;
            margin-left: auto;
        }
        
        .voice-message-incoming {
            background: #f3f4f6;
            color: #000;
        }
        
        .product-bubble {
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 16px;
            padding: 12px;
            max-width: 60%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .product-bubble.outgoing {
            border-color: #939BFB;
            margin-left: auto;
        }

        /* Wishlist product tiles: pointer cursor (desktop), touch-optimized (mobile) */
        [id^="wishlist-item-"] { cursor: pointer; touch-action: manipulation; -webkit-tap-highlight-color: rgba(147, 155, 251, 0.12); }
        
        /* Share button - Instagram-style tilted paper plane */
        .share-icon-tilted {
            transform: rotate(-35deg);
        }
        .product-overlay-icon {
            /* Plain white icons - Instagram style */
        }
        /* Subtle dark overlay on product images for icon contrast (esp. on light backgrounds) */
        .product-image-overlay-wrap::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.08);
            pointer-events: none;
            z-index: 0;
        }
        .product-image-overlay-wrap > [class*="absolute"][class*="top-"] { z-index: 1; }
        
        /* Wave pulse animation for voice messages */
        @keyframes wavePulse {
            0%, 100% { 
                transform: scaleY(0.5); 
            }
            50% { 
                transform: scaleY(1.0); 
            }
        }

        .wave-bar.playing {
            animation: wavePulse 1.1s ease-in-out infinite;
            animation-delay: calc(var(--i) * 0.08s);
        }
        
        .voice-message-bubble {
            min-width: 140px;
            max-width: 260px;
            width: fit-content;
        }
        .header-icon-btn { transition: transform 0.2s ease, color 0.2s ease; }
        .header-icon-btn:hover { transform: translateY(-2px); }
        @media screen and (max-width: 768px) {
            #chat-drawer, #chat-input-bar {
                left: 0 !important; right: 0 !important;
                max-width: 100vw !important; width: 100% !important;
            }
            #chat-drawer { max-height: calc(100dvh - 144px) !important; overscroll-behavior: contain; }
            #chat-drawer.translate-y-full { transform: translateY(100%) !important; }
            #bottom-navigation > div > div, #bottom-navigation > div {
                padding-top: 2px !important; padding-bottom: 24px !important;
            }
            #chat-messages { overscroll-behavior: contain; }
        }
    </style>
</head>
<body class="bg-[#F6F6F6] dm-sans">

<div id="app-shell" class="relative mx-auto w-full max-w-[390px] bg-white min-h-screen dm-sans">
    <!-- App Header -->
    <header id="app-header" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white z-50 border-b border-gray-100">
        <div class="relative flex items-center justify-between px-4 py-3">
            <span class="w-20 h-10 flex-shrink-0"></span>
            <h1 class="absolute left-0 right-0 text-center text-lg font-semibold poppins text-gray-900 pointer-events-none">My Wishlist</h1>
            <div class="relative z-10 flex items-center gap-0">
                <a href="Notifications_Screen.html?from=wishlist" id="wishlist-notif-btn" class="header-icon-btn w-10 h-10 flex items-center justify-center relative overflow-visible text-gray-600 hover:text-gray-800" aria-label="Notifications">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                    </svg>
                </a>
                <a href="Shopping_bag.html?from=wishlist" id="wishlist-cart-btn" class="header-icon-btn w-10 h-10 flex items-center justify-center relative overflow-visible text-gray-600 hover:text-gray-800" aria-label="Shopping bag">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993z" />
                    </svg>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main id="main-content" class="pt-14 pb-40 relative w-full max-w-[390px] mx-auto bg-white overflow-y-auto">
        
        <!-- Background Content - Wishlist -->
        <div id="background-content" class="min-h-screen bg-white">
            
            <!-- Wishlist Hero: full width of main, flush with header -->
            <section id="wishlist-sharing-block" class="w-full pt-0 pb-6 border-b border-gray-100">
                <div class="relative w-full min-h-[140px] text-center overflow-hidden">
                    <!-- Background Hero Image -->
                    <div class="absolute inset-0 overflow-hidden">
                        <img class="w-full h-full object-cover" src="" data-wishlist-hero-image alt="" />
                        <div class="absolute inset-0 bg-black/50"></div>
                    </div>
                    
                    <!-- Content -->
                    <div class="relative z-10 flex flex-col items-center justify-center p-4 min-h-[140px]">
                        <h3 class="text-lg poppins font-bold text-white mb-2">Turn your wishlist into a gift list</h3>
                        <p class="text-sm text-white/90 mb-4">Send your wishlist to friends or family, and let them shop the items you truly love — for birthdays, holidays or just because.</p>
                        <button id="share-wishlist-btn" class="bg-[#939BFB] text-white px-4 py-2.5 rounded-full font-medium text-sm hover:bg-[#939BFB]/90 transition-colors flex items-center justify-center space-x-2 mx-auto">
                            <span>Share My Wishlist</span>
                            <svg class="w-4 h-4 transform -rotate-45" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Wishlist Items Section -->
            <section id="wishlist-items" class="pt-6 pb-8 px-4">
                <div class="container-mobile">
                    <h2 class="text-lg poppins font-bold text-black mb-4">Your Items (<span data-wishlist-count>0</span>)</h2>
                    
                    <!-- Wishlist Items Grid -->
                    <!-- Product items are rendered dynamically from data/wishlist.json (or fallback) -->
                    <div class="grid grid-cols-2 gap-4" id="wishlist-items-grid">
                        <!-- Items injected by renderWishlistGrid() -->
                    </div>
                </div>
            </section>

        </div>

    </main>

    <!-- Chat overlay and drawer (match Home - before nav) -->
    <div id="chat-overlay" class="fixed inset-0 bg-black/40 z-40 hidden"></div>
    <div id="chat-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white rounded-t-3xl shadow-2xl z-50 h-[50vh] transform transition-transform duration-300 flex flex-col border-t border-gray-100">
        <div id="drag-handle-zone" class="chat-drawer-drag-zone flex justify-center pt-2 flex-shrink-0">
            <div id="drag-handle" class="w-10 h-1 bg-gray-300 rounded-full pointer-events-none"></div>
        </div>
        <div id="chat-header" class="flex items-center p-4 pb-2 flex-shrink-0">
            <button id="back-btn" class="mr-3 hidden hover:opacity-70 transition-opacity">
                <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>
                </svg>
            </button>
            <div class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0">
                <img class="w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI avatar" data-shai-avatar />
            </div>
            <div class="flex-1">
                <p class="font-semibold text-black text-sm" id="header-title">ShAI</p>
                <p class="text-xs text-gray-500" id="header-subtitle">Your shopping assistant</p>
            </div>
        </div>
        <div id="chat-content" class="flex-1 flex flex-col min-h-0">
            <div id="chat-messages" class="flex-1 overflow-y-auto">
                <div class="p-4 pb-0">
                    <div class="flex items-start space-x-3 mb-4">
                        <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                            <img class="w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI avatar" data-shai-avatar />
                        </div>
                        <div class="flex-1">
                            <div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 mb-3">
                                <p class="text-sm text-black">I see you have some amazing items in your wishlist! Need help styling any of these pieces or finding alternatives?</p>
                            </div>
                            <div id="smart-prompts" class="flex-shrink-0">
                                <div class="flex flex-wrap gap-2 pb-2">
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Find me alternatives under $100</button>
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Style with a bag</button>
                                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Show me outfit ideas</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chat-input-drawer" class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
                <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                    <button id="cam-btn-drawer" class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
                        </svg>
                    </button>
                    <input type="text" id="chat-input-drawer-field" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans min-h-[24px]">
                    <button id="add-friend-btn-drawer" class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/>
                        </svg>
                    </button>
                    <button id="mic-btn-drawer" class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                    <button id="send-btn-drawer" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="add-friend-content" class="flex-1 flex flex-col min-h-0 hidden">
            <div id="contact-list" class="flex-1 overflow-y-auto p-4">
                <div class="mb-4">
                    <div class="relative">
                        <svg class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                        <input type="text" id="contact-search" placeholder="Search contacts..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pl-10 text-sm">
                    </div>
                </div>
                <div id="contacts-container" class="space-y-2"></div>
            </div>
            <div id="add-friend-input" class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
                <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                    <button class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
                        </svg>
                    </button>
                    <input type="text" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans min-h-[24px]">
                    <button class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/>
                        </svg>
                    </button>
                    <button class="icon-button hover:opacity-70 transition-opacity">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav id="bottom-navigation" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 z-50">
        <div>
            <div class="flex items-center justify-around py-2">
                <a href="Home.html" class="bottom-nav-btn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/>
                    </svg>
                    <span class="text-xs">Home</span>
                </a>
                <a href="Picks.html" class="bottom-nav-btn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/>
                    </svg>
                    <span class="text-xs">Picks</span>
                </a>
                <a href="Wishlist.html" class="bottom-nav-btn active">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/>
                    </svg>
                    <span class="text-xs">Wishlist</span>
                </a>
                <a id="wishlist-nav-profile-link" href="User_Profile_Free_Plan.html" class="bottom-nav-btn">
                    <span id="wishlist-nav-profile-icon" class="flex items-center justify-center w-6 h-6 mb-1 text-shine-primary">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                    </span>
                    <img id="wishlist-nav-profile-photo" class="w-6 h-6 rounded-full object-cover mb-1 hidden" src="" alt="Profile" data-profile-avatar>
                    <span class="text-xs">Profile</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Chat input bar (match Home - after nav, inside app-shell) -->
    <div id="chat-input-bar" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 p-4 z-30">
        <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
            <button id="cam-btn" class="icon-button hover:opacity-70 transition-opacity">
                <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
                </svg>
            </button>
            <input type="text" id="message-input" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans min-h-[24px]">
            <button id="add-friend-btn" class="icon-button hover:opacity-70 transition-opacity">
                <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/>
                </svg>
            </button>
            <button id="mic-btn" class="icon-button hover:opacity-70 transition-opacity">
                <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/>
                </svg>
            </button>
            <button id="send-btn" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
                <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<script src="js/chat-dock-nav.js"></script>
<script src="js/home-chat.js"></script>
<script>
// Bottom nav profile: show profile icon if no uploaded photo, else show saved photo from localStorage; Profile link = paid/free based on __userPlan
(function() {
    var plan = (localStorage.getItem('__userPlan') || '').toLowerCase();
    var profileHref = (plan === 'paid' || plan === 'true') ? 'User_Profile_Paid_Plan.html' : 'User_Profile_Free_Plan.html';
    var profileLink = document.getElementById('wishlist-nav-profile-link');
    if (profileLink) profileLink.href = profileHref;
    var saved = null;
    try { saved = localStorage.getItem('profilePhoto'); } catch (e) {}
    var img = document.getElementById('wishlist-nav-profile-photo');
    var icon = document.getElementById('wishlist-nav-profile-icon');
    if (img && icon) {
        if (saved) {
            img.src = saved;
            img.classList.remove('hidden');
            icon.classList.add('hidden');
        } else {
            img.src = '';
            img.classList.add('hidden');
            icon.classList.remove('hidden');
        }
    }
})();
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof window.populateShAIAvatar === 'function') window.populateShAIAvatar('https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png');
        // Open chat drawer by default at 50% height
        if (typeof window.__expandChatDrawer === 'function') window.__expandChatDrawer();
        const shareWishlistBtn = document.getElementById('share-wishlist-btn');

        if (shareWishlistBtn) shareWishlistBtn.addEventListener('click', () => {
            const shareData = {
                title: 'My GoShopMe Wishlist',
                text: "Check out my wishlist on GoShopMe! ðŸ‘€âœ¨",
                url: 'https://goshopme.ai/u/jane-doe/wishlist'
            };
            if (navigator.share) {
                navigator.share(shareData).catch((error) => console.error('Error sharing:', error));
            } else {
                alert('Sharing is not supported on this browser. You can copy the link instead.');
            }
        });

        // Add-friend, input bar click: handled by home-chat.js (it finds #chat-drawer and wires overlay, bar, etc.)
        // Chat triggers handled by setupProductTileButtons (document delegation with product thumbnail)

    function addContextualMessage(message, thumbUrls) {
        if (typeof window.addShAIMessage === 'function') {
            window.addShAIMessage(message, thumbUrls || []);
        }
    }

    window.addEventListener('beforeunload', function () { document.body.style.overflow = ''; });
    document.addEventListener('visibilitychange', function () {
        if (document.visibilityState === 'hidden') document.body.style.overflow = '';
    });
    document.addEventListener('visibilitychange', function () {
        if (document.visibilityState === 'hidden') document.body.style.overflow = '';
    });

    // Chat drawer drag, input, send, camera, voice: all handled by home-chat.js

        window.openProductDetail = function(productSlug, productName, productBrand, productImage, productPrice) {
            try {
                if (productSlug || productName) sessionStorage.setItem('__productNavData', JSON.stringify({ id: productSlug, name: productName, brand: productBrand, image: productImage || '', price: productPrice || '' }));
            } catch (e) {}
            var q = 'id=' + encodeURIComponent(productSlug || '') + '&from=wishlist';
            if (productName) q += '&name=' + encodeURIComponent(productName);
            if (productBrand) q += '&brand=' + encodeURIComponent(productBrand);
            if (productImage) q += '&image=' + encodeURIComponent(productImage);
            if (productPrice) q += '&price=' + encodeURIComponent(productPrice);
            window.location.href = 'Product_details_page.html?' + q;
        }

        // Wishlist state (match Home) - used by toggleWishlist
        const wishlistItems = new Set();
        window.toggleWishlist = function(button, productId) {
            const heartIcon = button.querySelector('svg');
            const path = heartIcon?.querySelector('path');
            if (!heartIcon) return;
            if (wishlistItems.has(productId)) {
                wishlistItems.delete(productId);
                heartIcon.classList.remove('heart-filled');
                heartIcon.setAttribute('fill', 'none');
                heartIcon.setAttribute('stroke', 'currentColor');
                if (path) { path.setAttribute('fill', 'none'); path.setAttribute('stroke', 'currentColor'); }
            } else {
                wishlistItems.add(productId);
                heartIcon.classList.add('heart-filled');
                heartIcon.setAttribute('fill', '#939BFB');
                heartIcon.setAttribute('stroke', '#939BFB');
                if (path) { path.setAttribute('fill', '#939BFB'); path.setAttribute('stroke', '#939BFB'); }
            }
        };

        // Product tile button handlers
        function setupProductTileButtons() {
            // Like/Wishlist button handler (heart icon - first button)
            document.querySelectorAll('[id^="wishlist-item-"]').forEach(item => {
                const itemId = item.id;
                const productId = item.getAttribute('data-product-id') || itemId;
                const buttons = item.querySelectorAll('.absolute.top-2.right-2 button');
                
                if (productId) wishlistItems.add(productId);
                
                if (buttons.length >= 1) {
                    // Like/Wishlist button (first button - heart icon)
                    const likeBtn = buttons[0];
                    const svg = likeBtn.querySelector('svg');
                    const path = svg.querySelector('path');
                    
                    // Set initial state - filled with primary color (items on wishlist page are wishlisted)
                    svg.classList.add('heart-filled', 'text-[#939BFB]');
                    path.setAttribute('fill', 'currentColor');
                    path.setAttribute('stroke', '#939BFB');
                    
                    likeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const pid = item.getAttribute('data-product-id') || productId;
                        toggleWishlist(likeBtn, pid);
                        const isInWishlist = wishlistItems.has(pid);
                        if (!isInWishlist) {
                            
                            // Add fade-out animation
                            item.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                            item.style.opacity = '0';
                            item.style.transform = 'scale(0.95)';
                            
                            // Remove item from DOM after animation
                            setTimeout(() => {
                                item.remove();
                                
                                // Update item count in header
                                const itemCount = document.querySelectorAll('[id^="wishlist-item-"]').length;
                                const countElement = document.querySelector('#wishlist-items h2');
                                if (countElement) {
                                    countElement.textContent = `Your Items (${itemCount})`;
                                }
                                
                                // If no items left, show empty state message
                                if (itemCount === 0) {
                                    const wishlistSection = document.getElementById('wishlist-items');
                                    if (wishlistSection) {
                                        const grid = wishlistSection.querySelector('.grid');
                                        if (grid) {
                                            grid.innerHTML = `
                                                <div class="col-span-2 text-center py-12">
                                                    <p class="text-gray-500 text-sm">Your wishlist is empty</p>
                                                </div>
                                            `;
                                        }
                                    }
                                }
                            }, 300);
                        }
                    });
                }
                
                if (buttons.length >= 2) {
                    // Share button (second button - paper plane icon)
                    buttons[1].addEventListener('click', function(e) {
                        e.stopPropagation();
                        const itemName = (item.querySelector('[data-product-name]') || item.querySelector('h4'))?.textContent || 'Product';
                        const itemPrice = (item.querySelector('[data-product-price]') || item.querySelector('span.text-black.font-medium'))?.textContent || '';
                        const brand = (item.querySelector('[data-product-brand]'))?.textContent || '';
                        const pid = item.getAttribute('data-product-id') || productId;
                        shareProduct(itemName, itemPrice, null, pid, brand);
                    });
                }
                
                if (buttons.length >= 3) {
                    // Chat button (third button) - wired via event delegation below
                }
            });
            
            // Chat trigger - use capture phase so we intercept before tile onclick (which would navigate)
            document.addEventListener('click', function(e) {
                const trigger = e.target.closest('.chat-trigger');
                if (!trigger) return;
                const item = trigger.closest('[id^="wishlist-item-"]');
                if (!item) return;
                e.stopPropagation();
                e.preventDefault();
                const productName = trigger.getAttribute('data-item') || (item.querySelector('[data-product-name]') || item.querySelector('h4'))?.textContent || 'Product';
                const productImage = trigger.getAttribute('data-product-image') || item.querySelector('[data-product-image]')?.src || item.querySelector('.product-image-overlay-wrap img')?.src || item.querySelector('img')?.src || '';
                if (typeof window.__expandChatDrawer === 'function') window.__expandChatDrawer();
                addContextualMessage('Tell me more about the "' + (productName || '').replace(/"/g, '&quot;') + '" - would you like styling suggestions or alternatives?', productImage ? [productImage] : []);
            }, true);
        }

        // Share product function — dynamic link to product page (not hardcoded)
        window.shareProduct = function(productName, price, productUrl = null, productId = null, brand = null) {
            const base = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
            const id = productId || (productName || '').toLowerCase().replace(/\s+/g, '-');
            const shareUrl = productUrl || (base + 'Product_details_page.html?id=' + encodeURIComponent(id) + (productName ? '&name=' + encodeURIComponent(productName) : '') + (brand ? '&brand=' + encodeURIComponent(brand) : ''));
            const shareData = {
                title: `${productName || 'Product'}${brand ? ' by ' + brand : ''}`,
                text: `Check out this ${productName || 'item'}${price ? ' for ' + price : ''} on GoShopMe`,
                url: shareUrl
            };
            
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => console.log('Share successful'))
                    .catch(err => {
                        if (err.name !== 'AbortError') {
                            console.error('Error sharing:', err);
                            // Fallback: copy to clipboard
                            navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(() => {
                                alert('Product link copied to clipboard!');
                            });
                        }
                    });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(() => {
                    alert('Product link copied to clipboard!');
                });
            }
        };

        // ===== DYNAMIC WISHLIST RENDER (presentation data from data/wishlist.json only) =====
        // Mock items live in data/wishlist.json — edit that file to change presentation content.
        const WISHLIST_FALLBACK = {
            hero: { imageUrl: "https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/Paris%20in%20Spring.jpg", alt: "Wishlist gift sharing hero" },
            items: []
        };

        function escapeHtml(s) {
            if (s == null || s === '') return '';
            return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        }

        function renderWishlistGrid(data) {
            const grid = document.getElementById('wishlist-items-grid');
            const countEl = document.querySelector('[data-wishlist-count]');
            if (!grid) return;
            const items = (data && data.items) ? data.items : [];
            if (items.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center py-12"><p class="text-gray-500 text-sm">Your wishlist is empty</p></div>';
                if (countEl) countEl.textContent = '0';
                return;
            }
            const html = items.map((p, i) => {
                const idx = i + 1;
                const imgSrc = escapeHtml(p.image || '');
                const imgAlt = escapeHtml(p.imageAlt || p.name || 'Product');
                const brand = escapeHtml(p.brand || '');
                const name = escapeHtml(p.name || 'Product');
                const price = escapeHtml(p.price || '');
                const origPrice = p.originalPrice ? escapeHtml(p.originalPrice) : '';
                const discount = p.discount ? escapeHtml(p.discount) : '';
                const hasDiscount = !!(p.discount && p.originalPrice);
                const priceClass = hasDiscount ? 'text-[#F96226]' : 'text-black';
                const origPriceHtml = origPrice ? '<span class="text-gray-400 line-through text-xs" data-product-original-price>' + origPrice + '</span>' : '<span class="text-gray-400 line-through text-xs hidden" data-product-original-price></span>';
                const discountHtml = discount ? '<div class="absolute bottom-2 left-2 bg-[#F96226] text-white px-2 py-1 rounded-full text-xs font-medium" data-product-discount><span data-product-discount-text>' + discount + '</span></div>' : '<div class="absolute bottom-2 left-2 bg-[#F96226] text-white px-2 py-1 rounded-full text-xs font-medium hidden" data-product-discount><span data-product-discount-text></span></div>';
                return '<div id="wishlist-item-' + idx + '" class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer hover:shadow-md transition-shadow" data-product-id="' + escapeHtml(p.id || '') + '" data-product-slug="' + escapeHtml(p.slug || '') + '" onclick="var e=this; var img=e.querySelector(\'[data-product-image]\'); openProductDetail(e.getAttribute(\'data-product-id\')||e.getAttribute(\'data-product-slug\')||\'\', (e.querySelector(\'[data-product-name]\')||{}).textContent||\'\', (e.querySelector(\'[data-product-brand]\')||{}).textContent||\'\', img?img.src:\'\' , (e.querySelector(\'[data-product-price]\')||{}).textContent||\'\')"><div class="relative product-image-overlay-wrap"><img class="w-full h-40 object-cover" src="' + imgSrc + '" data-product-image alt="' + imgAlt + '" data-product-image-alt /><div class="absolute top-2 right-2 flex flex-col space-y-1"><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity wishlist-btn" aria-label="Add to wishlist"><svg class="w-4 h-4 text-white product-overlay-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg></button><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity share-product-btn" aria-label="Share"><svg class="w-4 h-4 text-white product-overlay-icon share-icon-tilted" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" /></svg></button><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity chat-trigger" data-item="' + escapeHtml(p.name || '') + '" data-product-image="' + imgSrc + '" aria-label="Chat"><svg class="w-4 h-4 text-white product-overlay-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" /></svg></button></div>' + discountHtml + '</div><div class="p-3"><p class="text-xs text-gray-500 mb-1" data-product-brand>' + brand + '</p><h4 class="poppins font-medium text-black text-sm mb-2" data-product-name>' + name + '</h4><div class="flex items-center space-x-2"><span class="' + priceClass + ' font-medium text-sm" data-product-price>' + price + '</span>' + origPriceHtml + '</div></div></div>';
            }).join('');
            grid.innerHTML = html;
            if (countEl) countEl.textContent = String(items.length);
            items.forEach(function(p) { if (p.id) wishlistItems.add(p.id); });
            setupProductTileButtons();
        }
        window.renderWishlistGrid = renderWishlistGrid;

        function initWishlistFromData() {
            var dataPath = 'data/wishlist.json';
            fetch(dataPath)
                .then(function(r) { return r.ok ? r.json() : Promise.reject(); })
                .then(function(data) {
                    renderWishlistGrid(data);
                    if (data && data.hero && data.hero.imageUrl) {
                        populateWishlistHero(data.hero.imageUrl);
                    } else if (WISHLIST_FALLBACK.hero && WISHLIST_FALLBACK.hero.imageUrl) {
                        populateWishlistHero(WISHLIST_FALLBACK.hero.imageUrl);
                    }
                })
                .catch(function() {
                    renderWishlistGrid(WISHLIST_FALLBACK);
                    if (WISHLIST_FALLBACK.hero && WISHLIST_FALLBACK.hero.imageUrl) {
                        populateWishlistHero(WISHLIST_FALLBACK.hero.imageUrl);
                    }
                });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initWishlistFromData);
        } else {
            initWishlistFromData();
        }

        // ===== DYNAMIC DATA POPULATION FUNCTIONS =====
        // Function to populate wishlist hero image
        window.populateWishlistHero = function(imageUrl) {
            const heroImg = document.querySelector('[data-wishlist-hero-image]');
            if (heroImg) {
                heroImg.src = imageUrl;
                heroImg.onerror = function() {
                    console.warn('Failed to load wishlist hero image:', imageUrl);
                };
                console.log(`✓ Updated wishlist hero image with: ${imageUrl}`);
                return true;
            } else {
                console.warn('Hero image element not found');
                return false;
            }
        };

        // Function to populate ShAI avatar (alias: setShAIAvatar for consistency)
        window.populateShAIAvatar = window.setShAIAvatar = function(avatarUrl) {
            const images = document.querySelectorAll('[data-shai-avatar]');
            let count = 0;
            images.forEach(img => {
                img.src = avatarUrl;
                img.onerror = function() {
                    console.warn('Failed to load ShAI avatar:', avatarUrl);
                };
                count++;
            });
            console.log(`✓ Updated ${count} ShAI avatar(s) with: ${avatarUrl}`);
            return count;
        };
        window.testShAIAvatar = function(url) {
            const testUrl = url || 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg';
            window.setShAIAvatar(testUrl);
            console.log('testShAIAvatar:', testUrl);
        };

        // Function to populate user avatars
        window.populateUserAvatars = function(avatarUrl) {
            const images = document.querySelectorAll('[data-user-avatar]');
            let count = 0;
            images.forEach(img => {
                img.src = avatarUrl;
                img.onerror = function() {
                    console.warn('Failed to load user avatar:', avatarUrl);
                };
                count++;
            });
            console.log(`✓ Updated ${count} user avatar(s) with: ${avatarUrl}`);
            return count;
        };

        // Function to populate a single product item
        window.populateProductItem = function(itemId, productData) {
            const item = document.getElementById(itemId);
            if (!item) return;

            // Set product ID and slug
            if (productData.id) item.setAttribute('data-product-id', productData.id);
            if (productData.slug) {
                item.setAttribute('data-product-slug', productData.slug);
                item.setAttribute('onclick', `openProductDetail('${(productData.slug || '').replace(/'/g, "\\'")}', '${(productData.name || '').replace(/'/g, "\\'")}', '${(productData.brand || '').replace(/'/g, "\\'")}')`);
            }

            // Set product image
            const img = item.querySelector('[data-product-image]');
            if (img && productData.image) {
                img.src = productData.image;
                img.setAttribute('alt', productData.imageAlt || productData.name || 'Product image');
                if (item.querySelector('[data-product-image-alt]')) {
                    item.querySelector('[data-product-image-alt]').setAttribute('alt', productData.imageAlt || productData.name || 'Product image');
                }
            }

            // Set product brand
            const brandEl = item.querySelector('[data-product-brand]');
            if (brandEl && productData.brand) {
                brandEl.textContent = productData.brand;
            }

            // Set product name
            const nameEl = item.querySelector('[data-product-name]');
            if (nameEl && productData.name) {
                nameEl.textContent = productData.name;
            }

            // Set chat trigger data-item and data-product-image (for contextual message with thumbnail)
            const chatTrigger = item.querySelector('.chat-trigger');
            if (chatTrigger) {
                if (productData.name) chatTrigger.setAttribute('data-item', productData.name);
                if (productData.image) chatTrigger.setAttribute('data-product-image', productData.image);
            }
            if (productData.id) wishlistItems.add(productData.id);

            // Set prices
            const priceEl = item.querySelector('[data-product-price]');
            const originalPriceEl = item.querySelector('[data-product-original-price]');
            
            if (priceEl && productData.price) {
                priceEl.textContent = productData.price;
                // If there's a discount, show sale price in red
                if (productData.originalPrice) {
                    priceEl.classList.add('text-[#F96226]');
                    priceEl.classList.remove('text-black');
                } else {
                    priceEl.classList.remove('text-[#F96226]');
                    priceEl.classList.add('text-black');
                }
            }

            if (originalPriceEl && productData.originalPrice) {
                originalPriceEl.textContent = productData.originalPrice;
                originalPriceEl.classList.remove('hidden');
            } else if (originalPriceEl) {
                originalPriceEl.classList.add('hidden');
            }

            // Set discount badge
            const discountEl = item.querySelector('[data-product-discount]');
            const discountTextEl = item.querySelector('[data-product-discount-text]');
            if (productData.discount) {
                if (discountEl) discountEl.classList.remove('hidden');
                if (discountTextEl) discountTextEl.textContent = productData.discount;
            } else if (discountEl) {
                discountEl.classList.add('hidden');
            }
        };

        // Function to populate all wishlist items from an array
        window.populateWishlistItems = function(products) {
            products.forEach((product, index) => {
                const itemId = `wishlist-item-${index + 1}`;
                populateProductItem(itemId, product);
            });

            // Update wishlist count
            const countEl = document.querySelector('[data-wishlist-count]');
            if (countEl) {
                countEl.textContent = products.length;
            }
        };

        // ===== TEST COMMANDS =====
        // Run these commands in the browser console to test dynamic content population
        // These simulate data coming from your database
        
        console.log('%c=== WISHLIST TEST COMMANDS ===', 'color: #939BFB; font-weight: bold; font-size: 16px;');
        console.log('');
        console.log('%c1. Populate ShAI Avatar (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log('populateShAIAvatar("/api/uploads/avatars/shai-avatar.png");');
        console.log('// Or with full URL:');
        console.log('populateShAIAvatar("https://your-cdn.com/uploads/avatars/shai-avatar.png");');
        console.log('');
        console.log('%c2. Populate User Avatars (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log('populateUserAvatars("/api/uploads/users/user-123-avatar.jpg");');
        console.log('// Or with full URL:');
        console.log('populateUserAvatars("https://your-cdn.com/uploads/users/user-123-avatar.jpg");');
        console.log('');
        console.log('%c3. Populate Wishlist Hero Image (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log('populateWishlistHero("/api/uploads/heroes/wishlist-hero-banner.jpg");');
        console.log('// Or with full URL:');
        console.log('populateWishlistHero("https://your-cdn.com/uploads/heroes/wishlist-hero-banner.jpg");');
        console.log('');
        console.log('%c4. Populate Single Product Item (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log(`populateProductItem("wishlist-item-1", {
    id: "prod-001",
    slug: "elegant-black-blazer",
    name: "Elegant Black Blazer",
    brand: "Theory",
    price: "$295",
    image: "/api/uploads/products/prod-001/main-image.jpg",
    imageAlt: "Elegant black blazer"
});`);
        console.log('');
        console.log('%c5. Populate Product with Discount (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log(`populateProductItem("wishlist-item-2", {
    id: "prod-002",
    slug: "silk-button-down-shirt",
    name: "Silk Button-Down Shirt",
    brand: "Equipment",
    price: "$168",
    originalPrice: "$210",
    discount: "20% off",
    image: "/api/uploads/products/prod-002/main-image.jpg",
    imageAlt: "Silk button-down shirt"
});`);
        console.log('');
        console.log('%c6. Populate All Wishlist Items (from database):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log(`populateWishlistItems([
    {
        id: "prod-001",
        slug: "elegant-black-blazer",
        name: "Elegant Black Blazer",
        brand: "Theory",
        price: "$295",
        image: "/api/uploads/products/prod-001/main-image.jpg",
        imageAlt: "Elegant black blazer"
    },
    {
        id: "prod-002",
        slug: "silk-button-down-shirt",
        name: "Silk Button-Down Shirt",
        brand: "Equipment",
        price: "$168",
        originalPrice: "$210",
        discount: "20% off",
        image: "/api/uploads/products/prod-002/main-image.jpg",
        imageAlt: "Silk button-down shirt"
    },
    {
        id: "prod-003",
        slug: "classic-leather-tote",
        name: "Classic Leather Tote",
        brand: "Saint Laurent",
        price: "$1,290",
        image: "/api/uploads/products/prod-003/main-image.jpg",
        imageAlt: "Classic leather tote"
    }
]);`);
        console.log('');
        console.log('%c7. Quick Test - Populate Everything (simulating database response):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log(`// Simulate loading data from database
populateShAIAvatar("/api/uploads/avatars/shai-avatar.png");
populateUserAvatars("/api/uploads/users/user-123-avatar.jpg");
populateWishlistHero("/api/uploads/heroes/wishlist-hero-banner.jpg");
populateWishlistItems([
    {
        id: "prod-001",
        slug: "elegant-black-blazer",
        name: "Elegant Black Blazer",
        brand: "Theory",
        price: "$295",
        image: "/api/uploads/products/prod-001/main-image.jpg",
        imageAlt: "Elegant black blazer"
    },
    {
        id: "prod-002",
        slug: "silk-button-down-shirt",
        name: "Silk Button-Down Shirt",
        brand: "Equipment",
        price: "$168",
        originalPrice: "$210",
        discount: "20% off",
        image: "/api/uploads/products/prod-002/main-image.jpg",
        imageAlt: "Silk button-down shirt"
    },
    {
        id: "prod-003",
        slug: "classic-leather-tote",
        name: "Classic Leather Tote",
        brand: "Saint Laurent",
        price: "$1,290",
        image: "/api/uploads/products/prod-003/main-image.jpg",
        imageAlt: "Classic leather tote"
    }
]);`);
        console.log('');
        console.log('%c7. TEST WISHLIST HERO IMAGE (copy and paste to test):', 'color: #10B981; font-weight: bold; font-size: 14px;');
        console.log(`// Test the wishlist hero image with a working placeholder
populateWishlistHero("https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&h=400&fit=crop");`);
        console.log('');
        console.log('// Alternative hero images for testing:');
        console.log('populateWishlistHero("https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop"); // Shopping theme');
        console.log('populateWishlistHero("https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=800&h=400&fit=crop"); // Fashion theme');
        console.log('populateWishlistHero("https://images.unsplash.com/photo-1445205170230-053b83016050?w=800&h=400&fit=crop"); // Retail theme');
        console.log('');
        console.log('%c8. TEST PRODUCT PICTURES & DESCRIPTIONS (copy and paste to test):', 'color: #10B981; font-weight: bold; font-size: 14px;');
        console.log(`// Test product images and descriptions with working placeholder images
populateWishlistItems([
    {
        id: "prod-001",
        slug: "elegant-black-blazer",
        name: "Elegant Black Blazer",
        brand: "Theory",
        price: "$295",
        image: "https://images.unsplash.com/photo-1594938291221-94f18c0e0e4a?w=400&h=600&fit=crop",
        imageAlt: "Elegant black blazer"
    },
    {
        id: "prod-002",
        slug: "silk-button-down-shirt",
        name: "Silk Button-Down Shirt",
        brand: "Equipment",
        price: "$168",
        originalPrice: "$210",
        discount: "20% off",
        image: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400&h=600&fit=crop",
        imageAlt: "Silk button-down shirt"
    },
    {
        id: "prod-003",
        slug: "classic-leather-tote",
        name: "Classic Leather Tote",
        brand: "Saint Laurent",
        price: "$1,290",
        image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=600&fit=crop",
        imageAlt: "Classic leather tote"
    },
    {
        id: "prod-004",
        slug: "designer-sunglasses",
        name: "Designer Sunglasses",
        brand: "Ray-Ban",
        price: "$149",
        originalPrice: "$199",
        discount: "25% off",
        image: "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=600&fit=crop",
        imageAlt: "Designer sunglasses"
    },
    {
        id: "prod-005",
        slug: "wool-coat",
        name: "Wool Winter Coat",
        brand: "Burberry",
        price: "$895",
        image: "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400&h=600&fit=crop",
        imageAlt: "Wool winter coat"
    }
]);`);
        console.log('');
        console.log('%c9. TEST WITH WORKING PLACEHOLDER IMAGES (all content):', 'color: #10B981; font-weight: bold; font-size: 14px;');
        console.log(`// These URLs will actually load images so you can see them working
populateShAIAvatar("https://i.pravatar.cc/150?img=12");
populateUserAvatars("https://i.pravatar.cc/150?img=47");
populateWishlistHero("https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&h=400&fit=crop");
populateWishlistItems([
    {
        id: "prod-001",
        slug: "elegant-black-blazer",
        name: "Elegant Black Blazer",
        brand: "Theory",
        price: "$295",
        image: "https://images.unsplash.com/photo-1594938291221-94f18c0e0e4a?w=400&h=600&fit=crop",
        imageAlt: "Elegant black blazer"
    },
    {
        id: "prod-002",
        slug: "silk-button-down-shirt",
        name: "Silk Button-Down Shirt",
        brand: "Equipment",
        price: "$168",
        originalPrice: "$210",
        discount: "20% off",
        image: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400&h=600&fit=crop",
        imageAlt: "Silk button-down shirt"
    },
    {
        id: "prod-003",
        slug: "classic-leather-tote",
        name: "Classic Leather Tote",
        brand: "Saint Laurent",
        price: "$1,290",
        image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=600&fit=crop",
        imageAlt: "Classic leather tote"
    }
]);`);
        console.log('');
        console.log('%c10. Example with CDN URLs (if using cloud storage):', 'color: #F96226; font-weight: bold; font-size: 12px;');
        console.log(`populateShAIAvatar("https://cdn.goshopme.ai/uploads/avatars/shai-avatar.png");
populateUserAvatars("https://cdn.goshopme.ai/uploads/users/user-123-avatar.jpg");
populateWishlistHero("https://cdn.goshopme.ai/uploads/heroes/wishlist-hero-banner.jpg");
populateWishlistItems([
    {
        id: "prod-001",
        slug: "elegant-black-blazer",
        name: "Elegant Black Blazer",
        brand: "Theory",
        price: "$295",
        image: "https://cdn.goshopme.ai/uploads/products/prod-001/main-image.jpg",
        imageAlt: "Elegant black blazer"
    }
]);`);
        console.log('');
        console.log('%c=== END TEST COMMANDS ===', 'color: #939BFB; font-weight: bold; font-size: 14px;');
    });
</script>

</body>
</html>

