<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <title>Notifications "“ GoShopMe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shine-primary': '#939BFB',
                        'shine-accent': '#F96226'
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Karla:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/chat-drawer-drag.css">
    <style>
        
/* ---- MOBILE FULL-WIDTH OVERRIDE - chat excluded so drawer works ---- */
@media screen and (max-width: 768px) {
  #app-shell, #main-content, #auth-screen, #welcome_screen, #quiz-screen, #onboarding-screen,
  #bottom-nav, #bottom-navigation, #header, #app-header,
  #shai-chat-drawer-wrapper, #chat-drawer-wrapper,
  body > main {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  body > div:not(#orders-chat-overlay):not(#orders-chat-drawer):not(#orders-chat-input-bar):not(#return-chat-overlay):not(#return-chat-drawer):not(#return-chat-input-bar):not(#notif-chat-overlay):not(#notif-chat-drawer):not(#notif-chat-input-bar):not(#chat-overlay):not(#chat-drawer):not(#chat-input-bar) {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  [class*="left-1/2"][class*="-translate-x-1/2"]:not([class*="rounded-full"]):not(#orders-chat-drawer):not(#orders-chat-input-bar):not(#return-chat-drawer):not(#return-chat-input-bar):not(#notif-chat-drawer):not(#notif-chat-input-bar):not(#chat-drawer):not(#chat-input-bar) {
    left: 0 !important;
    right: 0 !important;
    max-width: 100vw !important;
    width: 100% !important;
    transform: none !important;
  }
  #chat-drawer.translate-y-full, #shai-chat-drawer.translate-y-full, #return-chat-drawer.translate-y-full, #orders-chat-drawer.translate-y-full, #notif-chat-drawer.translate-y-full {
    transform: translateY(100%) !important;
  }
  #bottom-nav > div, #bottom-navigation > div, nav#bottom-nav > div, nav#bottom-navigation > div {
    padding-top: 2px !important;
    padding-bottom: 24px !important;
  }
}

::-webkit-scrollbar { display: none; }
        * { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .dm-sans { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .poppins { font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .bottom-nav-btn { display: flex; flex-direction: column; align-items: center; color: #6B7280; transition: color 0.2s ease-in-out; min-width: 60px; }
        .bottom-nav-btn:hover, .bottom-nav-btn.active { color: #939BFB; }
        .bottom-nav-btn:hover svg, .bottom-nav-btn:hover span, .bottom-nav-btn.active svg, .bottom-nav-btn.active span { color: #939BFB; }
        .bottom-nav-btn svg { width: 20px; height: 20px; stroke-width: 1.5; margin-bottom: 4px; }
        .icon-button svg { width: 18px; height: 18px; stroke-width: 1.5; }
        .icon-button:hover svg { color: #939BFB; }
        .voice-message-bubble { min-width: 140px; max-width: 260px; width: fit-content; display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 16px; }
        @keyframes wavePulse { 0%, 100% { transform: scaleY(0.5); } 50% { transform: scaleY(1); } }
        .wave-bar.playing { animation: wavePulse 1.1s ease-in-out infinite; animation-delay: calc(var(--i) * 0.08s); }
    </style>
    <script>
    (function() {
        window.setShaiAvatarFromDb = window.setShAIAvatar = function(url) {
            if (!url) return;
            document.querySelectorAll('.notif-shai-avatar').forEach(function(img) { img.src = url; img.style.display = ''; });
            document.querySelectorAll('.notif-shai-placeholder').forEach(function(s) { s.classList.add('hidden'); });
        };
        window.testShAIAvatar = function(url) {
            var testUrl = url || 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg';
            window.setShAIAvatar(testUrl);
            console.log('testShAIAvatar:', testUrl);
        };
    })();
    </script>
</head>
<body class="bg-[#F6F6F6] dm-sans">
    <!-- Main app screen (contextual: e.g. Home, Profile "” visible behind drawer when open) -->
    <div id="app-shell" class="w-full max-w-[390px] mx-auto min-h-screen bg-white shadow-2xl relative flex flex-col">
        <header class="sticky top-0 z-30 bg-white border-b border-gray-100 flex-shrink-0">
            <div class="flex items-center justify-between px-4 py-3">
                <a id="notifications-back-link" href="Home.html" onclick="return typeof goBackNotifications==='function'?goBackNotifications(event):true" class="text-gray-600 hover:text-gray-900 transition-colors" aria-label="Back">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg>
                </a>
                <h1 id="header-title" class="poppins text-lg font-semibold text-gray-900">Notifications</h1>
                <span class="w-10 h-10 inline-block"></span>
            </div>
        </header>
        <main class="flex-1 pt-20 px-4 pb-40 bg-white overflow-y-auto">
            <div id="notifications-feed" class="space-y-4"><!-- Rendered dynamically --></div>
            <div id="notifications-empty" class="hidden flex flex-col items-center justify-center py-16 px-6">
                <div class="w-20 h-20 bg-shine-primary/10 rounded-full flex items-center justify-center mb-6 flex-shrink-0">
                    <svg class="w-10 h-10 text-shine-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                    </svg>
                </div>
                <h3 class="poppins text-xl font-semibold text-center mb-2 text-gray-900">You're all caught up!</h3>
                <p class="dm-sans text-gray-500 text-center text-sm max-w-[260px]">We'll let you know when something exciting happens.</p>
            </div>
        </main>
    </div>

<!-- Chat overlay "“ tap to close drawer -->
<div id="notif-chat-overlay" class="fixed inset-0 bg-black/40 z-40 hidden" aria-hidden="true"></div>

<!-- Chat drawer - match Picks/Home approved structure -->
<div id="notif-chat-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 bg-white rounded-t-3xl shadow-2xl h-[50vh] transform translate-y-full transition-transform duration-300 flex flex-col border-t border-gray-100">
    <div id="notif-chat-drag-handle-area" class="chat-drawer-drag-zone flex justify-center pt-2 flex-shrink-0">
        <div class="w-10 h-1 bg-gray-300 rounded-full pointer-events-none drag-handle"></div>
    </div>
    <div class="flex items-center p-4 pb-2 flex-shrink-0">
        <button id="notif-chat-back-btn" class="mr-3 hidden hover:opacity-70 transition-opacity">
            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
        </button>
        <div class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0 bg-gray-100 flex items-center justify-center relative">
            <img class="notif-shai-avatar w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI" onerror="this.style.display='none';var s=this.parentElement.querySelector('.notif-shai-placeholder');if(s)s.classList.remove('hidden')">
            <span class="notif-shai-placeholder hidden absolute inset-0 flex items-center justify-center text-gray-400 text-xs font-medium">AI</span>
        </div>
        <div class="flex-1">
            <p class="font-semibold text-black text-sm">ShAI</p>
            <p class="text-xs text-gray-500">Your shopping assistant</p>
        </div>
    </div>
    <div id="notif-chat-content" class="flex-1 flex flex-col min-h-0">
        <div id="notif-chat-messages" class="flex-1 overflow-y-auto min-h-0">
            <div class="p-4 pb-6">
                <div class="flex items-start space-x-3 mb-4">
                    <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center relative">
                        <img class="notif-shai-avatar w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI" onerror="this.style.display='none';var s=this.parentElement.querySelector('.notif-shai-placeholder');if(s)s.classList.remove('hidden')">
                        <span class="notif-shai-placeholder hidden absolute inset-0 flex items-center justify-center text-gray-400 text-xs font-medium">AI</span>
                    </div>
                    <div class="flex-1">
                        <div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 mb-3 min-w-0">
                            <p class="text-sm text-black break-words whitespace-pre-wrap">Hi! I'm here to help with your notifications or your next favorite find. How can I assist you today?</p>
                        </div>
                        <div class="flex flex-wrap gap-2 pb-2">
                            <button class="notif-smart-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">Check my notifications</button>
                            <button class="notif-smart-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">Find me an outfit</button>
                            <button class="notif-smart-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">What's trending?</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
            <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                <button id="notif-cam-btn" class="icon-button hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg>
                </button>
                <textarea id="notif-chat-input" placeholder="Message ShAI..." rows="1" class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans min-h-[24px] max-h-[120px] py-1 text-sm resize-none overflow-y-auto" style="overflow-y: hidden;"></textarea>
                <button id="notif-add-friend-btn" class="icon-button hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
                </button>
                <button id="notif-mic-btn" class="icon-button hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg>
                </button>
                <button id="notif-send-btn" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
                </button>
            </div>
        </div>
    </div>
    <div id="notif-add-friend-content" class="flex-1 flex flex-col min-h-0 hidden">
        <div class="flex-1 overflow-y-auto p-4">
            <div class="mb-4">
                <div class="relative">
                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                    <input type="text" id="notif-contact-search" placeholder="Search contacts..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pl-10 text-sm">
                </div>
            </div>
            <div id="notif-contacts-container" class="space-y-2"></div>
        </div>
    </div>
</div>

<!-- Chat input bar (collapsed state) "“ tap to expand -->
<div id="notif-chat-input-bar" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 p-4 z-30">
    <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
        <button id="notif-cam-btn-collapsed" class="icon-button hover:opacity-70 transition-opacity">
            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg>
        </button>
        <input type="text" id="notif-chat-input-collapsed" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans min-h-[24px] text-sm cursor-pointer" readonly>
        <button id="notif-add-friend-btn-collapsed" class="icon-button hover:opacity-70 transition-opacity">
            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg>
        </button>
        <button id="notif-mic-btn-collapsed" class="icon-button hover:opacity-70 transition-opacity">
            <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg>
        </button>
        <button id="notif-send-btn-collapsed" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity">
            <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
        </button>
    </div>
</div>

    <nav id="bottom-nav" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 flex justify-center">
        <div class="w-full max-w-[390px] bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="flex items-center justify-around py-2">
                <a href="Home.html" class="bottom-nav-btn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/>
                    </svg>
                    <span class="dm-sans text-xs">Home</span>
                </a>
                <a href="Picks.html" class="bottom-nav-btn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/>
                    </svg>
                    <span class="dm-sans text-xs">Picks</span>
                </a>
                <a href="Wishlist.html" class="bottom-nav-btn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/>
                    </svg>
                    <span class="dm-sans text-xs">Wishlist</span>
                </a>
                <a id="notif-nav-profile-link" href="User_Profile_Free_Plan.html" class="bottom-nav-btn">
                    <span id="notif-nav-profile-icon" class="flex items-center justify-center w-6 h-6 mb-1">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                    </span>
                    <img id="notif-nav-profile-photo" class="w-6 h-6 rounded-full object-cover mb-1 hidden" src="" alt="Profile">
                    <span class="dm-sans text-xs">Profile</span>
                </a>
            </div>
        </div>
    </nav>
    <script src="js/chat-dock-nav.js"></script>
    <script>
    // Bottom nav profile: link = paid/free based on __userPlan; show profile icon/photo from localStorage
    (function() {
        var plan = (localStorage.getItem('__userPlan') || '').toLowerCase();
        var profileHref = (plan === 'paid' || plan === 'true') ? 'User_Profile_Paid_Plan.html' : 'User_Profile_Free_Plan.html';
        var profileLink = document.getElementById('notif-nav-profile-link');
        if (profileLink) profileLink.href = profileHref;
        var saved = null;
        try { saved = localStorage.getItem('profilePhoto'); } catch (e) {}
        var img = document.getElementById('notif-nav-profile-photo');
        var icon = document.getElementById('notif-nav-profile-icon');
        if (img && icon) {
            if (saved) {
                img.src = saved;
                img.classList.remove('hidden');
                icon.classList.add('hidden');
            } else {
                img.src = '';
                img.classList.add('hidden');
                icon.classList.remove('hidden');
            }
        }
    })();
    </script>
    <script>
    // Contextual back: from param -> previous page; click navigates to that page
    (function() {
        var fromMap = {
            'home': 'Home.html',
            'picks': "Picks.html",
            'wishlist': 'Wishlist.html',
            'orders': 'Orders.html',
            'orders-empty': 'Orders_Screen_Empty_State.html',
            'order-tracking': 'Order_Tracking.html',
            'product': 'Product_details_page.html',
            'collections': "Creator`s Collections_Page.html",
            'collection': "Creator`s Single_Collection.html",
            'notifications-settings': 'Notifications_Settings.html',
            'cart': 'Shopping_bag.html',
            'cart-empty': 'Shopping_bag_empty_state.html',
            'category': 'ShopbyCategory.html',
            'subscription': 'Subscription_Management.html',
            'trending': 'Trending_Now.html',
            'profile-free': 'User_Profile_Free_Plan.html',
            'profile-paid': 'User_Profile_Paid_Plan.html',
            'privacy-settings': 'Privacy_Settings.html',
            'return-details': 'Return_Details.html',
            'receipt': 'Receipt_Details_Screen.html'
        };
        window.goBackNotifications = function(e) {
            if (e) { e.preventDefault(); e.stopPropagation(); }
            var params = new URLSearchParams(window.location.search);
            var from = (params.get('from') || '').toLowerCase();
            var target = fromMap[from];
            if (target) {
                window.location.href = target;
            } else if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'Home.html';
            }
            return false;
        };
        var link = document.getElementById('notifications-back-link');
        if (link) {
            var params = new URLSearchParams(window.location.search);
            var from = (params.get('from') || '').toLowerCase();
            link.href = fromMap[from] || 'Home.html';
        }
    })();
    </script>
    <script>
    // Chat drawer "“ same behavior as Orders screen
    (function() {
        window.__addFriendContacts = window.__addFriendContacts || [
            { name: 'Alex Johnson', phone: '+1 (555) 123-4567', goshopme: true, avatar: 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg' },
            { name: 'Maria Rodriguez', phone: '+1 (555) 987-6543', goshopme: false },
            { name: 'David Kim', phone: '+1 (555) 456-7890', goshopme: true, avatar: 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-3.jpg' },
            { name: 'Sarah Thompson', phone: '+1 (555) 234-5678', goshopme: false },
            { name: 'Emma Wilson', phone: '+1 (555) 345-6789', goshopme: true, avatar: 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-5.jpg' }
        ];
        window.setShaiAvatarFromDb = window.setShAIAvatar = function(url) {
            if (!url) return;
            document.querySelectorAll('.notif-shai-avatar').forEach(function(img) { img.src = url; img.style.display = ''; });
            document.querySelectorAll('.notif-shai-placeholder').forEach(function(s) { s.classList.add('hidden'); });
        };
        window.testShAIAvatar = function(url) {
            const testUrl = url || 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg';
            window.setShAIAvatar(testUrl);
            console.log('testShAIAvatar:', testUrl);
        };
        document.addEventListener('DOMContentLoaded', function() {
            var drawer = document.getElementById('notif-chat-drawer');
            var overlay = document.getElementById('notif-chat-overlay');
            var inputBar = document.getElementById('notif-chat-input-bar');
            if (!drawer) return;
            function expandDrawer() {
                drawer.classList.remove('translate-y-full');
                drawer.classList.remove('hidden');
                if (overlay) overlay.classList.remove('hidden');
                if (inputBar) inputBar.classList.add('hidden');
            }
            function collapseDrawer() {
                drawer.classList.add('translate-y-full');
                drawer.classList.add('hidden');
                if (overlay) overlay.classList.add('hidden');
                if (inputBar) inputBar.classList.remove('hidden');
                var addFriendContent = document.getElementById('notif-add-friend-content');
                var chatContent = document.getElementById('notif-chat-content');
                var backBtn = document.getElementById('notif-chat-back-btn');
                if (addFriendContent && !addFriendContent.classList.contains('hidden')) {
                    if (chatContent) chatContent.classList.remove('hidden');
                    if (addFriendContent) addFriendContent.classList.add('hidden');
                    if (backBtn) backBtn.classList.add('hidden');
                }
            }
            if (overlay) overlay.addEventListener('click', collapseDrawer);
            ['notif-chat-input-collapsed','notif-cam-btn-collapsed','notif-add-friend-btn-collapsed','notif-mic-btn-collapsed','notif-send-btn-collapsed'].forEach(function(id) {
                var el = document.getElementById(id);
                if (el) el.addEventListener('click', function(e) { e.preventDefault(); expandDrawer(); });
            });
            var emptyEl = document.getElementById('notifications-empty');
            if (emptyEl && !emptyEl.classList.contains('hidden')) expandDrawer();
            var chatMessages = document.getElementById('notif-chat-messages');
            var chatInput = document.getElementById('notif-chat-input');
            var micBtn = document.getElementById('notif-mic-btn');
            var sendBtn = document.getElementById('notif-send-btn');
            var addFriendBtn = document.getElementById('notif-add-friend-btn');
            var chatContent = document.getElementById('notif-chat-content');
            var addFriendContent = document.getElementById('notif-add-friend-content');
            var backBtn = document.getElementById('notif-chat-back-btn');
            var contactsContainer = document.getElementById('notif-contacts-container');
            var contactSearch = document.getElementById('notif-contact-search');
            function getShaiImg() { return window.__shaiAvatarUrl || 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png'; }
            function getContainer() { return chatMessages && chatMessages.querySelector('.p-4'); }
            function scrollToBottom() {
                if (!chatMessages) return;
                requestAnimationFrame(function() { requestAnimationFrame(function() { chatMessages.scrollTop = chatMessages.scrollHeight; }); });
            }
            function sendMessage() {
                var text = chatInput && chatInput.value ? chatInput.value.trim() : '';
                if (!text) return;
                var container = getContainer();
                if (container) {
                    var userMsg = document.createElement('div');
                    userMsg.className = 'flex justify-end mb-4';
                    userMsg.innerHTML = '<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%] min-w-0"><p class="text-sm break-words whitespace-pre-wrap">' + (text || '').replace(/</g, '&lt;') + '</p></div>';
                    container.appendChild(userMsg);
                }
                if (chatInput) { chatInput.value = ''; autoResizeInput(); }
                if (micBtn) micBtn.classList.remove('hidden');
                if (addFriendBtn) addFriendBtn.classList.remove('hidden');
                if (sendBtn) sendBtn.classList.add('hidden');
                scrollToBottom();
                setTimeout(function() {
                    var el = document.createElement('div');
                    el.className = 'flex items-start space-x-3 mb-4';
                    el.innerHTML = '<div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center relative"><img class="notif-shai-avatar w-full h-full object-cover" src="' + getShaiImg() + '" alt="ShAI"><span class="notif-shai-placeholder hidden absolute inset-0 flex items-center justify-center text-gray-400 text-xs font-medium">AI</span></div><div class="flex-1 min-w-0"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black break-words whitespace-pre-wrap">I\'d be happy to help! Let me find some perfect options for you.</p></div></div>';
                    if (container) container.appendChild(el);
                    scrollToBottom();
                }, 1000);
            }
            function autoResizeInput() {
                if (!chatInput) return;
                chatInput.style.height = 'auto';
                var h = Math.max(24, Math.min(chatInput.scrollHeight, 120));
                chatInput.style.height = h + 'px';
                chatInput.style.overflowY = chatInput.scrollHeight > 120 ? 'auto' : 'hidden';
            }
            function updateInputState() {
                if (!chatInput) return;
                var hasText = chatInput.value.trim().length > 0;
                if (micBtn) micBtn.classList.toggle('hidden', hasText);
                if (addFriendBtn) addFriendBtn.classList.toggle('hidden', hasText);
                if (sendBtn) sendBtn.classList.toggle('hidden', !hasText);
            }
            if (chatInput) {
                chatInput.addEventListener('input', function() { autoResizeInput(); updateInputState(); });
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
                });
            }
            if (sendBtn) sendBtn.addEventListener('click', sendMessage);

            function toggleVoicePlayback(button) {
                var container = button.closest('.voice-message-bubble');
                if (!container) return;
                var audio = container.querySelector('audio');
                var playIcon = button.querySelector('svg');
                var waveBars = container.querySelectorAll('.wave-bar');
                var durationText = container.querySelector('.duration-text');
                if (!audio || !playIcon) return;
                function fmt(t) { var m = Math.floor(t / 60), s = Math.ceil(t % 60); return m + ':' + (s < 10 ? '0' : '') + s; }
                function stopAnim() {
                    playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
                    waveBars.forEach(function(bar) { bar.style.animation = 'none'; bar.classList.remove('playing'); });
                    if (audio._notifTimeupdate) { audio.removeEventListener('timeupdate', audio._notifTimeupdate); audio._notifTimeupdate = null; }
                }
                if (audio.paused) {
                    audio.play();
                    playIcon.innerHTML = '<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>';
                    waveBars.forEach(function(bar, i) { bar.style.animation = 'wavePulse 1.1s ease-in-out infinite'; bar.style.animationDelay = (i * 0.08) + 's'; bar.classList.add('playing'); });
                    var onTime = function() {
                        if (durationText) {
                            var d = audio.duration;
                            if (d && isFinite(d)) durationText.textContent = fmt(Math.ceil(d - audio.currentTime));
                            else durationText.textContent = fmt(Math.ceil(audio.currentTime));
                        }
                    };
                    audio._notifTimeupdate = onTime;
                    audio.addEventListener('timeupdate', onTime);
                    audio.addEventListener('ended', function() { stopAnim(); if (durationText && audio.duration && isFinite(audio.duration)) durationText.textContent = fmt(Math.ceil(audio.duration)); }, { once: true });
                } else {
                    audio.pause();
                    stopAnim();
                    if (durationText && audio.duration && isFinite(audio.duration)) durationText.textContent = fmt(Math.ceil(audio.duration - audio.currentTime));
                }
            }
            if (chatMessages) chatMessages.addEventListener('click', function(e) {
                var playBtn = e.target.closest('.voice-message-bubble .play-btn');
                if (playBtn) { e.preventDefault(); toggleVoicePlayback(playBtn); }
            });

            var camBtn = document.getElementById('notif-cam-btn');
            if (camBtn) camBtn.addEventListener('click', function() {
                var input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,video/*';
                input.onchange = function(e) {
                    var file = e.target.files && e.target.files[0];
                    if (file) {
                        var url = URL.createObjectURL(file);
                        var container = getContainer();
                        if (container) {
                            var bubble = document.createElement('div');
                            bubble.className = 'flex justify-end mb-4';
                            bubble.innerHTML = file.type.startsWith('image/')
                                ? '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><img src="' + url + '" class="w-full h-auto" alt="Uploaded"/></div>'
                                : '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><video src="' + url + '" controls class="w-full h-auto"></video></div>';
                            container.appendChild(bubble);
                            scrollToBottom();
                            setTimeout(function() {
                                var el = document.createElement('div');
                                el.className = 'flex items-start space-x-3 mb-4';
                                el.innerHTML = '<div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center relative"><img class="notif-shai-avatar w-full h-full object-cover" src="' + getShaiImg() + '" alt="ShAI"></div><div class="flex-1 min-w-0"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">Perfect! I can see your ' + (file.type.startsWith('video/') ? 'video' : 'image') + '. Let me find similar products.</p></div></div>';
                                container.appendChild(el);
                                scrollToBottom();
                            }, 1500);
                        }
                        input.value = '';
                    }
                };
                input.click();
            });
            var isRecording = false, mediaRecorder, audioChunks = [], startX, micAccessDenied = false, mediaStream = null;
            function removeTempBubble() {
                var t = document.getElementById('notif-temp-recording');
                if (t) t.remove();
            }
            function startRecording(e) {
                e.preventDefault();
                removeTempBubble();
                if (micAccessDenied) return;
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                var self = this;
                function doStart(stream) {
                    mediaStream = stream;
                    mediaRecorder = new MediaRecorder(stream);
                    isRecording = true;
                    audioChunks = [];
                    mediaRecorder.ondataavailable = function(ev) { if (ev.data.size > 0) audioChunks.push(ev.data); };
                    mediaRecorder.start();
                    self.classList.add('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                    var container = getContainer();
                    if (container) {
                        var tb = document.createElement('div');
                        tb.id = 'notif-temp-recording';
                        tb.className = 'flex justify-end mb-2';
                        tb.innerHTML = '<div class="flex items-center bg-[#939BFB] text-white rounded-2xl px-3 py-2 max-w-[70%]"><svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg><span class="text-xs">Recording... swipe left to cancel</span></div>';
                        container.appendChild(tb);
                        scrollToBottom();
                    }
                }
                try {
                    if (!mediaStream || !mediaStream.active) {
                        navigator.mediaDevices.getUserMedia({ audio: true }).then(doStart).catch(function(err) {
                            removeTempBubble();
                            if (err && (err.name === 'NotAllowedError' || err.name === 'SecurityError')) micAccessDenied = true;
                        });
                        return;
                    }
                    doStart(mediaStream);
                } catch (err) { removeTempBubble(); }
            }
            function stopRecording(e) {
                e.preventDefault();
                if (!isRecording) return;
                isRecording = false;
                this.classList.remove('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                removeTempBubble();
                if (mediaRecorder) {
                    mediaRecorder.stop();
                    mediaRecorder.onstop = function() {
                        var blob = new Blob(audioChunks, { type: 'audio/webm' });
                        var url = URL.createObjectURL(blob);
                        var container = getContainer();
                        if (container) {
                            var bubble = document.createElement('div');
                            bubble.className = 'flex justify-end mb-2';
                            bubble.innerHTML = '<div role="group" class="voice-message-bubble bg-[#939BFB] text-white rounded-full px-3 py-2 flex items-center gap-2 h-11 shadow-sm"><button class="play-btn flex-shrink-0 w-6 h-6 border border-white rounded-full flex items-center justify-center hover:bg-white/20 transition-all duration-150"><svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button><div class="waveform flex-1 flex items-center justify-center gap-0.5 h-4 max-w-[120px]"><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:8px;--i:0"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:12px;--i:1"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:6px;--i:2"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:16px;--i:3"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:10px;--i:4"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:14px;--i:5"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:8px;--i:6"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:12px;--i:7"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:6px;--i:8"></div><div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:10px;--i:9"></div></div><span class="duration-text text-white/90 text-xs font-medium flex-shrink-0">0:00</span><audio src="' + url + '" preload="metadata" class="hidden"></audio></div>';
                            container.appendChild(bubble);
                            var audioEl = bubble.querySelector('audio');
                            var durationEl = bubble.querySelector('.duration-text');
                            if (audioEl && durationEl) {
                                function setDuration() {
                                    var d = audioEl.duration;
                                    if (d && isFinite(d) && !isNaN(d)) {
                                        var sec = Math.ceil(d), m = Math.floor(sec / 60), s = sec % 60;
                                        durationEl.textContent = m + ':' + (s < 10 ? '0' : '') + s;
                                    }
                                }
                                audioEl.addEventListener('loadedmetadata', setDuration);
                                audioEl.addEventListener('durationchange', setDuration);
                                if (audioEl.readyState >= 1) setDuration();
                            }
                            scrollToBottom();
                            setTimeout(function() {
                                var el = document.createElement('div');
                                el.className = 'flex items-start space-x-3 mb-4';
                                el.innerHTML = '<div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center relative"><img class="notif-shai-avatar w-full h-full object-cover" src="' + getShaiImg() + '" alt="ShAI"><span class="notif-shai-placeholder hidden absolute inset-0 flex items-center justify-center text-gray-400 text-xs font-medium">AI</span></div><div class="flex-1 min-w-0"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">Got your voice message! Let me find the best options for you.</p></div></div>';
                                if (container) container.appendChild(el);
                                scrollToBottom();
                            }, 1000);
                        }
                    };
                }
            }
            function cancelRecording(e) {
                if (!isRecording) return;
                isRecording = false;
                this.classList.remove('scale-110', 'ring-2', 'ring-[#939BFB]', 'ring-offset-2');
                removeTempBubble();
                if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
            }
            function handleSwipeCancel(e) {
                if (!isRecording || !e.touches || !e.touches.length) return;
                if (startX - e.touches[0].clientX > 30) cancelRecording.call(this, e);
            }
            if (micBtn) {
                micBtn.addEventListener('mousedown', startRecording);
                micBtn.addEventListener('touchstart', startRecording);
                micBtn.addEventListener('mouseup', stopRecording);
                micBtn.addEventListener('mouseleave', cancelRecording);
                micBtn.addEventListener('touchend', stopRecording);
                micBtn.addEventListener('touchcancel', cancelRecording);
                micBtn.addEventListener('touchmove', handleSwipeCancel);
            }
            var micBtnCollapsed = document.getElementById('notif-mic-btn-collapsed');
            if (micBtnCollapsed) {
                micBtnCollapsed.addEventListener('mousedown', function(e) { e.preventDefault(); expandDrawer(); });
                micBtnCollapsed.addEventListener('touchstart', function(e) { e.preventDefault(); expandDrawer(); });
            }
            document.querySelectorAll('.notif-smart-prompt').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var t = this.textContent.trim();
                    if (!t) return;
                    var container = getContainer();
                    if (container) {
                        var userMsg = document.createElement('div');
                        userMsg.className = 'flex justify-end mb-4';
                        userMsg.innerHTML = '<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%] min-w-0"><p class="text-sm break-words whitespace-pre-wrap">' + t.replace(/</g, '&lt;') + '</p></div>';
                        container.appendChild(userMsg);
                        scrollToBottom();
                        setTimeout(function() {
                            var el = document.createElement('div');
                            el.className = 'flex items-start space-x-3 mb-4';
                            el.innerHTML = '<div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center relative"><img class="notif-shai-avatar w-full h-full object-cover" src="' + getShaiImg() + '" alt="ShAI"><span class="notif-shai-placeholder hidden absolute inset-0 flex items-center justify-center text-gray-400 text-xs font-medium">AI</span></div><div class="flex-1 min-w-0"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black break-words whitespace-pre-wrap">I\'d be happy to help you with that! Let me find some perfect options.</p></div></div>';
                            container.appendChild(el);
                            scrollToBottom();
                        }, 1000);
                    }
                });
            });
            if (addFriendBtn) addFriendBtn.addEventListener('click', function(e) { e.preventDefault(); showAddFriendFlow(); });
            if (backBtn) backBtn.addEventListener('click', hideAddFriendFlow);
            function showAddFriendFlow() {
                if (chatContent) chatContent.classList.add('hidden');
                if (addFriendContent) addFriendContent.classList.remove('hidden');
                if (backBtn) backBtn.classList.remove('hidden');
                renderAddFriendContacts();
                if (contactSearch) { contactSearch.value = ''; contactSearch.dispatchEvent(new Event('input')); }
            }
            function hideAddFriendFlow() {
                if (chatContent) chatContent.classList.remove('hidden');
                if (addFriendContent) addFriendContent.classList.add('hidden');
                if (backBtn) backBtn.classList.add('hidden');
                if (contactSearch) { contactSearch.value = ''; }
            }
            function getInitials(name) {
                var parts = (name || '').trim().split(/\s+/);
                return (parts[0] ? parts[0].slice(0, 1) : '') + (parts[1] ? parts[1].slice(0, 1) : '');
            }
            function renderAddFriendContacts() {
                if (!contactsContainer) return;
                var list = Array.isArray(window.__addFriendContacts) ? window.__addFriendContacts : [];
                try { var stored = localStorage.getItem('__contacts'); if (stored) list = JSON.parse(stored) || list; } catch (e) {}
                contactsContainer.innerHTML = list.map(function(c) {
                    var initials = getInitials(c.name);
                    var hasAvatar = c.goshopme && c.avatar;
                    var avatarHtml = hasAvatar ? '<div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0"><img src="' + (c.avatar || '').replace(/"/g, '&quot;') + '" alt="" class="w-full h-full object-cover"></div>' : '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-600 font-medium text-xs">' + initials + '</span></div>';
                    var btnHtml = c.goshopme ? '<button class="notif-contact-action bg-[#939BFB] text-white px-2 py-1 rounded-full text-xs font-medium">Add</button>' : '<button class="notif-contact-action bg-white text-[#939BFB] px-2 py-1 rounded-full text-xs font-medium border border-[#939BFB]">Invite</button>';
                    return '<div class="notif-contact-item flex items-center gap-2 p-2 bg-gray-50 rounded-xl" data-name="' + (c.name || '').replace(/"/g, '&quot;') + '" data-phone="' + (c.phone || '').replace(/"/g, '&quot;') + '" data-goshopme="' + (c.goshopme ? 'true' : 'false') + '">' + avatarHtml + '<div class="flex-1"><p class="font-medium text-sm text-black">' + (c.name || '').replace(/</g, '&lt;') + '</p><p class="text-xs text-gray-500">' + (c.phone || '').replace(/</g, '&lt;') + '</p></div>' + btnHtml + '</div>';
                }).join('');
            }
            function filterContacts(term) {
                var items = contactsContainer ? contactsContainer.querySelectorAll('.notif-contact-item') : [];
                var t = (term || '').toLowerCase();
                items.forEach(function(el) {
                    var match = ((el.getAttribute('data-name') || '') + (el.getAttribute('data-phone') || '')).toLowerCase().indexOf(t) !== -1;
                    el.style.display = match ? 'flex' : 'none';
                });
            }
            if (contactSearch) contactSearch.addEventListener('input', function() { filterContacts(this.value); });
            if (contactsContainer) contactsContainer.addEventListener('click', function(e) {
                if (!e.target.classList.contains('notif-contact-action')) return;
                var item = e.target.closest('.notif-contact-item');
                if (!item) return;
                var name = (item.querySelector('p') || {}).textContent || '';
                if (e.target.textContent === 'Add') {
                    var container = getContainer();
                    if (container) {
                        var notif = document.createElement('div');
                        notif.className = 'flex justify-center mb-4';
                        notif.innerHTML = '<div class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-xs font-medium">' + (name.split(' ')[0] || '') + ' has been added to chat</div>';
                        container.appendChild(notif);
                        scrollToBottom();
                    }
                    hideAddFriendFlow();
                } else if (e.target.textContent === 'Invite') {
                    var shareData = { title: 'Join me on GoShopMe', text: "Hey! I'm using GoShopMe.", url: 'https://app.goshopme.ai' };
                    if (navigator.share) navigator.share(shareData).catch(function() {});
                    else if (navigator.clipboard) navigator.clipboard.writeText(shareData.text + ' ' + shareData.url);
                }
            });
            renderAddFriendContacts();
            autoResizeInput();
            updateInputState();
            var dragHandleZone = document.getElementById('notif-chat-drag-handle-area');
            var isDragging = false, startY = 0, startHeight = 0;
            var minHeight = 20, maxHeight = 90;
            var drawerHeight = 50;
            if (dragHandleZone) {
                dragHandleZone.addEventListener('mousedown', startDrag);
                dragHandleZone.addEventListener('touchstart', startDrag, { passive: true });
            }
            function startDrag(e) {
                isDragging = true;
                startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
                startHeight = drawerHeight;
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
                document.addEventListener('touchcancel', stopDrag);
                e.preventDefault();
            }
            function drag(e) {
                if (!isDragging) return;
                var currentY = e.type === 'mousemove' ? e.clientY : (e.touches && e.touches[0] ? e.touches[0].clientY : startY);
                if (e.type === 'touchmove') e.preventDefault();
                var deltaY = startY - currentY;
                var newHeight = Math.min(maxHeight, Math.max(minHeight, startHeight + (deltaY / window.innerHeight) * 100));
                drawerHeight = newHeight;
                drawer.style.height = drawerHeight + 'vh';
            }
            function stopDrag() {
                if (!isDragging) return;
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchend', stopDrag);
                document.removeEventListener('touchcancel', stopDrag);
                var h = (drawer.getBoundingClientRect().height / window.innerHeight) * 100;
                if (h < 35) collapseDrawer();
                else { drawerHeight = Math.max(minHeight, Math.min(maxHeight, h)); drawer.style.height = drawerHeight + 'vh'; }
            }
        });
    })();
    </script>
    <script>
        (function() {
            var STORAGE_KEY = '__notifications';
            var DRAWER_OPENED_KEY = '__notificationsLastOpened';

            var defaultNotifications = [
                { id: 'n1', type: 'price_drop', title: 'Price Drop Alert!', body: 'Saved dress now $89 "” was $149', time: '5 minutes ago', read: false, actionLabel: 'View Item', link: 'Product_details_page.html?id=saved-dress&from=notifications' },
                { id: 'n2', type: 'restock', title: 'Back in Stock!', body: 'Those heels you loved are back in size 38', time: '2 hours ago', read: false, actionLabel: 'Shop Now', link: 'ShopbyCategory.html' },
                { id: 'n3', type: 'order', title: 'Order Update', body: 'Your order #SH2025419 has shipped!', time: 'Yesterday', read: false, actionLabel: 'Track Order', link: 'Order_Tracking.html' },
                { id: 'n4', type: 'shai', title: 'New from ShAI', body: 'New outfit match based on your DreamBox', time: '2 days ago', read: false, actionLabel: 'See Suggestion', link: 'Home.html' },
                { id: 'n5', type: 'creator', title: 'New Collection Drop', body: '@StyledByLea just dropped 2 new vacation looks', time: '3 days ago', read: false, actionLabel: 'View Collection', link: 'Creator`s Single_Collection.html', creatorAvatar: 'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg' },
                { id: 'n6', type: 'promo', title: 'Special Offer!', body: '20% off sitewide this weekend "” members only', time: '4 days ago', read: false, actionLabel: 'Shop Sale', link: 'ShopbyCategory.html' }
            ];

            function loadNotifications() {
                try {
                    var stored = localStorage.getItem(STORAGE_KEY);
                    if (stored === null) {
                        // No notifications stored at all â†’ show empty state
                        return [];
                    }
                    var data = JSON.parse(stored);
                    return Array.isArray(data) ? data : [];
                } catch (e) {}
                return [];
            }

            function saveNotifications(list) {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
                } catch (e) {}
            }

            function getUnreadCount() {
                return loadNotifications().filter(function(n) { return !n.read; }).length;
            }

            function updateBadge() {
                var badge = document.getElementById('notif-badge');
                if (!badge) return;
                var count = getUnreadCount();
                if (count > 0) {
                    badge.textContent = count > 99 ? '99+' : count;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }

            var icons = {
                price_drop: { bg: 'bg-shine-primary/10', icon: 'text-shine-primary', path: 'M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z M6 6h.008v.008H6V6z' },
                restock: { bg: 'bg-green-50', icon: 'text-green-500', path: 'M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99' },
                order: { bg: 'bg-blue-50', icon: 'text-blue-500', path: 'M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9' },
                shai: { bg: 'bg-purple-50', icon: 'text-purple-500', path: 'M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z' },
                creator: { bg: 'bg-gray-100', icon: '', path: '', avatar: true },
                promo: { bg: 'bg-shine-accent/10', icon: 'text-shine-accent', path: 'M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z' }
            };

            function renderNotifications() {
                var list = loadNotifications();
                var feed = document.getElementById('notifications-feed');
                var empty = document.getElementById('notifications-empty');
                if (!feed || !empty) return;
                feed.innerHTML = '';
                if (list.length === 0) {
                    feed.classList.add('hidden');
                    empty.classList.remove('hidden');
                    return;
                }
                feed.classList.remove('hidden');
                empty.classList.add('hidden');
                list.forEach(function(n) {
                    var cfg = icons[n.type] || icons.promo;
                    var avatarHtml = '';
                    if (cfg.avatar && n.creatorAvatar) {
                        avatarHtml = '<div class="w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-gray-100"><img src="' + (n.creatorAvatar || '').replace(/"/g, '&quot;') + '" alt="" class="w-full h-full object-cover"></div>';
                    } else if (!cfg.avatar) {
                        avatarHtml = '<div class="w-12 h-12 ' + cfg.bg + ' rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5 ' + cfg.icon + '" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="' + cfg.path + '"/></svg></div>';
                    } else {
                        avatarHtml = '<div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-gray-400 text-xs">?</span></div>';
                    }
                    var link = n.link || '#';
                    var readClass = n.read ? 'opacity-75' : '';
                    var html = '<div class="notification-item bg-white rounded-xl p-4 border border-gray-100 ' + readClass + '" data-id="' + (n.id || '').replace(/"/g, '&quot;') + '"><div class="flex gap-4">' + avatarHtml + '<div class="flex-1"><h3 class="poppins font-semibold text-sm text-gray-900">' + (n.title || '').replace(/</g, '&lt;') + '</h3><p class="dm-sans text-sm text-gray-600 mt-1">' + (n.body || '').replace(/</g, '&lt;') + '</p><span class="dm-sans text-xs text-gray-400 block mt-2">' + (n.time || '').replace(/</g, '&lt;') + '</span><a href="' + link.replace(/"/g, '&quot;') + '" class="mt-3 dm-sans text-sm text-shine-primary font-medium flex items-center gap-1 hover:underline">' + (n.actionLabel || 'View') + '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"/></svg></a></div></div></div>';
                    feed.insertAdjacentHTML('beforeend', html);
                });
            }

            function markAllAsRead() {
                var list = loadNotifications();
                var changed = false;
                list.forEach(function(n) { if (!n.read) { n.read = true; changed = true; } });
                if (changed) saveNotifications(list);
                updateBadge();
            }

            window.setNotifications = function(data) {
                saveNotifications(Array.isArray(data) ? data : []);
                renderNotifications();
                updateBadge();
            };

            window.addNotification = function(n) {
                var list = loadNotifications();
                n.id = n.id || 'n' + Date.now();
                n.read = false;
                list.unshift(n);
                saveNotifications(list);
                renderNotifications();
                updateBadge();
            };

            // On notifications screen, show the feed directly and mark all as read
            renderNotifications();
            markAllAsRead();
            renderNotifications();
            updateBadge();
        })();
    </script>
</body>
</html>


