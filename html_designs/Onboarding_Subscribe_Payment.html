<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <title>Payment Details - GoShopMe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'mobile': '390px',
                    },
                    colors: {
                        'shine-primary': '#939BFB',
                        'shine-accent': '#F96226',
                        primary: '#939BFB',
                        accent: '#F96226'
                    },
                    accentColor: {
                        primary: '#939BFB'
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'dm-sans': ['DM Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/chat-drawer-drag.css">

    
    <style>
        
/* ---- MOBILE FULL-WIDTH OVERRIDE (match Home) ---- */
@media screen and (max-width: 768px) {
  #app-shell, #main-content, #auth-screen, #welcome_screen, #quiz-screen, #onboarding-screen,
  #bottom-nav, #bottom-navigation, #header, #app-header,
  #chat-drawer, #chat-input-bar, #shai-chat-drawer, #return-chat-drawer, #return-chat-input-bar, #chat-input-collapsed,
  #shai-chat-drawer-wrapper, #chat-drawer-wrapper,
  body > div, body > main {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  [class*="left-1/2"][class*="-translate-x-1/2"]:not([class*="rounded-full"]) {
    left: 0 !important;
    right: 0 !important;
    max-width: 100vw !important;
    width: 100% !important;
    transform: none !important;
  }
  #chat-drawer.translate-y-full, #shai-chat-drawer.translate-y-full, #return-chat-drawer.translate-y-full {
    transform: translateY(100%) !important;
  }
  #bottom-nav > div, #bottom-navigation > div, nav#bottom-nav > div, nav#bottom-navigation > div {
    padding-top: 2px !important;
    padding-bottom: 24px !important;
  }
}

::-webkit-scrollbar { display: none; }
        body { font-family: 'DM Sans', sans-serif; }
        .poppins { font-family: 'Poppins', sans-serif; }
        .font-fuhkwang { font-family: 'Poppins', sans-serif; }
        .font-wix { font-family: 'DM Sans', sans-serif; }
        
        .mobile-container {
            max-width: 390px;
            margin: 0 auto;
            min-height: 844px;
            background: white;
        }
        
        @media (min-width: 391px) {
            .mobile-container {
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
            }
        }
        
        .input-error { border-color: #EF4444 !important; }
        .input-error:focus { --tw-ring-color: #EF4444 !important; }
        .error-msg { color: #EF4444; font-size: 12px; margin-top: 4px; }
        .header-icon-btn { transition: transform 0.2s ease, color 0.2s ease; }
        .header-icon-btn:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-white overflow-x-hidden">

<div class="mobile-container">
    <!-- Header -->
    <div id="header" class="sticky top-0 bg-white/90 backdrop-blur-lg z-50 border-b border-gray-100">
        <div class="flex items-center justify-between px-6 py-4">
            <button type="button" class="header-icon-btn w-10 h-10 flex items-center justify-center p-2 -ml-2 text-gray-600 hover:text-gray-800" onclick="goBack()" aria-label="Go back">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>
                </svg>
            </button>
            <h1 class="text-lg font-fuhkwang font-semibold text-black">Payment Details</h1>
            <div class="w-6"></div>
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="overflow-y-auto pb-8" style="height: calc(844px - 68px);">
        <!-- Hero Section -->
        <div id="hero-section" class="px-6 py-8 text-center">
            <h1 class="text-2xl font-fuhkwang font-semibold text-gray-900 mb-3">
                Activate Premium Plan
            </h1>
            <p class="text-gray-500 font-wix mb-3 text-base">
                19.99 EUR/month — Unlock unlimited AI searches, automated returns, and more.
            </p>
            <div class="inline-flex items-center bg-primary/10 px-4 py-2 rounded-full">
                <span class="text-sm text-primary font-medium">Billed Monthly — Cancel Anytime</span>
            </div>
        </div>

        <!-- Payment Form -->
        <div id="payment-form" class="px-6 space-y-4">
            <!-- Card Number -->
            <div class="space-y-2">
                <label class="block text-sm text-gray-600 font-wix">Card Number</label>
                <input type="text" id="card-number" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                <p id="card-number-error" class="error-msg hidden"></p>
            </div>

            <!-- Expiry and CVV -->
            <div class="grid grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label class="block text-sm text-gray-600 font-wix">Expiry Date</label>
                    <input type="text" id="expiry-date" inputmode="numeric" maxlength="5" placeholder="MM/YY" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                    <p id="expiry-error" class="error-msg hidden"></p>
                </div>
                <div class="space-y-2">
                    <label class="block text-sm text-gray-600 font-wix">CVV</label>
                    <input type="text" id="cvv" inputmode="numeric" maxlength="3" placeholder="123" pattern="[0-9]*" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                    <p id="cvv-error" class="error-msg hidden"></p>
                </div>
            </div>

            <!-- Cardholder Name -->
            <div class="space-y-2">
                <label class="block text-sm text-gray-600 font-wix">Cardholder Name</label>
                <input type="text" id="cardholder-name" placeholder="John Doe" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                <p id="cardholder-name-error" class="error-msg hidden"></p>
            </div>

            <!-- Billing Country -->
            <div class="space-y-2">
                <label class="block text-sm text-gray-600 font-wix">Billing Country</label>
                <select id="billing-country" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                    <option value="AF">Afghanistan</option>
                    <option value="AL">Albania</option>
                    <option value="DZ">Algeria</option>
                    <option value="AS">American Samoa</option>
                    <option value="AD">Andorra</option>
                    <option value="AO">Angola</option>
                    <option value="AI">Anguilla</option>
                    <option value="AQ">Antarctica</option>
                    <option value="AG">Antigua and Barbuda</option>
                    <option value="AR">Argentina</option>
                    <option value="AM">Armenia</option>
                    <option value="AW">Aruba</option>
                    <option value="AU">Australia</option>
                    <option value="AT">Austria</option>
                    <option value="AZ">Azerbaijan</option>
                    <option value="BS">Bahamas</option>
                    <option value="BH">Bahrain</option>
                    <option value="BD">Bangladesh</option>
                    <option value="BB">Barbados</option>
                    <option value="BY">Belarus</option>
                    <option value="BE">Belgium</option>
                    <option value="BZ">Belize</option>
                    <option value="BJ">Benin</option>
                    <option value="BM">Bermuda</option>
                    <option value="BT">Bhutan</option>
                    <option value="BO">Bolivia</option>
                    <option value="BA">Bosnia and Herzegovina</option>
                    <option value="BW">Botswana</option>
                    <option value="BR">Brazil</option>
                    <option value="BN">Brunei</option>
                    <option value="BG">Bulgaria</option>
                    <option value="BF">Burkina Faso</option>
                    <option value="BI">Burundi</option>
                    <option value="KH">Cambodia</option>
                    <option value="CM">Cameroon</option>
                    <option value="CA">Canada</option>
                    <option value="CV">Cape Verde</option>
                    <option value="KY">Cayman Islands</option>
                    <option value="CF">Central African Republic</option>
                    <option value="TD">Chad</option>
                    <option value="CL">Chile</option>
                    <option value="CN">China</option>
                    <option value="CO">Colombia</option>
                    <option value="KM">Comoros</option>
                    <option value="CG">Congo</option>
                    <option value="CD">Congo (Democratic Republic)</option>
                    <option value="CR">Costa Rica</option>
                    <option value="CI">Côte d'Ivoire</option>
                    <option value="HR">Croatia</option>
                    <option value="CU">Cuba</option>
                    <option value="CY">Cyprus</option>
                    <option value="CZ">Czech Republic</option>
                    <option value="DK">Denmark</option>
                    <option value="DJ">Djibouti</option>
                    <option value="DM">Dominica</option>
                    <option value="DO">Dominican Republic</option>
                    <option value="EC">Ecuador</option>
                    <option value="EG">Egypt</option>
                    <option value="SV">El Salvador</option>
                    <option value="GQ">Equatorial Guinea</option>
                    <option value="ER">Eritrea</option>
                    <option value="EE">Estonia</option>
                    <option value="ET">Ethiopia</option>
                    <option value="FJ">Fiji</option>
                    <option value="FI">Finland</option>
                    <option value="FR">France</option>
                    <option value="GA">Gabon</option>
                    <option value="GM">Gambia</option>
                    <option value="GE">Georgia</option>
                    <option value="DE">Germany</option>
                    <option value="GH">Ghana</option>
                    <option value="GR">Greece</option>
                    <option value="GD">Grenada</option>
                    <option value="GT">Guatemala</option>
                    <option value="GN">Guinea</option>
                    <option value="GW">Guinea-Bissau</option>
                    <option value="GY">Guyana</option>
                    <option value="HT">Haiti</option>
                    <option value="HN">Honduras</option>
                    <option value="HK">Hong Kong</option>
                    <option value="HU">Hungary</option>
                    <option value="IS">Iceland</option>
                    <option value="IN">India</option>
                    <option value="ID">Indonesia</option>
                    <option value="IR">Iran</option>
                    <option value="IQ">Iraq</option>
                    <option value="IE">Ireland</option>
                    <option value="IL">Israel</option>
                    <option value="IT">Italy</option>
                    <option value="JM">Jamaica</option>
                    <option value="JP">Japan</option>
                    <option value="JO">Jordan</option>
                    <option value="KZ">Kazakhstan</option>
                    <option value="KE">Kenya</option>
                    <option value="KI">Kiribati</option>
                    <option value="KP">North Korea</option>
                    <option value="KR">South Korea</option>
                    <option value="KW">Kuwait</option>
                    <option value="KG">Kyrgyzstan</option>
                    <option value="LA">Laos</option>
                    <option value="LV">Latvia</option>
                    <option value="LB">Lebanon</option>
                    <option value="LS">Lesotho</option>
                    <option value="LR">Liberia</option>
                    <option value="LY">Libya</option>
                    <option value="LI">Liechtenstein</option>
                    <option value="LT">Lithuania</option>
                    <option value="LU">Luxembourg</option>
                    <option value="MO">Macao</option>
                    <option value="MG">Madagascar</option>
                    <option value="MW">Malawi</option>
                    <option value="MY">Malaysia</option>
                    <option value="MV">Maldives</option>
                    <option value="ML">Mali</option>
                    <option value="MT">Malta</option>
                    <option value="MH">Marshall Islands</option>
                    <option value="MR">Mauritania</option>
                    <option value="MU">Mauritius</option>
                    <option value="MX">Mexico</option>
                    <option value="FM">Micronesia</option>
                    <option value="MD">Moldova</option>
                    <option value="MC">Monaco</option>
                    <option value="MN">Mongolia</option>
                    <option value="ME">Montenegro</option>
                    <option value="MA">Morocco</option>
                    <option value="MZ">Mozambique</option>
                    <option value="MM">Myanmar</option>
                    <option value="NA">Namibia</option>
                    <option value="NR">Nauru</option>
                    <option value="NP">Nepal</option>
                    <option value="NL">Netherlands</option>
                    <option value="NZ">New Zealand</option>
                    <option value="NI">Nicaragua</option>
                    <option value="NE">Niger</option>
                    <option value="NG">Nigeria</option>
                    <option value="NO">Norway</option>
                    <option value="OM">Oman</option>
                    <option value="PK">Pakistan</option>
                    <option value="PW">Palau</option>
                    <option value="PA">Panama</option>
                    <option value="PG">Papua New Guinea</option>
                    <option value="PY">Paraguay</option>
                    <option value="PE">Peru</option>
                    <option value="PH">Philippines</option>
                    <option value="PL">Poland</option>
                    <option value="PT">Portugal</option>
                    <option value="PR">Puerto Rico</option>
                    <option value="QA">Qatar</option>
                    <option value="RO">Romania</option>
                    <option value="RU">Russia</option>
                    <option value="RW">Rwanda</option>
                    <option value="KN">Saint Kitts and Nevis</option>
                    <option value="LC">Saint Lucia</option>
                    <option value="VC">Saint Vincent and the Grenadines</option>
                    <option value="WS">Samoa</option>
                    <option value="SM">San Marino</option>
                    <option value="ST">Sao Tome and Principe</option>
                    <option value="SA">Saudi Arabia</option>
                    <option value="SN">Senegal</option>
                    <option value="RS">Serbia</option>
                    <option value="SC">Seychelles</option>
                    <option value="SL">Sierra Leone</option>
                    <option value="SG">Singapore</option>
                    <option value="SK">Slovakia</option>
                    <option value="SI">Slovenia</option>
                    <option value="SB">Solomon Islands</option>
                    <option value="SO">Somalia</option>
                    <option value="ZA">South Africa</option>
                    <option value="SS">South Sudan</option>
                    <option value="ES">Spain</option>
                    <option value="LK">Sri Lanka</option>
                    <option value="SD">Sudan</option>
                    <option value="SR">Suriname</option>
                    <option value="SE">Sweden</option>
                    <option value="CH">Switzerland</option>
                    <option value="SY">Syria</option>
                    <option value="TW">Taiwan</option>
                    <option value="TJ">Tajikistan</option>
                    <option value="TZ">Tanzania</option>
                    <option value="TH">Thailand</option>
                    <option value="TL">Timor-Leste</option>
                    <option value="TG">Togo</option>
                    <option value="TO">Tonga</option>
                    <option value="TT">Trinidad and Tobago</option>
                    <option value="TN">Tunisia</option>
                    <option value="TR">Turkey</option>
                    <option value="TM">Turkmenistan</option>
                    <option value="TV">Tuvalu</option>
                    <option value="UG">Uganda</option>
                    <option value="UA">Ukraine</option>
                    <option value="AE">United Arab Emirates</option>
                    <option value="GB">United Kingdom</option>
                    <option value="US" selected>United States</option>
                    <option value="UY">Uruguay</option>
                    <option value="UZ">Uzbekistan</option>
                    <option value="VU">Vanuatu</option>
                    <option value="VE">Venezuela</option>
                    <option value="VN">Vietnam</option>
                    <option value="YE">Yemen</option>
                    <option value="ZM">Zambia</option>
                    <option value="ZW">Zimbabwe</option>
                </select>
            </div>

            <!-- Billing Address -->
            <div class="space-y-4">
                <div class="space-y-2">
                    <label class="block text-sm text-gray-600 font-wix mb-2">Address Line 1</label>
                    <input type="text" id="address-line-1" placeholder="Street address" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                    <p id="address-line-1-error" class="error-msg hidden"></p>
                </div>
                <div>
                    <label class="block text-sm text-gray-600 font-wix mb-2">Address Line 2 (Optional)</label>
                    <input type="text" id="address-line-2" placeholder="Apartment, suite, unit, building, floor, etc." class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                </div>
                <div class="space-y-2">
                    <label class="block text-sm text-gray-600 font-wix mb-2">City</label>
                    <input type="text" id="city" placeholder="Enter city" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                    <p id="city-error" class="error-msg hidden"></p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm text-gray-600 font-wix">State/Province</label>
                        <input type="text" id="state" placeholder="State/Province" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                        <p id="state-error" class="error-msg hidden"></p>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm text-gray-600 font-wix">ZIP/Postal Code</label>
                        <input type="text" id="zip-code" placeholder="ZIP code" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg font-wix focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-colors text-base">
                        <p id="zip-code-error" class="error-msg hidden"></p>
                    </div>
                </div>
            </div>

            <!-- Save Payment Info -->
            <div class="flex items-center space-x-3 py-2">
                <label class="relative flex items-center cursor-pointer">
                    <span class="relative w-5 h-5 flex items-center justify-center shrink-0">
                        <input type="checkbox" id="save-payment" checked class="peer sr-only">
                        <div class="absolute inset-0 w-5 h-5 rounded border-2 border-gray-300 bg-white peer-checked:border-primary peer-checked:bg-primary transition-colors"></div>
                        <svg class="relative w-3 h-3 text-white opacity-0 peer-checked:opacity-100 transition-opacity pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 13l4 4L19 7"/>
                        </svg>
                    </span>
                    <span class="ml-3 text-sm font-wix text-gray-700">Save this payment method</span>
                </label>
            </div>
        </div>

        <!-- Security Assurance -->
        <div id="security-section" class="px-6 py-6">
            <div class="bg-white rounded-lg border border-gray-200 p-4">
                <div class="flex items-center space-x-3 mb-3">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-wix text-black">Your payment is secured with 256-bit SSL encryption</span>
                </div>
                <div class="flex items-center justify-center space-x-3">
                    <div class="text-xs text-gray-500">We accept:</div>
                    <div class="flex space-x-2">
                        <div class="w-8 h-5 bg-[#1A1F71] rounded flex items-center justify-center">
                            <span class="text-[10px] font-bold text-white">VISA</span>
                        </div>
                        <div class="w-8 h-5 bg-[#EB001B] rounded flex items-center justify-center">
                            <span class="text-[10px] font-bold text-white">MC</span>
                        </div>
                        <div class="w-8 h-5 bg-[#006FCF] rounded flex items-center justify-center">
                            <span class="text-[10px] font-bold text-white">AMEX</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div id="action-buttons" class="px-6 space-y-2 flex flex-col items-center">
            <button type="button" id="submit-payment" class="w-3/4 flex items-center justify-center space-x-2 py-2.5 px-3 rounded-full bg-primary text-white font-medium text-sm shadow-md shadow-primary/20 hover:bg-primary/90 transition-colors font-wix">
                Start My Premium Plan
            </button>
            
            <button class="w-3/4 flex items-center justify-center space-x-2 py-2.5 px-3 rounded-full border border-[#B7C7FF] text-primary bg-white hover:bg-primary hover:text-white transition-colors" onclick="goBack()">
                <svg class="w-4 h-4 text-current" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>
                </svg>
                <span class="font-medium text-sm font-wix">Go Back to Plan Selection</span>
            </button>
        </div>

        <!-- Legal Disclaimer -->
        <div id="legal-disclaimer" class="px-6 py-6 text-center">
            <p class="text-xs text-gray-400 leading-relaxed font-wix">
                By confirming, you agree to monthly billing at 19.99 EUR/month. You can cancel anytime in your settings.
            </p>
        </div>
    </div>
</div>

<script>
function goBack() {
    window.location.href = 'Onboarding_Choose_Plan.html';
}

// Validation helpers
function luhnCheck(value) {
    const digits = value.replace(/\D/g, '');
    let sum = 0;
    let isEven = false;
    for (let i = digits.length - 1; i >= 0; i--) {
        let digit = parseInt(digits[i], 10);
        if (isEven) {
            digit *= 2;
            if (digit > 9) digit -= 9;
        }
        sum += digit;
        isEven = !isEven;
    }
    return sum % 10 === 0;
}

function validateCardNumber(value) {
    const digits = (value || '').replace(/\s/g, '').replace(/[^0-9]/g, '');
    if (digits.length === 0) return 'Please enter your card number';
    if (digits.length < 13 || digits.length > 19) return 'Please enter a valid card number (13–19 digits)';
    if (!luhnCheck(value)) return 'Please enter a valid card number';
    return '';
}

function validateExpiry(value) {
    if (!value || value.trim() === '') return 'Please enter the expiry date';
    if (value.length !== 5) return 'Please enter expiry as MM/YY';
    const [mm, yy] = value.split('/');
    const month = parseInt(mm, 10);
    const year = parseInt('20' + yy, 10);
    if (month < 1 || month > 12) return 'Please enter a valid month (01–12)';
    const now = new Date();
    const expDate = new Date(year, month, 0);
    if (expDate < now) return 'This card has expired';
    return '';
}

function validateCVV(value) {
    const digits = (value || '').replace(/\D/g, '');
    if (digits.length === 0) return 'Please enter your CVV';
    if (digits.length !== 3) return 'CVV must be 3 digits';
    return '';
}

function validateCardholderName(value) {
    if (!value || value.trim() === '') return 'Please enter the cardholder name';
    const latinOnly = /^[A-Za-z\s\-']+$/;
    if (!latinOnly.test(value.trim())) return 'Cardholder name must contain only Latin letters (A–Z, a–z)';
    if (value.trim().length < 2) return 'Please enter a valid cardholder name';
    return '';
}

function validateAddressLine1(value) {
    if (!value || value.trim() === '') return 'Please enter your address';
    if (value.trim().length < 5) return 'Please enter a valid address';
    return '';
}

function validateCity(value) {
    if (!value || value.trim() === '') return 'Please enter your city';
    if (value.trim().length < 2) return 'Please enter a valid city';
    return '';
}

function validateState(value) {
    if (!value || value.trim() === '') return 'Please enter state/province';
    if (value.trim().length < 2) return 'Please enter a valid state/province';
    return '';
}

function validateZipCode(value) {
    if (!value || value.trim() === '') return 'Please enter ZIP/postal code';
    const trimmed = value.trim();
    if (trimmed.length < 3 || trimmed.length > 12) return 'Please enter a valid ZIP/postal code';
    return '';
}

function showError(inputId, errorId, msg) {
    const input = document.getElementById(inputId);
    const errorEl = document.getElementById(errorId);
    if (msg) {
        if (input) input.classList.add('input-error');
        if (errorEl) { errorEl.textContent = msg; errorEl.classList.remove('hidden'); }
    } else {
        if (input) input.classList.remove('input-error');
        if (errorEl) { errorEl.textContent = ''; errorEl.classList.add('hidden'); }
    }
}

function validateForm() {
    const cardVal = document.getElementById('card-number').value;
    const expiryVal = document.getElementById('expiry-date').value;
    const cvvVal = document.getElementById('cvv').value;
    const cardholderVal = document.getElementById('cardholder-name').value;
    const address1Val = document.getElementById('address-line-1').value;
    const cityVal = document.getElementById('city').value;
    const stateVal = document.getElementById('state').value;
    const zipVal = document.getElementById('zip-code').value;
    
    const cardErr = validateCardNumber(cardVal);
    const expiryErr = validateExpiry(expiryVal);
    const cvvErr = validateCVV(cvvVal);
    const cardholderErr = validateCardholderName(cardholderVal);
    const address1Err = validateAddressLine1(address1Val);
    const cityErr = validateCity(cityVal);
    const stateErr = validateState(stateVal);
    const zipErr = validateZipCode(zipVal);
    
    showError('card-number', 'card-number-error', cardErr);
    showError('expiry-date', 'expiry-error', expiryErr);
    showError('cvv', 'cvv-error', cvvErr);
    showError('cardholder-name', 'cardholder-name-error', cardholderErr);
    showError('address-line-1', 'address-line-1-error', address1Err);
    showError('city', 'city-error', cityErr);
    showError('state', 'state-error', stateErr);
    showError('zip-code', 'zip-code-error', zipErr);
    
    return !cardErr && !expiryErr && !cvvErr && !cardholderErr && !address1Err && !cityErr && !stateErr && !zipErr;
}

// Submit handler
document.getElementById('submit-payment').addEventListener('click', function() {
    if (validateForm()) {
        var paymentData = {
            cardNumber: document.getElementById('card-number').value.replace(/\s/g, ''),
            expiryDate: document.getElementById('expiry-date').value,
            cvv: document.getElementById('cvv').value,
            cardholderName: document.getElementById('cardholder-name')?.value || '',
            billingCountry: document.getElementById('billing-country')?.value || '',
            addressLine1: document.getElementById('address-line-1')?.value || '',
            addressLine2: document.getElementById('address-line-2')?.value || '',
            city: document.getElementById('city')?.value || '',
            state: document.getElementById('state')?.value || '',
            zipCode: document.getElementById('zip-code')?.value || '',
            savePayment: document.getElementById('save-payment')?.checked || false
        };
        if (typeof window.GoShopMeOnboardingAPI !== 'undefined' && window.GoShopMeOnboardingAPI.submitPayment) {
            window.GoShopMeOnboardingAPI.submitPayment(paymentData);
        }
        try { sessionStorage.setItem('__showPaymentSuccessBanner', '1'); } catch (e) {}
        window.location.href = 'QuizOrSkip_Success_Subscribe.html';
    }
});

// API readiness: prefill from window.__PAYMENT_DATA__
(function() {
    window.getPaymentData = function() {
        return {
            cardNumber: document.getElementById('card-number')?.value || '',
            expiryDate: document.getElementById('expiry-date')?.value || '',
            cvv: document.getElementById('cvv')?.value || '',
            billingCountry: document.getElementById('billing-country')?.value || ''
        };
    };
    window.setPaymentData = function(data) {
        if (!data) return;
        if (data.cardNumber) document.getElementById('card-number').value = data.cardNumber;
        if (data.expiryDate) document.getElementById('expiry-date').value = data.expiryDate;
        if (data.cvv) document.getElementById('cvv').value = data.cvv;
        if (data.billingCountry) { var sel = document.getElementById('billing-country'); if (sel) sel.value = data.billingCountry; }
    };
    document.addEventListener('DOMContentLoaded', function() {
        if (window.__PAYMENT_DATA__) window.setPaymentData(window.__PAYMENT_DATA__);
    });
})();

// Auto-format card number
document.getElementById('card-number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
    e.target.value = formattedValue;
});

// Auto-format expiry date
document.getElementById('expiry-date').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 2) {
        value = value.substring(0,2) + '/' + value.substring(2,4);
    }
    e.target.value = value;
});

// CVV: digits only, max 3
document.getElementById('cvv').addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 3);
});

// Cardholder name: Latin letters only (A-Z, a-z, spaces, hyphens, apostrophes)
document.getElementById('cardholder-name').addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/[^A-Za-z\s\-']/g, '');
});

// Clear error on input
['card-number', 'expiry-date', 'cvv', 'cardholder-name', 'address-line-1', 'city', 'state', 'zip-code'].forEach(function(id) {
    const input = document.getElementById(id);
    const errorIdMap = { 'card-number': 'card-number-error', 'expiry-date': 'expiry-error', 'cvv': 'cvv-error', 'cardholder-name': 'cardholder-name-error', 'address-line-1': 'address-line-1-error', 'city': 'city-error', 'state': 'state-error', 'zip-code': 'zip-code-error' };
    const errorId = errorIdMap[id] || id + '-error';
    input.addEventListener('input', function() { showError(id, errorId, ''); });
});
</script>

</body></html>
