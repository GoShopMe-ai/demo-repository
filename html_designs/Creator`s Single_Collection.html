<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Power Looks for Fall - GoShopMe</title>
    <link rel="stylesheet" href="css/mobile-optimization.css">
<script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=Karla:wght@400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shine-primary': '#939BFB',
                        'shine-accent': '#F96226',
                        'primary': '#939BFB',
                        'secondary-orange': '#F96226',
                        'secondary-blue': '#B7C7FF'
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'dm-sans': ['DM Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { display: none; }
        * { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .dm-sans { font-family: 'DM Sans', 'Karla', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .poppins { font-family: 'Poppins', sans-serif; }
        .font-fahkwang { font-family: 'Poppins', sans-serif; }
        .container-mobile { max-width: 390px; margin-left: auto; margin-right: auto; width: 100%; }
        .chat-drawer { transition: transform 0.3s ease-in-out, height 0.3s ease-in-out; }
        .icon-button svg { width: 18px; height: 18px; stroke-width: 1.5; }
        .icon-button:hover svg { color: #939BFB; }
        .bottom-nav-btn { display: flex; flex-direction: column; align-items: center; color: #6B7280; transition: color 0.2s ease-in-out; }
        .bottom-nav-btn:hover, .bottom-nav-btn.active { color: #939BFB; }
        .bottom-nav-btn:hover svg, .bottom-nav-btn:hover span, .bottom-nav-btn.active svg, .bottom-nav-btn.active span { color: #939BFB; }
        .bottom-nav-btn svg { width: 20px; height: 20px; stroke-width: 1.5; margin-bottom: 4px; }
        .heart-filled { fill: #939BFB !important; stroke: #939BFB !important; }
        .share-icon-tilted { transform: rotate(-35deg); }
        [id^="product-"] { cursor: pointer; }
        [id^="product-"] .heart-btn, [id^="product-"] .share-btn, [id^="product-"] .chat-trigger { cursor: pointer; }
        .drag-handle { background: #D1D5DB; width: 40px; height: 4px; border-radius: 9999px; margin: 8px auto; cursor: grab; }
        .drag-handle:active { cursor: grabbing; }
    </style>
</head>
<body class="bg-[#F6F6F6] min-h-screen text-black overflow-x-hidden">

    <!-- App Shell - 390px max, centered on desktop (design system) -->
    <div id="app-shell" class="relative w-full max-w-[390px] mx-auto min-h-screen bg-white shadow-2xl">

    <!-- App Header - design system: max-w-[390px], centered -->
    <header id="app-header" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 bg-white/95 backdrop-blur-sm border-b border-gray-100">
        <div class="flex items-center justify-between px-4 py-3">
            <div class="flex items-center space-x-3">
                <a href="Creator`s Collections_Page.html" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors" aria-label="Back">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>
                    </svg>
                </a>
            </div>
            <h1 id="collection-page-title" class="text-lg poppins font-semibold text-black absolute left-1/2 transform -translate-x-1/2">Collection</h1>
            <div class="flex items-center space-x-3">
                <button id="notif-btn" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-visible">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/>
                    </svg>
                    <div id="notif-indicator" class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-[#F96226] rounded-full hidden flex items-center justify-center min-w-[12px]"><span id="notif-count" class="text-[10px] text-white font-medium leading-none"></span></div>
                </button>
                <button id="cart-btn" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors relative overflow-visible">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993z"/>
                    </svg>
                    <div id="cart-indicator" class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-[#939BFB] rounded-full hidden flex items-center justify-center min-w-[12px]"><span id="cart-count" class="text-[10px] text-white font-medium leading-none"></span></div>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content - design system: max-w-[390px], centered, overflow-x-hidden -->
    <main id="main-content" class="pt-16 pb-[140px] relative w-full max-w-[390px] mx-auto overflow-y-auto overflow-x-hidden">
        
        <!-- Background Content -->
        <div id="background-content" class="min-h-screen">
            
            <!-- Creator Header -->
            <section id="creator-collection-header" class="px-4 py-6 border-b border-gray-100">
                <div class="container-mobile">
                    <!-- Centered Creator Info -->
                    <div class="text-center">
                        <!-- Creator Profile Picture - Centered and Larger -->
                        <div id="creator-avatar-wrap" class="w-24 h-24 rounded-full overflow-hidden border-2 border-primary/20 mx-auto mb-4 bg-gray-200 flex items-center justify-center">
                            <img id="creator-avatar" class="w-full h-full object-cover hidden" src="" alt="">
                            <span id="creator-avatar-initials" class="text-gray-500 text-2xl font-medium">?</span>
                        </div>
                        
                        <!-- Creator Name and Title -->
                        <h2 id="creator-name" class="text-xl font-fahkwang font-bold text-black mb-1">—</h2>
                        <p id="creator-tagline" class="text-sm text-gray-600 mb-4">—</p>
                        
                        <!-- Follow Button -->
                        <div class="mb-4">
                            <button id="creator-follow-btn" class="px-4 py-2 bg-primary text-white rounded-full text-sm font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-1.5 mx-auto">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                                Follow
                            </button>
                        </div>
                        
                        <!-- Social Media Buttons - dynamic from creator.social -->
                        <div id="creator-social-links" class="flex items-center justify-center space-x-3 mb-6">
                            <!-- Populated by loadSingleCollection -->
                        </div>
                    </div>
                    
                    <!-- Collection Info -->
                    <div class="text-center">
                        <h3 id="collection-name" class="text-2xl font-fahkwang font-bold text-black mb-2">—</h3>
                        <p id="collection-description" class="text-sm text-gray-600 mb-4">—</p>
                        <div id="collection-meta" class="flex items-center justify-center space-x-4 text-sm text-gray-500">
                            <span>0 items</span>
                            <span>•</span>
                            <span>—</span>
                            <span>•</span>
                            <span>0 saves</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Collection Cover Image/Video - Dynamic (below title and subtitle) -->
            <section id="collection-cover-section" class="relative w-full h-[300px] overflow-hidden bg-gray-100">
                <div id="collection-cover-container" class="w-full h-full">
                    <!-- Populated dynamically by loadSingleCollection -->
                </div>
            </section>

            <!-- Product Listing - dynamic from collection.products -->
            <section id="products-list" class="px-4 py-6">
                <div id="products-container" class="container-mobile space-y-6 w-full">
                    <!-- Product cards populated by loadSingleCollection -->
                </div>
            </section>

        </div>

        <!-- Chat Drawer Overlay - design system: z-40, bg-black/40 -->
        <div id="chat-overlay" class="fixed inset-0 bg-black/40 z-40 hidden"></div>

        <!-- ShAI Chat Drawer - design system: max-w-[390px], bottom-16, centered -->
        <div id="shai-chat-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-50 bg-white rounded-t-3xl shadow-2xl h-[80vh] transform translate-y-full transition-transform duration-300 flex flex-col">
            <!-- Drag Handle - design system: w-10 h-1, centered -->
            <div class="flex justify-center pt-2 flex-shrink-0">
                <div id="drawer-drag-handle" class="drag-handle w-10 h-1 bg-gray-300 rounded-full cursor-pointer"></div>
            </div>
            
            <!-- Drawer Header - design system: ShAI avatar placeholder -->
            <div id="drawer-header" class="flex items-center p-4 pb-2 flex-shrink-0">
                <button id="back-button" class="mr-3 hidden hover:opacity-70 transition-opacity">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
                </button>
                <div id="shai-avatar-container" class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0 bg-gray-200 flex items-center justify-center">
                    <img id="shai-avatar" class="w-full h-full object-cover hidden" src="" alt="ShAI avatar" data-placeholder="true">
                    <span id="shai-avatar-placeholder" class="text-gray-500 text-xs font-medium">AI</span>
                </div>
                <div class="flex-1">
                    <p id="drawer-title" class="font-semibold text-black text-sm">ShAI</p>
                    <p id="drawer-subtitle" class="text-xs text-gray-500">Your shopping assistant</p>
                </div>
            </div>

            <!-- Chat Messages - design system: rounded-tl-md -->
            <div id="chat-messages" class="flex-1 overflow-y-auto min-h-0">
                <div class="p-4 pb-0">
                <!-- ShAI Greeting - use avatar placeholder -->
                <div class="flex items-start space-x-3 mb-4">
                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-500 text-xs font-medium">AI</span></div>
                    <div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 max-w-xs">
                        <p class="text-sm text-black">I see you're browsing this collection! These pieces are perfect for making a strong impression. Which item caught your eye?</p>
                    </div>
                </div>

                <!-- Smart Prompt Chips - design system: border-[#B7C7FF] -->
                <div class="flex flex-wrap gap-2 mb-4 ml-11">
                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Show me similar items</button>
                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">What's my size?</button>
                    <button class="bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium flex-shrink-0 hover:bg-[#939BFB] hover:text-white transition-colors">Complete the look</button>
                </div>
                </div>
            </div>

            <!-- Add Friend Flow Content - match Home -->
            <div id="add-friend-content" class="hidden flex-1 flex flex-col min-h-0">
                <div id="contact-list" class="flex-1 overflow-y-auto p-4 pb-24">
                    <div class="mb-4">
                        <div class="relative">
                            <svg class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                            <input type="text" id="contact-search" placeholder="Search contacts..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pl-10 text-sm">
                        </div>
                    </div>
                    <div id="contacts-container" class="space-y-2"><!-- Contacts rendered dynamically --></div>
                </div>
            </div>

            <!-- Chat Input Bar - Inside Drawer - design system: textarea, icon-button -->
            <div class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
                <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                    <button id="cam-btn-drawer" class="icon-button hover:opacity-70 transition-opacity" aria-label="Add image or video">
                        <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
                        </svg>
                    </button>
                    <textarea id="chat-input-drawer" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans resize-none min-h-[24px] max-h-[144px] overflow-y-auto" rows="1"></textarea>
                    <button id="add-friend-button-drawer" class="icon-button hover:opacity-70 transition-opacity"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg></button>
                    <button id="mic-button-drawer" class="icon-button hover:opacity-70 transition-opacity" aria-label="Record voice"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg></button>
                    <button id="send-button-drawer" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity"><svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button>
                </div>
            </div>
        </div>

        <!-- Chat Input Bar - Collapsed State - design system: max-w-[390px], bottom-16 -->
        <div id="chat-input-collapsed" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] z-30 bg-white border-t border-gray-100 p-4">
            <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
                <button id="cam-btn" class="icon-button hover:opacity-70 transition-opacity" aria-label="Add image or video">
                    <svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
                    </svg>
                </button>
                <textarea id="chat-input-collapsed-field" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 dm-sans resize-none min-h-[24px] max-h-[144px] overflow-y-auto" rows="1"></textarea>
                <button id="add-friend-button-collapsed" class="icon-button hover:opacity-70 transition-opacity"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg></button>
                <button id="mic-button-collapsed" class="icon-button hover:opacity-70 transition-opacity" aria-label="Record voice"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg></button>
                <button id="send-button-collapsed" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity"><svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation - design system: max-w-[390px], Picks not Collections -->
    <nav id="bottom-navigation" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 z-50">
        <div class="flex items-center justify-around py-2">
            <a href="Home.html" class="bottom-nav-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>
                <span class="text-xs">Home</span>
            </a>
            <a href="Picks.html" class="bottom-nav-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/></svg>
                <span class="text-xs">Picks</span>
            </a>
            <a href="Wishlist.html" class="bottom-nav-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>
                <span class="text-xs">Wishlist</span>
            </a>
            <a id="single-nav-profile-link" href="User_Profile_Free_Plan.html" class="bottom-nav-btn">
                <span id="single-nav-profile-icon" class="flex items-center justify-center w-6 h-6 mb-1 text-shine-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                </span>
                <img id="single-nav-profile-photo" class="w-6 h-6 rounded-full object-cover mb-1 hidden" src="" alt="Profile">
                <span class="text-xs">Profile</span>
            </a>
        </div>
    </nav>

    <script>
    // Header badges - design system (match Creator Collections)
    var cartCountValue = 0, notifCountValue = 0;
    function getBadgeEls() { return { cartIndicator: document.getElementById('cart-indicator'), cartCount: document.getElementById('cart-count'), notifIndicator: document.getElementById('notif-indicator'), notifCount: document.getElementById('notif-count') }; }
    function updateCartBadge() { var e = getBadgeEls(); if (e.cartIndicator && e.cartCount) { var s = cartCountValue > 0; e.cartIndicator.classList.toggle('hidden', !s); e.cartCount.textContent = s ? (cartCountValue > 99 ? '99+' : cartCountValue) : ''; } }
    function updateNotifBadge() { var e = getBadgeEls(); if (e.notifIndicator && e.notifCount) { var s = notifCountValue > 0; e.notifIndicator.classList.toggle('hidden', !s); e.notifCount.textContent = s ? (notifCountValue > 99 ? '99+' : notifCountValue) : ''; } }
    window.addToCart = function() { cartCountValue++; updateCartBadge(); };
    window.addNotification = function() { notifCountValue++; updateNotifBadge(); };
    window.setCartCount = function(n) { cartCountValue = Math.max(0, n); updateCartBadge(); };
    window.setNotifCount = function(n) { notifCountValue = Math.max(0, n); updateNotifBadge(); };
    document.addEventListener('DOMContentLoaded', function() { updateCartBadge(); updateNotifBadge(); });
    </script>
    <script>
    // Bottom nav profile - design system (dynamic href + photo)
    (function() {
        var plan = (localStorage.getItem('__userPlan') || '').toLowerCase();
        var profileHref = (plan === 'paid' || plan === 'true') ? 'User_Profile_Paid_Plan.html' : 'User_Profile_Free_Plan.html';
        var profileLink = document.getElementById('single-nav-profile-link');
        if (profileLink) profileLink.href = profileHref;
        var saved = null;
        try { saved = localStorage.getItem('profilePhoto'); } catch (e) {}
        var img = document.getElementById('single-nav-profile-photo');
        var icon = document.getElementById('single-nav-profile-icon');
        if (img && icon) {
            if (saved) { img.src = saved; img.classList.remove('hidden'); icon.classList.add('hidden'); }
            else { img.classList.add('hidden'); icon.classList.remove('hidden'); }
        }
        window.setProfilePhoto = function(url) {
            try { if (url) localStorage.setItem('profilePhoto', url); else localStorage.removeItem('profilePhoto'); } catch (e) {}
            var i = document.getElementById('single-nav-profile-photo');
            var ic = document.getElementById('single-nav-profile-icon');
            if (i && ic) {
                if (url) { i.src = url; i.classList.remove('hidden'); ic.classList.add('hidden'); }
                else { i.src = ''; i.classList.add('hidden'); ic.classList.remove('hidden'); }
            }
        };
    })();
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load collection + creator from Creator Collections (__singleCollectionData: { collection, creator })
            window.loadSingleCollection = function(data) {
                if (!data) return;
                const col = data.collection || {};
                const creator = data.creator || {};
                const products = Array.isArray(col.products) ? col.products : [];
                const SOCIAL = { instagram: { url: 'https://instagram.com/', path: 'M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z' }, tiktok: { url: 'https://www.tiktok.com/@', path: 'M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z' }, youtube: { url: 'https://youtube.com/@', path: 'M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z' } };
                const creatorAvatar = document.getElementById('creator-avatar');
                const creatorInitials = document.getElementById('creator-avatar-initials');
                const creatorName = document.getElementById('creator-name');
                const creatorTagline = document.getElementById('creator-tagline');
                const creatorFollowBtn = document.getElementById('creator-follow-btn');
                const creatorSocialLinks = document.getElementById('creator-social-links');
                const collectionName = document.getElementById('collection-name');
                const collectionDesc = document.getElementById('collection-description');
                const collectionMeta = document.getElementById('collection-meta');
                const collectionPageTitle = document.getElementById('collection-page-title');
                const productsContainer = document.getElementById('products-container');
                const collectionCoverContainer = document.getElementById('collection-cover-container');
                // Render collection cover (image or video)
                if (collectionCoverContainer) {
                    const coverType = col.coverType || 'image';
                    const coverUrl = col.coverImage || col.coverVideo || '';
                    if (coverUrl) {
                        if (coverType === 'video') {
                            collectionCoverContainer.innerHTML = '<video class="w-full h-full object-cover" src="' + coverUrl.replace(/"/g, '&quot;') + '" autoplay muted loop playsinline></video>';
                        } else {
                            collectionCoverContainer.innerHTML = '<img class="w-full h-full object-cover" src="' + coverUrl.replace(/"/g, '&quot;') + '" alt="' + (col.name || 'Collection') + ' cover"/>';
                        }
                    } else {
                        collectionCoverContainer.innerHTML = '<div class="w-full h-full bg-gray-200 flex items-center justify-center"><span class="text-gray-400 text-sm">No cover image</span></div>';
                    }
                }
                function getInitials(name) {
                    if (!name) return '?';
                    const parts = name.trim().split(/\s+/);
                    if (parts.length >= 2) return (parts[0].charAt(0) + parts[parts.length - 1].charAt(0)).toUpperCase();
                    return name.charAt(0).toUpperCase();
                }
                if (creator.avatar) { creatorAvatar.src = creator.avatar; creatorAvatar.classList.remove('hidden'); creatorInitials.classList.add('hidden'); }
                else { creatorAvatar.classList.add('hidden'); creatorInitials.textContent = getInitials(creator.name); creatorInitials.classList.remove('hidden'); }
                if (creatorName) creatorName.textContent = creator.name || '—';
                if (creatorTagline) creatorTagline.textContent = creator.tagline || '—';
                if (creatorFollowBtn) creatorFollowBtn.textContent = creator.isFollowing ? 'Following' : 'Follow';
                if (creatorSocialLinks) creatorSocialLinks.innerHTML = Object.keys(SOCIAL).filter(k => creator.social && creator.social[k]).map(k => {
                    const s = SOCIAL[k], h = creator.social[k];
                    const href = (typeof h === 'string' && h.startsWith('http')) ? h : (s.url + (h.startsWith('@') ? h.slice(1) : h));
                    return '<a href="' + href + '" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full bg-gray-50 hover:bg-gray-100 transition-colors"><svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 24 24"><path d="' + s.path + '"/></svg></a>';
                }).join('');
                if (collectionName) collectionName.textContent = col.name || '—';
                if (collectionDesc) collectionDesc.textContent = col.description || '—';
                if (collectionMeta) collectionMeta.innerHTML = '<span>' + (col.itemCount || products.length || 0) + ' items</span><span>•</span><span>' + (col.priceRange || '') + '</span><span>•</span><span>' + (col.saves || '0 saves') + '</span>';
                if (collectionPageTitle) collectionPageTitle.textContent = col.name || 'Collection';
                document.title = (col.name || 'Collection') + ' - GoShopMe';
                const productCardHtml = (p) => {
                    const liked = p.isWishlisted ? ' liked' : '';
                    const heartSvg = p.isWishlisted ? '<svg class="w-[18px] h-[18px] heart-filled" fill="#939BFB" stroke="#939BFB" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>' : '<svg class="w-[18px] h-[18px] text-white product-overlay-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>';
                    return '<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden product-card" data-product-id="' + (p.id || '') + '"><div class="flex"><div class="relative w-32 h-32 flex-shrink-0"><img class="w-full h-full object-cover" src="' + (p.image || '') + '" alt="' + (p.name || '') + '"/><div class="absolute top-2 right-2 flex flex-col space-y-2"><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity heart-btn' + liked + '">' + heartSvg + '</button><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity share-btn share-icon-tilted"><svg class="w-[18px] h-[18px] text-white product-overlay-icon share-icon-tilted" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button><button class="p-1 flex items-center justify-center hover:opacity-80 transition-opacity chat-trigger" data-product="' + (p.name || '').replace(/"/g, '&quot;') + '" data-brand="' + (p.brand || '').replace(/"/g, '&quot;') + '" data-price="' + (p.price || '').replace(/"/g, '&quot;') + '"><svg class="w-[18px] h-[18px] text-white product-overlay-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.068.157 2.148.279 3.238.364.466.037.893.281 1.153.671L12 21l2.652-3.978c.26-.39.687-.634 1.153-.671 1.09-.085 2.17-.207 3.238-.364 1.584-.233 2.707-1.627 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/></svg></button></div></div><div class="flex-1 p-4"><p class="text-xs text-gray-500 mb-1">' + (p.brand || '') + '</p><h4 class="text-base font-fahkwang font-bold text-black mb-2">' + (p.name || '') + '</h4><p class="text-sm text-gray-600 mb-3">' + (p.description || '') + '</p><div class="flex items-center justify-between"><span class="text-lg font-bold text-black">' + (p.price || '') + '</span></div></div></div></div>';
                };
                if (productsContainer) productsContainer.innerHTML = products.length ? products.map(productCardHtml).join('') : '<div class="text-center py-12 text-gray-500 text-sm">No products in this collection yet</div>';
                window.__currentCollectionName = col.name || '';
            };
            try {
                const stored = sessionStorage.getItem('__singleCollectionData');
                if (stored) {
                    const data = JSON.parse(stored);
                    sessionStorage.removeItem('__singleCollectionData');
                    window.loadSingleCollection(data);
                } else {
                    const params = new URLSearchParams(window.location.search);
                    const nameFromUrl = params.get('collection');
                    if (nameFromUrl) {
                        const titleEl = document.getElementById('collection-page-title');
                        const nameEl = document.getElementById('collection-name');
                        if (titleEl) titleEl.textContent = decodeURIComponent(nameFromUrl);
                        if (nameEl) nameEl.textContent = decodeURIComponent(nameFromUrl);
                        document.title = decodeURIComponent(nameFromUrl) + ' - GoShopMe';
                    }
                }
            } catch (e) {}
            
            const chatDrawer = document.getElementById('shai-chat-drawer');
            const chatOverlay = document.getElementById('chat-overlay');
            const chatInputCollapsed = document.getElementById('chat-input-collapsed');
            const chatInputCollapsedField = document.getElementById('chat-input-collapsed-field');
            const chatInputDrawer = document.getElementById('chat-input-drawer');
            const sendButtonDrawer = document.getElementById('send-button-drawer');
            const micButtonDrawer = document.getElementById('mic-button-drawer');
            const sendButtonCollapsed = document.getElementById('send-button-collapsed');
            const micButtonCollapsed = document.getElementById('mic-button-collapsed');
            const bottomNavigation = document.getElementById('bottom-navigation');
            const backgroundContent = document.getElementById('background-content');
            const mainContent = document.getElementById('main-content');
            
            // Add Friend Elements
            const addFriendButtonDrawer = document.getElementById('add-friend-button-drawer');
            const addFriendButtonCollapsed = document.getElementById('add-friend-button-collapsed');
            const addFriendContent = document.getElementById('add-friend-content');
            const chatMessages = document.getElementById('chat-messages');
            const backButton = document.getElementById('back-button');
            const drawerTitle = document.getElementById('drawer-title');
            const drawerSubtitle = document.getElementById('drawer-subtitle');
            const contactSearch = document.getElementById('contact-search');
            const contactsContainer = document.getElementById('contacts-container');
            const dragHandle = document.getElementById('drawer-drag-handle') || document.querySelector('.drag-handle');

            // Add Friend contacts: dynamic. Same pattern as Home.
            // GoShopMe user + avatar -> photo; GoShopMe user without avatar -> initials; non-GoShopMe -> initials
            window.__addFriendContacts = window.__addFriendContacts || [
                { name: 'Jane Doe', phone: '+1 (555) 123-4567', goshopme: true },
                { name: 'Mike Wilson', phone: '+1 (555) 987-6543', goshopme: false },
                { name: 'Sarah Johnson', phone: '+1 (555) 246-8135', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-3.jpg' },
                { name: 'Tom Anderson', phone: '+1 (555) 369-2580', goshopme: false },
                { name: 'Amy Lee', phone: '+1 (555) 147-2583', goshopme: true, avatar: 'https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-8.jpg' },
                { name: 'David Kim', phone: '+1 (555) 111-2222', goshopme: true }
            ];
            function getInitials(name) {
                const parts = (name || '').trim().split(/\s+/);
                if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
                return (parts[0] ? parts[0].slice(0, 2) : '??').toUpperCase();
            }
            function renderAddFriendContacts(container) {
                if (!container) return;
                const list = Array.isArray(window.__addFriendContacts) ? window.__addFriendContacts : [];
                container.innerHTML = list.map(c => {
                    const initials = getInitials(c.name);
                    const hasAvatar = c.goshopme && c.avatar;
                    const avatarHtml = hasAvatar
                        ? `<div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0"><img src="${c.avatar}" alt="${(c.name || '').replace(/"/g, '&quot;')}" class="w-full h-full object-cover"></div>`
                        : `<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-600 font-medium text-xs">${initials}</span></div>`;
                    const btnHtml = c.goshopme
                        ? '<button class="contact-action bg-[#939BFB] text-white px-2 py-1 rounded-full text-xs font-medium">Add</button>'
                        : '<button class="contact-action bg-white text-[#939BFB] px-2 py-1 rounded-full text-xs font-medium border border-[#939BFB]">Invite</button>';
                    return `<div class="contact-item flex items-center gap-2 p-2 bg-gray-50 rounded-xl" data-name="${(c.name || '').replace(/"/g, '&quot;')}" data-phone="${(c.phone || '').replace(/"/g, '&quot;')}" data-goshopme="${c.goshopme ? 'true' : 'false'}">${avatarHtml}<div class="flex-1"><p class="font-medium text-sm text-black">${(c.name || '').replace(/</g, '&lt;')}</p><p class="text-xs text-gray-500">${(c.phone || '').replace(/</g, '&lt;')}</p></div>${btnHtml}</div>`;
                }).join('');
            }
            window.loadAddFriendContacts = function(data) {
                window.__addFriendContacts = Array.isArray(data) ? data : [];
                renderAddFriendContacts(contactsContainer);
            };
            renderAddFriendContacts(contactsContainer);
            function filterContacts(term) {
                const items = contactsContainer ? contactsContainer.querySelectorAll('.contact-item') : [];
                const t = (term || '').toLowerCase();
                items.forEach(el => {
                    const match = ((el.getAttribute('data-name') || '') + (el.getAttribute('data-phone') || '')).toLowerCase().includes(t);
                    el.style.display = match ? 'flex' : 'none';
                });
            }
            if (contactSearch) contactSearch.addEventListener('input', function() { filterContacts(this.value); });
            
            let isDrawerExpanded = false;
            let isInAddFriendFlow = false;
            let drawerHeight = 80;
            let isDragging = false;
            
            // Initial state - drawer closed by default (design system)
            chatDrawer.classList.add('translate-y-full');
            chatOverlay.classList.add('hidden');

            // Overlay click - collapse drawer (design system: no drawer-toggle button)
            chatOverlay.addEventListener('click', collapseDrawer);

            function scrollChatToBottom() { if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight; }
            function handleCameraAccess() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,video/*';
                input.onchange = (e) => {
                    const file = e.target.files && e.target.files[0];
                    if (file) handleFileSelection(file);
                    input.value = '';
                };
                input.click();
            }
            function handleFileSelection(file) {
                const url = URL.createObjectURL(file);
                const cnt = chatMessages.querySelector('.p-4');
                if (!cnt) return;
                let bubble;
                if (file.type.startsWith('image/')) {
                    bubble = document.createElement('div');
                    bubble.className = 'flex justify-end mb-4';
                    bubble.innerHTML = '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><img src="' + url + '" class="w-full h-auto" alt="Uploaded image"></div>';
                } else if (file.type.startsWith('video/')) {
                    bubble = document.createElement('div');
                    bubble.className = 'flex justify-end mb-4';
                    bubble.innerHTML = '<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden relative"><video src="' + url + '" controls class="w-full h-auto"></video></div>';
                }
                if (bubble) {
                    cnt.appendChild(bubble);
                    scrollChatToBottom();
                    setTimeout(() => {
                        const ai = document.createElement('div');
                        ai.className = 'flex items-start space-x-3 mb-4';
                        ai.innerHTML = '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-500 text-xs font-medium">AI</span></div><div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">' + (file.type.startsWith('video/') ? 'Great! I can analyze your video. Let me find products that match what I see.' : 'Perfect! I can see your image. Let me analyze it and find similar products for you.') + '</p></div></div>';
                        cnt.appendChild(ai);
                        scrollChatToBottom();
                    }, 1500);
                }
            }
            
            // Drag functionality for drawer handle
            let startY, startHeight;
            if (dragHandle) {
                dragHandle.addEventListener('mousedown', startDrag);
                dragHandle.addEventListener('touchstart', startDrag);
            }
            
            function startDrag(e) {
                isDragging = true;
                startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
                startHeight = parseInt(chatDrawer.style.height) || 35;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('touchend', stopDrag);
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const currentY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
                const deltaY = startY - currentY;
                const newHeight = Math.min(90, Math.max(35, startHeight + (deltaY / window.innerHeight) * 100));
                
                    drawerHeight = newHeight;
                chatDrawer.style.height = newHeight + 'vh';
                
                if (newHeight > 70) {
                    chatDrawer.style.height = '90vh';
                    drawerHeight = 90;
                }
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            }

            // Click on main screen to collapse drawer
            backgroundContent.addEventListener('click', (e) => {
                if (isDrawerExpanded && 
                    !e.target.closest('#shai-chat-drawer') && 
                    !e.target.closest('#chat-input-collapsed') &&
                    !e.target.closest('.chat-trigger') && 
                    !e.target.closest('button') &&
                    !e.target.closest('a')) {
                    collapseDrawer();
                }
            });

            // Expand drawer when clicking on collapsed input bar or its buttons
            chatInputCollapsedField.addEventListener('click', (e) => {
                e.stopPropagation();
                expandDrawer();
                setTimeout(() => {
                    chatInputDrawer.focus();
                }, 300);
            });

            document.getElementById('cam-btn')?.addEventListener('click', (e) => {
                e.stopPropagation();
                if (chatDrawer.classList.contains('translate-y-full')) { expandDrawer(); setTimeout(handleCameraAccess, 300); }
                else handleCameraAccess();
            });

            addFriendButtonCollapsed.addEventListener('click', (e) => {
                e.stopPropagation();
                expandDrawer();
                showAddFriendFlow();
            });

            document.getElementById('mic-button-collapsed').addEventListener('click', (e) => {
                e.stopPropagation();
                expandDrawer();
            });

            // Expand drawer when clicking on drawer input bar or its buttons
            chatInputDrawer.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isDrawerExpanded) {
                    expandDrawer();
                }
            });

            document.getElementById('cam-btn-drawer')?.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isDrawerExpanded) { expandDrawer(); setTimeout(handleCameraAccess, 300); }
                else handleCameraAccess();
            });

            addFriendButtonDrawer.addEventListener('click', (e) => {
                e.stopPropagation();
                showAddFriendFlow();
            });

            micButtonDrawer.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!isDrawerExpanded) {
                    expandDrawer();
                }
            });

            // Back button functionality
            backButton.addEventListener('click', (e) => {
                e.stopPropagation();
                hideAddFriendFlow();
            });

            // Auto-expand drawer when collapsed input is focused
            chatInputCollapsedField.addEventListener('focus', () => {
                expandDrawer();
                setTimeout(() => {
                    chatInputDrawer.focus();
                }, 300);
            });

            // Product card click - event delegation (cards are dynamic)
            document.addEventListener('click', (e) => {
                const card = e.target.closest('.product-card');
                if (!card || e.target.closest('.heart-btn') || e.target.closest('.share-btn') || e.target.closest('.chat-trigger')) return;
                const h4 = card.querySelector('h4');
                const brandP = card.querySelector('p.text-xs');
                if (h4 && brandP) window.location.href = 'Product_details_page.html?id=' + (card.dataset.productId || '') + '&name=' + encodeURIComponent(h4.textContent) + '&brand=' + encodeURIComponent(brandP.textContent);
            });

            // Product chat triggers - event delegation
            document.addEventListener('click', (e) => {
                const trigger = e.target.closest('.chat-trigger');
                if (!trigger) return;
                e.stopPropagation();
                const productName = trigger.dataset.product || '';
                const brandName = trigger.dataset.brand || '';
                const price = trigger.dataset.price || '';
                expandDrawer();
                hideAddFriendFlow();
                const cnt = chatMessages.querySelector('.p-4');
                if (cnt) {
                    const contextMessage = document.createElement('div');
                    contextMessage.className = 'flex items-start space-x-3 mb-4';
                    const collectionName = window.__currentCollectionName || '';
                    const collectionPart = collectionName ? ' from the "' + collectionName + '" collection' : '';
                    contextMessage.innerHTML = '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-500 text-xs font-medium">AI</span></div><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 max-w-xs"><p class="text-sm text-black">Looking at: ' + productName + ' by ' + brandName + ' â€“ ' + price + collectionPart + '. Want it in another size or color? I can also show you similar styles!</p></div>';
                    cnt.appendChild(contextMessage);
                    scrollChatToBottom();
                }
            });

            // Contact add/invite - event delegation (match Home)
            document.addEventListener('click', (e) => {
                if (!e.target.classList.contains('contact-action')) return;
                const contactItem = e.target.closest('.contact-item');
                if (!contactItem) return;
                const contactName = contactItem.getAttribute('data-name') || (contactItem.querySelector('p') && contactItem.querySelector('p').textContent) || '';
                const isGoshopmeUser = contactItem.getAttribute('data-goshopme') === 'true';
                const contactPhone = contactItem.getAttribute('data-phone') || '';
                if (e.target.textContent === 'Add' && isGoshopmeUser) {
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        const notification = document.createElement('div');
                        notification.className = 'flex justify-center mb-4';
                        notification.innerHTML = '<div class="bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm">' + (contactName.split(' ')[0] || '') + ' has been added to chat</div>';
                        cnt.appendChild(notification);
                        scrollChatToBottom();
                    }
                    hideAddFriendFlow();
                } else if (e.target.textContent === 'Invite') {
                    const shareData = { title: 'Join me on GoShopMe', text: "Hey! I'm using GoShopMe. It's faster, smarter and effortless — join me", url: 'https://app.goshopme.ai' };
                    if (navigator.share) {
                        navigator.share(shareData).catch(() => {});
                    } else if (contactPhone) {
                        const message = encodeURIComponent(shareData.text + ' ' + shareData.url);
                        window.location.href = 'sms:' + contactPhone.replace(/\D/g, '') + '?body=' + message;
                    }
                    hideAddFriendFlow();
                    const cnt = chatMessages.querySelector('.p-4');
                    if (cnt) {
                        const notification = document.createElement('div');
                        notification.className = 'flex justify-center mb-4';
                        notification.innerHTML = '<div class="bg-green-50 text-green-700 px-4 py-2 rounded-full text-sm">' + (contactName.split(' ')[0] || '') + ' has been invited to GoShopMe</div>';
                        cnt.appendChild(notification);
                        scrollChatToBottom();
                    }
                }
            });

            function showAddFriendFlow() {
                isInAddFriendFlow = true;
                chatMessages.classList.add('hidden');
                addFriendContent.classList.remove('hidden');
                backButton.classList.remove('hidden');
                drawerTitle.textContent = 'Add Friends';
                drawerSubtitle.textContent = 'Choose contacts to add';
                
                // Expand drawer if not already expanded
                if (!isDrawerExpanded) {
                    expandDrawer();
                }
            }

            function hideAddFriendFlow() {
                isInAddFriendFlow = false;
                chatMessages.classList.remove('hidden');
                addFriendContent.classList.add('hidden');
                backButton.classList.add('hidden');
                drawerTitle.textContent = 'ShAI';
                drawerSubtitle.textContent = 'Your AI Personal Shopper';
                
                // Clear search
                if (contactSearch) contactSearch.value = '';
                filterContacts('');
            }

            function expandDrawer() {
                chatDrawer.classList.remove('translate-y-full');
                chatDrawer.style.height = '80vh';
                drawerHeight = 80;
                chatOverlay.classList.remove('hidden');
                chatInputCollapsed.classList.add('hidden');
                isDrawerExpanded = true;
            }

            function collapseDrawer() {
                chatDrawer.classList.add('translate-y-full');
                chatOverlay.classList.add('hidden');
                chatInputCollapsed.classList.remove('hidden');
                isDrawerExpanded = false;
                
                // Reset to chat view when collapsing
                if (isInAddFriendFlow) {
                    hideAddFriendFlow();
                }
            }

            // Chat Input Functionality - Drawer (design system: send shows when text)
            chatInputDrawer.addEventListener('input', (e) => {
                const hasText = e.target.value.trim().length > 0;
                sendButtonDrawer.classList.toggle('hidden', !hasText);
                micButtonDrawer.classList.toggle('hidden', hasText);
            });

            // Chat Input Functionality - Collapsed
            chatInputCollapsedField.addEventListener('input', (e) => {
                const hasText = e.target.value.trim().length > 0;
                sendButtonCollapsed.classList.toggle('hidden', !hasText);
                micButtonCollapsed.classList.toggle('hidden', hasText);
            });

            // Send Message Functions
            function sendMessage(inputField, sendButton, micButton) {
                const message = inputField.value.trim();
                if (message) {
                    const cnt = chatMessages.querySelector('.p-4');
                    if (!cnt) return;
                    const userMessage = document.createElement('div');
                    userMessage.className = 'flex justify-end mb-4';
                    userMessage.innerHTML = '<div class="bg-primary rounded-2xl rounded-tr-sm px-4 py-3 max-w-xs"><p class="text-sm text-white"></p></div>';
                    userMessage.querySelector('p').textContent = message;
                    cnt.appendChild(userMessage);
                    scrollChatToBottom();
                    
                    inputField.value = '';
                    sendButton.classList.add('hidden');
                    micButton.classList.remove('hidden');

                    // Simulate AI response
                    setTimeout(() => {
                        const cnt = chatMessages.querySelector('.p-4');
                        if (cnt) {
                            const aiResponse = document.createElement('div');
                            aiResponse.className = 'flex items-start space-x-3 mb-4';
                            aiResponse.innerHTML = '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-500 text-xs font-medium">AI</span></div><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 max-w-xs"><p class="text-sm text-black">Great choice! Let me help you find the perfect fit and styling options for that piece.</p></div>';
                            cnt.appendChild(aiResponse);
                            scrollChatToBottom();
                        }
                    }, 1000);
                }
            }

            sendButtonDrawer.addEventListener('click', () => {
                sendMessage(chatInputDrawer, sendButtonDrawer, micButtonDrawer);
            });

            sendButtonCollapsed.addEventListener('click', () => {
                sendMessage(chatInputCollapsedField, sendButtonCollapsed, micButtonCollapsed);
                expandDrawer();
            });

            // Smart prompt chip functionality
            document.querySelectorAll('.ml-11 button').forEach(button => {
                button.addEventListener('click', () => {
                    const cnt = chatMessages.querySelector('.p-4');
                    if (!cnt) return;
                    const userMessage = document.createElement('div');
                    userMessage.className = 'flex justify-end mb-4';
                    userMessage.innerHTML = '<div class="bg-primary rounded-2xl rounded-tr-sm px-4 py-3 max-w-xs"><p class="text-sm text-white"></p></div>';
                    userMessage.querySelector('p').textContent = button.textContent;
                    cnt.appendChild(userMessage);
                    scrollChatToBottom();
                    setTimeout(() => {
                        const aiResponse = document.createElement('div');
                        aiResponse.className = 'flex items-start space-x-3 mb-4';
                        aiResponse.innerHTML = '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-500 text-xs font-medium">AI</span></div><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 max-w-xs"><p class="text-sm text-black">Perfect! Let me help you with that right away.</p></div>';
                        cnt.appendChild(aiResponse);
                        scrollChatToBottom();
                    }, 800);
                });
            });

            // Heart and share buttons - event delegation (product cards are dynamic)
            document.addEventListener('click', (e) => {
                const button = e.target.closest('.heart-btn');
                if (!button) return;
                e.stopPropagation();
                const icon = button.querySelector('svg');
                const isLiked = button.classList.contains('liked');
                if (!icon) return;
                if (!isLiked) {
                    button.classList.add('liked');
                    icon.classList.add('heart-filled');
                    icon.setAttribute('fill', '#939BFB');
                    icon.setAttribute('stroke', '#939BFB');
                    icon.classList.remove('text-white');
                    icon.classList.add('text-[#939BFB]');
                    button.style.transform = 'scale(1.2)';
                    setTimeout(() => { button.style.transform = 'scale(1)'; }, 150);
                } else {
                    button.classList.remove('liked');
                    icon.classList.remove('heart-filled', 'text-[#939BFB]');
                    icon.setAttribute('fill', 'none');
                    icon.setAttribute('stroke', 'currentColor');
                    icon.classList.add('text-white');
                }
            });

            document.addEventListener('click', (e) => {
                const button = e.target.closest('.share-btn');
                if (!button) return;
                e.stopPropagation();
                const icon = button.querySelector('svg');
                if (icon) { icon.style.transform = 'translateX(2px)'; setTimeout(() => { icon.style.transform = 'translateX(0)'; }, 200); }
                if (navigator.share) navigator.share({ title: 'Check out this item', text: 'Found this amazing piece on GoShopMe!', url: window.location.href });
            });

        });
    </script>

</body>
</html>


