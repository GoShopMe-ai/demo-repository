<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <link rel="stylesheet" href="css/chat-drawer-drag.css">
    <title>Brand - GoShopMe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'shine-primary': '#939BFB', 'shine-accent': '#F96226' },
                    fontFamily: { 'poppins': ['Poppins', 'sans-serif'], 'dm-sans': ['DM Sans', 'sans-serif'] }
                }
            }
        };
    </script>
    <style>
        
/* ---- MOBILE FULL-WIDTH OVERRIDE (match Home) ---- */
@media screen and (max-width: 768px) {
  #app-shell, #main-content, #auth-screen, #welcome_screen, #quiz-screen, #onboarding-screen,
  #bottom-nav, #bottom-navigation, #header, #app-header,
  #chat-drawer, #chat-input-bar, #shai-chat-drawer, #return-chat-drawer, #return-chat-input-bar, #chat-input-collapsed,
  #shai-chat-drawer-wrapper, #chat-drawer-wrapper,
  body > div, body > main {
    max-width: 100vw !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-shadow: none !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
  }
  [class*="left-1/2"][class*="-translate-x-1/2"]:not([class*="rounded-full"]) {
    left: 0 !important;
    right: 0 !important;
    max-width: 100vw !important;
    width: 100% !important;
    transform: none !important;
  }
  #chat-drawer.translate-y-full, #shai-chat-drawer.translate-y-full, #return-chat-drawer.translate-y-full {
    transform: translateY(100%) !important;
  }
  #bottom-nav > div, #bottom-navigation > div, nav#bottom-nav > div, nav#bottom-navigation > div {
    padding-top: 2px !important;
    padding-bottom: 24px !important;
  }
}

::-webkit-scrollbar { display: none; }
        .dm-sans { font-family: 'DM Sans', sans-serif; }
        .poppins { font-family: 'Poppins', sans-serif; }
        .share-icon-tilted { transform: rotate(-35deg); }
        .heart-filled { fill: #939BFB !important; stroke: #939BFB !important; }
        .header-icon-btn { transition: transform 0.2s ease, color 0.2s ease; }
        .header-icon-btn:hover { transform: translateY(-2px); }
        .bottom-nav-btn { display: flex; flex-direction: column; align-items: center; color: #6B7280; transition: color 0.2s ease-in-out; }
        .bottom-nav-btn:hover, .bottom-nav-btn.active { color: #939BFB; }
        .bottom-nav-btn:hover svg, .bottom-nav-btn:hover span, .bottom-nav-btn.active svg, .bottom-nav-btn.active span { color: #939BFB; }
        .bottom-nav-btn svg { width: 20px; height: 20px; stroke-width: 1.5; margin-bottom: 4px; }
        /* Chat drawer and input bar: docked above bottom nav, nav stays on top */
        :root { --shai-nav-h: 72px; }
        #chat-drawer, #chat-input-bar {
            bottom: 72px !important;  /* dock above nav bar */
        }
        #chat-drawer {
            z-index: 40 !important;   /* below nav (z-50) so nav stays clickable */
        }
        #chat-input-bar {
            z-index: 45 !important;   /* above drawer, below nav - ensure visible on mobile */
        }
        #chat-overlay {
            z-index: 35 !important;
        }
        /* Input bar & drawer: compact button layout (match Home) */
        #chat-input-bar > div,
        #chat-drawer .border-t.border-gray-100 > div {
            min-height: 44px !important;
            align-items: center !important;
            padding: 8px 12px !important;
        }
        #chat-input-bar button,
        #chat-drawer .border-t.border-gray-100 button {
            flex-shrink: 0 !important;
            width: 36px !important;
            height: 36px !important;
            padding: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        #chat-input-bar #shai-input-bar,
        #chat-drawer #shai-input-drawer,
        #chat-input-bar textarea,
        #chat-drawer .border-t.border-gray-100 textarea {
            flex: 1 1 0% !important;
            min-width: 0 !important;
        }
        /* When typing: hide add-friend & mic, show send - .hidden must override display:flex */
        #chat-input-bar button.hidden,
        #chat-drawer .border-t.border-gray-100 button.hidden {
            display: none !important;
        }

        @media screen and (max-width: 768px) {
            #chat-drawer, #chat-input-bar {
                left: 0 !important;
                right: 0 !important;
                max-width: 100vw !important;
                width: 100% !important;
            }
            #chat-drawer {
                max-height: calc(100dvh - 144px) !important;
                overscroll-behavior: contain;
            }
            #chat-drawer.translate-y-full {
                transform: translateY(100%) !important;
            }
        }
    </style>
    <script src="js/header-icons-badges.js"></script>
</head>
<body class="bg-[#F6F6F6] dm-sans text-black">
<div id="app-shell" class="max-w-[390px] mx-auto min-h-screen bg-white">
    <header id="app-header" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white z-50 border-b border-gray-100">
        <div class="relative flex items-center justify-between p-4">
            <a href="Trending_Now.html" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:text-gray-800 flex-shrink-0" aria-label="Back">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
            </a>
            <h1 id="brand-title" class="absolute inset-0 flex items-center justify-center text-lg font-semibold text-gray-900 poppins pointer-events-none">Brand</h1>
            <div id="header-icons-slot" class="flex items-center gap-1 flex-shrink-0 min-w-[80px] justify-end">
                <a href="Notifications_Screen.html?from=Brand_Products" id="notif-btn" class="header-icon-btn w-10 h-10 flex items-center justify-center relative overflow-visible text-gray-600 hover:text-gray-800" aria-label="Notifications">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/></svg>
                    <div id="notif-indicator" class="absolute -top-0.5 -right-0.5 min-w-[18px] min-h-[18px] px-1 bg-[#F96226] rounded-full hidden items-center justify-center flex"><span id="notif-count" class="text-[10px] text-white font-medium leading-none whitespace-nowrap"></span></div>
                </a>
                <a href="Shopping_bag.html?from=Brand_Products" id="cart-btn" class="header-icon-btn w-10 h-10 flex items-center justify-center relative overflow-visible text-gray-600 hover:text-gray-800" aria-label="Shopping bag">
                    <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993z"/></svg>
                    <div id="cart-indicator" class="absolute -top-0.5 -right-0.5 min-w-[18px] min-h-[18px] px-1 bg-[#939BFB] rounded-full hidden items-center justify-center flex"><span id="cart-count" class="text-[10px] text-white font-medium leading-none whitespace-nowrap"></span></div>
                </a>
            </div>
        </div>
    </header>

    <main class="pt-20 px-4 pb-40">
        <div id="products-grid" class="grid grid-cols-2 gap-4">
            <div class="col-span-2 py-12 text-center text-gray-500 text-sm">Loading...</div>
        </div>
    </main>
</div>

<script src="js/product-api.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async function() {
    const params = new URLSearchParams(window.location.search);
    const brand = params.get('brand') || '';
    const titleEl = document.getElementById('brand-title');
    const gridEl = document.getElementById('products-grid');
    if (titleEl) titleEl.textContent = brand || 'Brand';
    document.title = (brand || 'Brand') + ' - GoShopMe';

    let products = [];
    if (typeof window.GoShopMeProductAPI !== 'undefined' && brand) {
        products = await window.GoShopMeProductAPI.fetchProducts({ brand: brand });
    }
    if (!products.length && brand) {
        try {
            const r = await fetch('data/trending.json');
            if (r.ok) {
                const j = await r.json();
                const fb = j.featuredBrand;
                if (fb && (fb.name||'').toLowerCase() === brand.toLowerCase() && fb.products?.length) {
                    products = fb.products;
                } else {
                    const jfy = j.justForYou?.products || [];
                    products = jfy.filter(function(p) { return (p.brand||'').toLowerCase() === brand.toLowerCase(); });
                    if (!products.length) products = jfy.slice(0, 6);
                }
            }
        } catch (e) {}
    }

    function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    const btnHtml = '<button type="button" class="p-1 wishlist-btn" onclick="event.preventDefault();event.stopPropagation();"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg></button><button type="button" class="p-1 share-product-btn share-icon-tilted" onclick="event.preventDefault();event.stopPropagation();"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button>';
    const cardHtml = function(p) {
        return '<a href="Product_details_page.html?id=' + esc(p.id) + '&name=' + encodeURIComponent(p.name||'') + '&brand=' + encodeURIComponent(p.brand||'') + '&from=brand" class="block bg-white rounded-xl overflow-hidden product-trigger" data-product="'+esc(p.name)+'" data-product-id="'+esc(p.id)+'" data-product-brand="'+esc(p.brand)+'" data-product-price="'+esc(p.price)+'"><div class="relative"><img class="w-full aspect-square object-cover" src="'+esc(p.image)+'" alt="'+esc(p.name)+'"><div class="absolute top-2 right-2 flex flex-col space-y-1">'+btnHtml+'</div></div><div class="p-2.5"><p class="text-[11px] text-gray-500">'+esc(p.brand)+'</p><h4 class="font-semibold text-sm text-black">'+esc(p.name)+'</h4><p class="text-black font-semibold text-sm">'+esc(p.price)+'</p></div></a>';
    };

    if (products.length) {
        gridEl.innerHTML = products.map(cardHtml).join('');
    } else {
        gridEl.innerHTML = '<div class="col-span-2 py-12 text-center text-gray-500 text-sm">No products found for this brand.</div>';
    }
});
</script>

    <!-- Bottom Navigation -->
    <nav id="bottom-navigation" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 z-50">
        <div class="flex items-center justify-around py-2">
            <a href="Home.html" class="bottom-nav-btn flex flex-col items-center min-w-[60px] p-2 text-gray-400 hover:text-[#939BFB]">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>
                <span class="text-xs">Home</span>
            </a>
            <a href="Picks.html" class="bottom-nav-btn flex flex-col items-center min-w-[60px] p-2 text-gray-400 hover:text-[#939BFB]">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/></svg>
                <span class="text-xs">Picks</span>
            </a>
            <a href="Wishlist.html" class="bottom-nav-btn flex flex-col items-center min-w-[60px] p-2 text-gray-400 hover:text-[#939BFB]">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>
                <span class="text-xs">Wishlist</span>
            </a>
            <a id="brand-nav-profile-link" href="User_Profile_Free_Plan.html" class="bottom-nav-btn flex flex-col items-center min-w-[60px] p-2 text-gray-400 hover:text-[#939BFB]">
                <span id="brand-nav-profile-icon" class="flex items-center justify-center w-6 h-6 mb-1">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                </span>
                <img id="brand-nav-profile-photo" class="w-6 h-6 rounded-full object-cover mb-1 hidden" src="" alt="Profile" data-profile-avatar>
                <span class="text-xs">Profile</span>
            </a>
        </div>
    </nav>

<!-- Chat overlay, drawer, input bar (embedded for mobile - shai-chat.js wires up) -->
<div id="chat-overlay" class="fixed inset-0 bg-black/40 z-40"></div>
<div id="chat-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white rounded-t-3xl shadow-2xl z-40 h-[50vh] transform transition-transform duration-300 flex flex-col border-t border-gray-100" style="max-height:calc(100dvh - 144px)">
    <div id="drag-handle-zone" class="chat-drawer-drag-zone flex justify-center flex-shrink-0" style="touch-action:none;user-select:none;padding-top:14px;padding-bottom:14px;cursor:grab">
        <div class="w-10 h-1 bg-gray-300 rounded-full pointer-events-none"></div>
    </div>
    <div class="flex items-center px-4 pb-2 flex-shrink-0">
        <button id="shai-friend-back" class="hidden w-8 h-8 flex items-center justify-center mr-2 hover:opacity-70 transition-opacity" aria-label="Back to chat">
            <svg class="w-4 h-4 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/></svg>
        </button>
        <div id="shai-avatar-wrap" class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0">
            <img class="w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI" data-shai-avatar>
        </div>
        <div class="flex-1">
            <p id="shai-header-title" class="font-semibold text-black text-sm">ShAI</p>
            <p id="shai-header-sub" class="text-xs text-gray-500">Your shopping assistant</p>
        </div>
    </div>
    <div id="shai-messages" class="flex-1 overflow-y-auto min-h-0" style="overscroll-behavior:contain">
        <div class="p-4 pb-0">
            <div class="flex items-start space-x-3 mb-4">
                <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                    <img class="w-full h-full object-cover" src="https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png" alt="ShAI" data-shai-avatar>
                </div>
                <div class="flex-1">
                    <div class="bg-gray-50 rounded-2xl rounded-tl-md p-3 mb-3">
                        <p class="text-sm text-black">Hi there! I am ShAI, your personal shopping assistant. How can I help you today?</p>
                    </div>
                    <div class="flex flex-wrap gap-2 pb-2">
                        <button class="shai-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">I need a formal outfit</button>
                        <button class="shai-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">What's trending?</button>
                        <button class="shai-prompt bg-white border border-[#B7C7FF] text-[#939BFB] px-3 py-1.5 rounded-full text-xs font-medium hover:bg-[#939BFB] hover:text-white transition-colors">Complete my look</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="shai-friend-panel" class="hidden flex-col flex-1 min-h-0 overflow-hidden">
        <div class="px-4 py-2 border-b border-gray-100 flex-shrink-0">
            <div class="relative">
                <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" id="shai-friend-search" placeholder="Search contacts..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pl-10 text-sm">
            </div>
        </div>
        <div id="shai-friend-list" class="flex-1 overflow-y-auto p-4 space-y-2" style="overscroll-behavior:contain"></div>
    </div>
    <div class="bg-white border-t border-gray-100 p-4 flex-shrink-0">
        <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
            <button id="shai-cam-drawer" class="hover:opacity-70 transition-opacity" aria-label="Image/video"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg></button>
            <textarea id="shai-input-drawer" rows="1" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 resize-none min-h-[24px] max-h-[144px] overflow-y-auto" style="font-family:inherit;font-size:14px"></textarea>
            <button id="shai-add-drawer" class="hover:opacity-70 transition-opacity" aria-label="Add friend"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg></button>
            <button type="button" id="shai-mic-drawer" class="hover:opacity-70 transition-opacity" aria-label="Voice"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg></button>
            <button id="shai-send-drawer" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity" aria-label="Send"><svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button>
        </div>
    </div>
</div>
<div id="chat-input-bar" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[390px] bg-white border-t border-gray-100 p-4 z-30 hidden">
    <div class="flex items-center gap-2 bg-white rounded-2xl border border-gray-200 px-4 py-3 shadow-sm">
        <button id="shai-cam-bar" class="hover:opacity-70 transition-opacity" aria-label="Image/video"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg></button>
        <textarea id="shai-input-bar" rows="1" placeholder="Message ShAI..." class="flex-1 bg-transparent outline-none text-black placeholder-gray-500 resize-none min-h-[24px] max-h-[144px] overflow-y-auto" style="font-family:inherit;font-size:14px"></textarea>
        <button id="shai-add-bar" class="hover:opacity-70 transition-opacity" aria-label="Add friend"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z"/></svg></button>
        <button type="button" id="shai-mic-bar" class="hover:opacity-70 transition-opacity" aria-label="Voice"><svg class="w-[18px] h-[18px] text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg></button>
        <button id="shai-send-bar" class="text-[#939BFB] hidden hover:opacity-70 transition-opacity" aria-label="Send"><svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg></button>
    </div>
</div>

<script>
(function(){
    var plan = (localStorage.getItem('__userPlan') || '').toLowerCase();
    var link = document.getElementById('brand-nav-profile-link');
    if (link) link.href = (plan === 'paid' || plan === 'true') ? 'User_Profile_Paid_Plan.html' : 'User_Profile_Free_Plan.html';

    function refreshProfilePhoto() {
        var img = document.getElementById('brand-nav-profile-photo');
        var icon = document.getElementById('brand-nav-profile-icon');
        if (!img || !icon) return;
        try {
            var saved = localStorage.getItem('profilePhoto');
            if (saved) {
                img.src = saved;
                img.classList.remove('hidden');
                icon.classList.add('hidden');
            } else {
                img.classList.add('hidden');
                icon.classList.remove('hidden');
            }
        } catch (e) {}
    }
    refreshProfilePhoto();
    window.addEventListener('pageshow', function(e) { if (e.persisted) refreshProfilePhoto(); });
})();
</script>
<script>
(function(){
  function init(){
    var d=document.getElementById('chat-drawer'),o=document.getElementById('chat-overlay'),b=document.getElementById('chat-input-bar');
    var m=document.getElementById('shai-messages'),mc=m?m.querySelector('.p-4'):null;
    var id=document.getElementById('shai-input-drawer'),ib=document.getElementById('shai-input-bar');
    var sd=document.getElementById('shai-send-drawer'),sb=document.getElementById('shai-send-bar');
    var md=document.getElementById('shai-mic-drawer'),mb=document.getElementById('shai-mic-bar');
    var ad=document.getElementById('shai-add-drawer'),ab=document.getElementById('shai-add-bar');
    var cd=document.getElementById('shai-cam-drawer'),cb=document.getElementById('shai-cam-bar');
    var dz=document.getElementById('drag-handle-zone');
    if(!d||!o||!b)return;
    var SHAI='https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/shai-avatar.png';
    var isOpen=true,isDrag=false,dY=0,dH=0,isRec=false,mr,ac=[],ms,micDeny=false,sX;
    function openD(){d.classList.remove('translate-y-full');o.classList.remove('hidden');b.classList.add('hidden');d.style.height='50vh';isOpen=true;document.body.style.overflow='hidden';}
    function closeD(){d.classList.add('translate-y-full');o.classList.add('hidden');b.classList.remove('hidden');isOpen=false;document.body.style.overflow='';}
    openD();
    o.addEventListener('click',closeD);
    b.addEventListener('click',function(e){if(!e.target.closest('button'))openD();});
    function upBtn(inp,s,mi,a){var h=inp.value.trim().length>0;s.classList.toggle('hidden',!h);mi.classList.toggle('hidden',h);a.classList.toggle('hidden',h);}
    function autoGrow(ta){ta.style.height='auto';ta.style.height=Math.min(ta.scrollHeight,144)+'px';}
    function scrollB(){if(m)m.scrollTop=m.scrollHeight;}
    function shaiR(t){if(!mc)return;var el=document.createElement('div');el.className='flex items-start space-x-3 mb-4';el.innerHTML='<div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0"><img class="w-full h-full object-cover" src="'+SHAI+'" alt="ShAI"></div><div class="flex-1"><div class="bg-gray-50 rounded-2xl rounded-tl-md p-3"><p class="text-sm text-black">'+(t||'').replace(/</g,'&lt;')+'</p></div></div>';mc.appendChild(el);scrollB();}
    function sendTxt(ta,s,mi,a,openA){var t=ta.value.trim();if(!t||!mc)return;if(openA)openD();var el=document.createElement('div');el.className='flex justify-end mb-4';el.innerHTML='<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%]"><p class="text-sm break-words whitespace-pre-wrap"></p></div>';el.querySelector('p').textContent=t;mc.appendChild(el);ta.value='';autoGrow(ta);upBtn(ta,s,mi,a);scrollB();setTimeout(function(){shaiR("Perfect! Let me help you find exactly what you\'re looking for.");},1000);}
    [id,ib].forEach(function(ta,i){var s=i?sb:sd,mi=i?mb:md,a=i?ab:ad;if(!ta||!s||!mi||!a)return;ta.addEventListener('input',function(){autoGrow(ta);upBtn(ta,s,mi,a);});ta.addEventListener('keydown',function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendTxt(ta,s,mi,a,i);}});s.addEventListener('click',function(){sendTxt(ta,s,mi,a,i);});});
    document.querySelectorAll('.shai-prompt').forEach(function(btn){btn.addEventListener('click',function(){openD();if(!mc)return;var el=document.createElement('div');el.className='flex justify-end mb-4';el.innerHTML='<div class="bg-[#939BFB] text-white rounded-2xl rounded-tr-md p-3 max-w-[80%]"><p class="text-sm break-words whitespace-pre-wrap"></p></div>';el.querySelector('p').textContent=btn.textContent.trim();mc.appendChild(el);scrollB();setTimeout(function(){shaiR("Great choice! I\'ll find the best options for you right away.");},800);});});
    function pickF(openF){if(openF)openD();var inp=document.createElement('input');inp.type='file';inp.accept='image/*,video/*';inp.onchange=function(e){var f=e.target.files&&e.target.files[0];if(!f||!mc)return;var u=URL.createObjectURL(f),el=document.createElement('div');el.className='flex justify-end mb-4';el.innerHTML=f.type.startsWith('image/')?'<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><img src="'+u+'" class="w-full h-auto"></div>':'<div class="rounded-2xl border border-[#939BFB] max-w-[60%] overflow-hidden shadow-sm"><video src="'+u+'" controls class="w-full h-auto"></video></div>';mc.appendChild(el);scrollB();setTimeout(function(){shaiR(f.type.startsWith('image/')?"I can see your image! Let me find similar products for you.":"Got your video! Let me analyze it and find matching products.");},1500);};inp.click();}
    if(cd)cd.addEventListener('click',function(){pickF(false);});if(cb)cb.addEventListener('click',function(){pickF(true);});
    function showT(msg){var el=document.createElement('div');el.style.cssText='position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 20px;border-radius:20px;font-size:13px;z-index:9999;max-width:85vw;text-align:center';el.textContent=msg;document.body.appendChild(el);setTimeout(function(){el.remove();},3500);}
    function setupMic(btn){function wrapStart(e){e.preventDefault();e.stopPropagation();startR.call(btn,e);}function wrapStop(e){e.preventDefault();stopR.call(btn,e);}function wrapCancel(e){cancelR.call(btn,e);}btn.addEventListener('mousedown',wrapStart);btn.addEventListener('touchstart',wrapStart,{passive:false});btn.addEventListener('pointerdown',wrapStart,{passive:false});btn.addEventListener('mouseup',wrapStop);btn.addEventListener('touchend',wrapStop,{passive:false});btn.addEventListener('pointerup',wrapStop,{passive:false});btn.addEventListener('mouseleave',wrapCancel);btn.addEventListener('touchcancel',wrapCancel);btn.addEventListener('touchmove',function(e){if(!isRec||!e.touches)return;if(sX-e.touches[0].clientX>30)wrapCancel.call(btn,e);});}
    if(md)setupMic(md);if(mb)setupMic(mb);
    function startR(e){e.preventDefault();if(!isOpen){openD();return;}if(micDeny){showT('Microphone access denied. Use https or localhost.');return;}sX=(e.touches&&e.touches[0]?e.touches[0]:e).clientX||0;var t=document.getElementById('shai-temp-rec');if(t)t.remove();if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){showT('Microphone not supported. Use https or localhost.');return;}var btn=this;function doRec(stream){ms=stream;mr=new MediaRecorder(ms);isRec=true;ac=[];mr.ondataavailable=function(ev){if(ev.data&&ev.data.size>0)ac.push(ev.data);};mr.start();if(btn&&btn.classList)btn.classList.add('scale-110','ring-2','ring-[#939BFB]','ring-offset-2');if(mc){var tb=document.createElement('div');tb.id='shai-temp-rec';tb.className='flex justify-end mb-2';tb.innerHTML='<div class="flex items-center bg-[#939BFB] text-white rounded-2xl px-3 py-2 max-w-[70%]"><svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg><span class="text-xs">Recording... swipe left to cancel</span></div>';mc.appendChild(tb);scrollB();}}if(ms&&ms.active){doRec(ms);}else{navigator.mediaDevices.getUserMedia({audio:true}).then(doRec).catch(function(err){var t2=document.getElementById('shai-temp-rec');if(t2)t2.remove();micDeny=err.name==='NotAllowedError';showT(micDeny?'Microphone access denied.':'Use https or localhost for microphone.');});}}
    function stopR(e){e.preventDefault();if(!isRec)return;isRec=false;var btn=this;if(btn&&btn.classList)btn.classList.remove('scale-110','ring-2','ring-[#939BFB]','ring-offset-2');var t=document.getElementById('shai-temp-rec');if(t)t.remove();if(mr){mr.stop();mr.onstop=function(){var mime=mr.mimeType||'audio/webm';var blob=new Blob(ac,{type:mime});var u=URL.createObjectURL(blob),el=document.createElement('div');el.className='flex justify-end mb-2';el.innerHTML='<div class="voice-message-bubble bg-[#939BFB] text-white rounded-full px-3 py-2 flex items-center gap-2 h-11 shadow-sm min-w-[140px] max-w-[260px]"><button class="play-btn flex-shrink-0 w-6 h-6 border border-white rounded-full flex items-center justify-center hover:bg-white/20" onclick="window._shaiPlay(this,\''+u+'\')"><svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button><div class="waveform flex items-center gap-0.5 h-4 max-w-[100px]">'+[8,12,6,16,10,14,8,12,6,10].map(function(h){return '<div class="wave-bar w-0.5 bg-white/90 rounded-full" style="height:'+h+'px"></div>';}).join('')+'</div><span class="duration-text text-white/90 text-xs font-medium flex-shrink-0">0:00</span><audio src="'+u+'" preload="auto" class="hidden"></audio></div>';var audio=el.querySelector('audio');audio.addEventListener('loadedmetadata',function(){var s=Math.ceil(audio.duration);el.querySelector('.duration-text').textContent=Math.floor(s/60)+':'+String(s%60).padStart(2,'0');});mc.appendChild(el);scrollB();setTimeout(function(){shaiR("Got your voice message!");},800);};}}
    function cancelR(e){if(!isRec)return;isRec=false;this.classList.remove('scale-110','ring-2','ring-[#939BFB]','ring-offset-2');var t=document.getElementById('shai-temp-rec');if(t)t.remove();if(mr&&mr.state!=='inactive')mr.stop();}
    window._shaiPlay=function(btn,url){var wrap=btn.closest('.voice-message-bubble'),audio=wrap.querySelector('audio'),bars=wrap.querySelectorAll('.wave-bar'),dur=wrap.querySelector('.duration-text');if(audio.paused){audio.play();btn.querySelector('svg').innerHTML='<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>';bars.forEach(function(b,i){b.style.animation='shaiWave 1.1s ease-in-out infinite';b.style.animationDelay=(i*0.08)+'s';});audio.ontimeupdate=function(){var r=Math.ceil(audio.duration-audio.currentTime);dur.textContent=Math.floor(r/60)+':'+String(r%60).padStart(2,'0');};audio.onended=function(){btn.querySelector('svg').innerHTML='<path d="M8 5v14l11-7z"/>';bars.forEach(function(b){b.style.animation='none';});if(dur&&!isNaN(audio.duration)){var d=Math.ceil(audio.duration);dur.textContent=Math.floor(d/60)+':'+String(d%60).padStart(2,'0');}};}else{audio.pause();btn.querySelector('svg').innerHTML='<path d="M8 5v14l11-7z"/>';bars.forEach(function(b){b.style.animation='none';});}};
    if(dz){function endD(){if(!isDrag)return;isDrag=false;d.style.transition='';if(d.getBoundingClientRect().height/window.innerHeight*100<25)closeD();}dz.addEventListener('touchstart',function(e){isDrag=true;dY=e.touches[0].clientY;dH=d.getBoundingClientRect().height;d.style.transition='none';},{passive:true});dz.addEventListener('touchmove',function(e){if(!isDrag)return;e.preventDefault();var bo=parseFloat(getComputedStyle(d).bottom)||64,maxH=window.innerHeight-bo-80,newH=Math.max(80,Math.min(maxH,dH-(e.touches[0].clientY-dY)));d.style.height=newH+'px';},{passive:false});dz.addEventListener('touchend',endD,{passive:true});dz.addEventListener('touchcancel',endD,{passive:true});dz.addEventListener('mousedown',function(e){isDrag=true;dY=e.clientY;dH=d.getBoundingClientRect().height;d.style.transition='none';function onMouseMove(ev){if(!isDrag)return;var bo=parseFloat(getComputedStyle(d).bottom)||64,maxH=window.innerHeight-bo-80,newH=Math.max(80,Math.min(maxH,dH-(ev.clientY-dY)));d.style.height=newH+'px';}function onMouseUp(){document.removeEventListener('mousemove',onMouseMove);document.removeEventListener('mouseup',onMouseUp);endD();}document.addEventListener('mousemove',onMouseMove);document.addEventListener('mouseup',onMouseUp);});}
    var fp=document.getElementById('shai-friend-panel'),fb=document.getElementById('shai-friend-back'),fs=document.getElementById('shai-friend-search'),fl=document.getElementById('shai-friend-list'),avatarWrap=document.getElementById('shai-avatar-wrap'),drawerHeaderTitle=document.getElementById('shai-header-title'),drawerHeaderSub=document.getElementById('shai-header-sub'),isF=false;
    window.__addFriendContacts=window.__addFriendContacts||[{name:'Alex Johnson',phone:'+1 (555) 123-4567',goshopme:true,avatar:'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-2.jpg'},{name:'Maria Rodriguez',phone:'+1 (555) 987-6543',goshopme:false},{name:'David Kim',phone:'+1 (555) 456-7890',goshopme:true,avatar:'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-3.jpg'},{name:'Sarah Thompson',phone:'+1 (555) 234-5678',goshopme:false},{name:'Emma Wilson',phone:'+1 (555) 345-6789',goshopme:true,avatar:'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-5.jpg'},{name:'Michael Brown',phone:'+1 (555) 678-9012',goshopme:false},{name:'Jennifer Lee',phone:'+1 (555) 789-0123',goshopme:true,avatar:'https://raw.githubusercontent.com/nora-todorova/GoShopMe-assets/main/assets/avatars/avatar-6.jpg'}];
    function getIn(n){var p=(n||'').trim().split(/\s+/);return p.length>=2?(p[0][0]+p[1][0]).toUpperCase():(p[0]?p[0].slice(0,2):'??').toUpperCase();}
    function renderF(q){if(!fl)return;var list=(window.__addFriendContacts||[]).filter(function(c){if(!q)return true;return(c.name||'').toLowerCase().indexOf((q||'').toLowerCase())>=0||(c.phone||'').indexOf(q)>=0;});if(!list.length){fl.innerHTML='<div class="text-center text-sm text-gray-400 py-8">No contacts found</div>';return;}fl.innerHTML=list.map(function(c,i){var initials=getIn(c.name);var avatarHtml=(c.goshopme&&c.avatar)?'<div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0"><img src="'+c.avatar+'" alt="" class="w-full h-full object-cover"></div>':'<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span class="text-gray-600 font-medium text-xs">'+initials+'</span></div>';var btnClass=c.goshopme?'bg-[#939BFB] text-white px-2 py-1 rounded-full text-xs font-medium flex-shrink-0':'bg-white text-[#939BFB] px-2 py-1 rounded-full text-xs font-medium border border-[#939BFB] flex-shrink-0';var btnLabel=c.goshopme?'Add':'Invite';return'<div class="contact-item flex items-center gap-2 p-2 bg-gray-50 rounded-xl" data-idx="'+i+'" data-name="'+(c.name||'').replace(/"/g,'&quot;')+'" data-phone="'+(c.phone||'').replace(/"/g,'&quot;')+'" data-goshopme="'+(c.goshopme?'true':'false')+'">'+avatarHtml+'<div class="flex-1 min-w-0"><p class="font-medium text-sm text-black truncate">'+(c.name||'').replace(/</g,'&lt;')+'</p><p class="text-xs text-gray-500 truncate">'+(c.phone||'').replace(/</g,'&lt;')+'</p></div><button class="shai-friend-action '+btnClass+'">'+btnLabel+'</button></div>';}).join('');fl.querySelectorAll('.shai-friend-action').forEach(function(btn){btn.addEventListener('click',function(){var idx=parseInt(btn.closest('[data-idx]').getAttribute('data-idx'),10),c=list[idx],firstName=c?(c.name||'').split(' ')[0]:'Contact';if(btn.textContent.trim()==='Add'){if(mc){var n=document.createElement('div');n.className='flex justify-center mb-4';n.innerHTML='<div class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-xs font-medium">'+firstName+' has been added to chat</div>';mc.appendChild(n);scrollB();}hideF();}else{var shareData={title:'Join me on GoShopMe',text:"Hey! I'm using GoShopMe. It's faster, smarter and effortless - join me",url:'https://app.goshopme.ai'};if(navigator.share){navigator.share(shareData).catch(function(){if(navigator.clipboard)navigator.clipboard.writeText(shareData.text+' '+shareData.url);});}else if(navigator.clipboard){navigator.clipboard.writeText(shareData.text+' '+shareData.url);showT('Invitation link copied to clipboard!');}}});});}
    function showF(){isF=true;if(!isOpen)openD();if(m)m.classList.add('hidden');if(fp){fp.classList.remove('hidden');fp.classList.add('flex');}if(fb)fb.classList.remove('hidden');if(avatarWrap)avatarWrap.classList.remove('hidden');if(drawerHeaderTitle)drawerHeaderTitle.textContent='Add Friend';if(drawerHeaderSub)drawerHeaderSub.textContent='Choose contacts to add';if(fs)fs.value='';renderF('');}
    function hideF(){isF=false;if(m)m.classList.remove('hidden');if(fp){fp.classList.add('hidden');fp.classList.remove('flex');}if(fb)fb.classList.add('hidden');if(drawerHeaderTitle)drawerHeaderTitle.textContent='ShAI';if(drawerHeaderSub)drawerHeaderSub.textContent='Your shopping assistant';}
    if(fb)fb.addEventListener('click',hideF);if(fs)fs.addEventListener('input',function(){renderF(fs.value);});if(ad)ad.addEventListener('click',showF);if(ab)ab.addEventListener('click',showF);
    if(!document.getElementById('shai-wave-css')){var s=document.createElement('style');s.id='shai-wave-css';s.textContent='@keyframes shaiWave{0%,100%{transform:scaleY(1)}50%{transform:scaleY(2)}}';document.head.appendChild(s);}
  }
  if(document.getElementById('chat-drawer')){if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',init);else init();}
})();
</script>
</body>
</html>

